{"ast":null,"code":"// Helper borrowed from paraviewweb/src/Common/Core\nimport CompositeClosureHelper from '../CompositeClosureHelper';\nimport Session from './session';\nvar DEFAULT_SECRET = 'wslink-secret';\nfunction getTransportObject(url) {\n  var idx = url.indexOf(':'),\n    protocol = url.substring(0, idx);\n  if (protocol === 'ws' || protocol === 'wss') {\n    return {\n      type: 'websocket',\n      url: url\n    };\n  }\n  throw new Error(\"Unknown protocol (\".concat(protocol, \") for url (\").concat(url, \").  Unable to create transport object.\"));\n}\nfunction WebsocketConnection(publicAPI, model) {\n  // TODO Should we try to reconnect on error?\n\n  publicAPI.connect = function () {\n    // without a URL we can't do anything.\n    if (!model.urls) return null;\n    // concat allows a single url or a list.\n    var uriList = [].concat(model.urls),\n      transports = [];\n    for (var i = 0; i < uriList.length; i += 1) {\n      var url = uriList[i];\n      try {\n        var transport = getTransportObject(url);\n        transports.push(transport);\n      } catch (transportCreateError) {\n        console.error(transportCreateError);\n        publicAPI.fireConnectionError(publicAPI, transportCreateError);\n        return null;\n      }\n    }\n    if (model.connection) {\n      if (model.connection.url !== transports[0].url) {\n        model.connection.close();\n      } else if (model.connection.readyState === 0 || model.connection.readyState === 1) {\n        // already connected.\n        return model.session;\n      }\n    }\n    try {\n      if (model.wsProxy) {\n        model.connection = new WSLINK.WebSocket(transports[0].url);\n      } else {\n        model.connection = new WebSocket(transports[0].url);\n      }\n    } catch (err) {\n      // If the server isn't running, we still don't enter here on Chrome -\n      // console shows a net::ERR_CONNECTION_REFUSED error inside WebSocket\n      console.error(err);\n      publicAPI.fireConnectionError(publicAPI, err);\n      return null;\n    }\n    model.connection.binaryType = 'blob';\n    if (!model.secret) model.secret = DEFAULT_SECRET;\n    model.session = Session.newInstance({\n      ws: model.connection,\n      secret: model.secret\n    });\n    model.connection.onopen = function (event) {\n      if (model.session) {\n        // sends handshake message - wait for reply before issuing ready()\n        model.session.onconnect(event).then(function () {\n          publicAPI.fireConnectionReady(publicAPI);\n        }, function (err) {\n          console.error('Connection error', err);\n          publicAPI.fireConnectionError(publicAPI, err);\n        });\n      }\n    };\n    model.connection.onclose = function (event) {\n      publicAPI.fireConnectionClose(publicAPI, event);\n      model.connection = null;\n      // return !model.retry; // true => Stop retry\n    };\n\n    model.connection.onerror = function (event) {\n      publicAPI.fireConnectionError(publicAPI, event);\n    };\n    // handle messages in the session.\n    model.connection.onmessage = function (event) {\n      model.session.onmessage(event);\n    };\n    return model.session;\n  };\n  publicAPI.getSession = function () {\n    return model.session;\n  };\n  publicAPI.getUrl = function () {\n    return model.connection ? model.connection.url : undefined;\n  };\n  function cleanUp() {\n    var timeout = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 10;\n    if (model.connection && model.connection.readyState === 1 && model.session && timeout > 0) {\n      model.session.call('application.exit.later', [timeout]);\n    }\n    if (model.connection) {\n      model.connection.close();\n    }\n    model.connection = null;\n  }\n  publicAPI.destroy = CompositeClosureHelper.chain(cleanUp, publicAPI.destroy);\n}\nvar DEFAULT_VALUES = {\n  secret: DEFAULT_SECRET,\n  connection: null,\n  session: null,\n  retry: false,\n  wsProxy: false // Use WSLINK.WebSocket if true else native WebSocket\n};\n\nexport function extend(publicAPI, model) {\n  var initialValues = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n  CompositeClosureHelper.destroy(publicAPI, model);\n  CompositeClosureHelper.event(publicAPI, model, 'ConnectionReady');\n  CompositeClosureHelper.event(publicAPI, model, 'ConnectionClose');\n  CompositeClosureHelper.event(publicAPI, model, 'ConnectionError');\n  CompositeClosureHelper.isA(publicAPI, model, 'WebsocketConnection');\n  WebsocketConnection(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nexport var newInstance = CompositeClosureHelper.newInstance(extend);\n\n// ----------------------------------------------------------------------------\n\nexport default {\n  newInstance: newInstance,\n  extend: extend\n};","map":{"version":3,"names":["CompositeClosureHelper","Session","DEFAULT_SECRET","getTransportObject","url","idx","indexOf","protocol","substring","type","Error","concat","WebsocketConnection","publicAPI","model","connect","urls","uriList","transports","i","length","transport","push","transportCreateError","console","error","fireConnectionError","connection","close","readyState","session","wsProxy","WSLINK","WebSocket","err","binaryType","secret","newInstance","ws","onopen","event","onconnect","then","fireConnectionReady","onclose","fireConnectionClose","onerror","onmessage","getSession","getUrl","undefined","cleanUp","timeout","arguments","call","destroy","chain","DEFAULT_VALUES","retry","extend","initialValues","Object","assign","isA"],"sources":["/home/rakshith/Documents/RemoteRendering/vtk-js-react-app/node_modules/wslink/src/WebsocketConnection/index.js"],"sourcesContent":["// Helper borrowed from paraviewweb/src/Common/Core\nimport CompositeClosureHelper from '../CompositeClosureHelper';\nimport Session from './session';\n\nconst DEFAULT_SECRET = 'wslink-secret';\n\nfunction getTransportObject(url) {\n  var idx = url.indexOf(':'),\n    protocol = url.substring(0, idx);\n  if (protocol === 'ws' || protocol === 'wss') {\n    return {\n      type: 'websocket',\n      url,\n    };\n  }\n\n  throw new Error(\n    `Unknown protocol (${protocol}) for url (${url}).  Unable to create transport object.`\n  );\n}\n\nfunction WebsocketConnection(publicAPI, model) {\n  // TODO Should we try to reconnect on error?\n\n  publicAPI.connect = () => {\n    // without a URL we can't do anything.\n    if (!model.urls) return null;\n    // concat allows a single url or a list.\n    var uriList = [].concat(model.urls),\n      transports = [];\n\n    for (let i = 0; i < uriList.length; i += 1) {\n      const url = uriList[i];\n      try {\n        const transport = getTransportObject(url);\n        transports.push(transport);\n      } catch (transportCreateError) {\n        console.error(transportCreateError);\n        publicAPI.fireConnectionError(publicAPI, transportCreateError);\n        return null;\n      }\n    }\n\n    if (model.connection) {\n      if (model.connection.url !== transports[0].url) {\n        model.connection.close();\n      } else if (\n        model.connection.readyState === 0 ||\n        model.connection.readyState === 1\n      ) {\n        // already connected.\n        return model.session;\n      }\n    }\n    try {\n      if (model.wsProxy) {\n        model.connection = new WSLINK.WebSocket(transports[0].url);\n      } else {\n        model.connection = new WebSocket(transports[0].url);\n      }\n    } catch (err) {\n      // If the server isn't running, we still don't enter here on Chrome -\n      // console shows a net::ERR_CONNECTION_REFUSED error inside WebSocket\n      console.error(err);\n      publicAPI.fireConnectionError(publicAPI, err);\n      return null;\n    }\n\n    model.connection.binaryType = 'blob';\n    if (!model.secret) model.secret = DEFAULT_SECRET;\n    model.session = Session.newInstance({\n      ws: model.connection,\n      secret: model.secret,\n    });\n\n    model.connection.onopen = (event) => {\n      if (model.session) {\n        // sends handshake message - wait for reply before issuing ready()\n        model.session.onconnect(event).then(\n          () => {\n            publicAPI.fireConnectionReady(publicAPI);\n          },\n          (err) => {\n            console.error('Connection error', err);\n            publicAPI.fireConnectionError(publicAPI, err);\n          }\n        );\n      }\n    };\n\n    model.connection.onclose = (event) => {\n      publicAPI.fireConnectionClose(publicAPI, event);\n      model.connection = null;\n      // return !model.retry; // true => Stop retry\n    };\n    model.connection.onerror = (event) => {\n      publicAPI.fireConnectionError(publicAPI, event);\n    };\n    // handle messages in the session.\n    model.connection.onmessage = (event) => {\n      model.session.onmessage(event);\n    };\n    return model.session;\n  };\n\n  publicAPI.getSession = () => model.session;\n\n  publicAPI.getUrl = () =>\n    model.connection ? model.connection.url : undefined;\n\n  function cleanUp(timeout = 10) {\n    if (\n      model.connection &&\n      model.connection.readyState === 1 &&\n      model.session &&\n      timeout > 0\n    ) {\n      model.session.call('application.exit.later', [timeout]);\n    }\n    if (model.connection) {\n      model.connection.close();\n    }\n    model.connection = null;\n  }\n\n  publicAPI.destroy = CompositeClosureHelper.chain(cleanUp, publicAPI.destroy);\n}\n\nconst DEFAULT_VALUES = {\n  secret: DEFAULT_SECRET,\n  connection: null,\n  session: null,\n  retry: false,\n  wsProxy: false, // Use WSLINK.WebSocket if true else native WebSocket\n};\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n\n  CompositeClosureHelper.destroy(publicAPI, model);\n  CompositeClosureHelper.event(publicAPI, model, 'ConnectionReady');\n  CompositeClosureHelper.event(publicAPI, model, 'ConnectionClose');\n  CompositeClosureHelper.event(publicAPI, model, 'ConnectionError');\n  CompositeClosureHelper.isA(publicAPI, model, 'WebsocketConnection');\n\n  WebsocketConnection(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nexport const newInstance = CompositeClosureHelper.newInstance(extend);\n\n// ----------------------------------------------------------------------------\n\nexport default { newInstance, extend };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}