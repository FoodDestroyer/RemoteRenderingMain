{"ast":null,"code":"import macro from '../../macros.js';\nimport vtkWebGPURenderEncoder from './RenderEncoder.js';\nimport vtkWebGPUTexture from './Texture.js';\nimport vtkWebGPUShaderCache from './ShaderCache.js';\nimport vtkRenderPass from '../SceneGraph/RenderPass.js';\nfunction vtkWebGPUHardwareSelectionPass(publicAPI, model) {\n  // Set our className\n  model.classHierarchy.push('vtkWebGPUHardwareSelectionPass'); // this pass implements a forward rendering pipeline\n  // if both volumes and opaque geometry are present\n  // it will mix the two together by capturing a zbuffer\n  // first\n\n  publicAPI.traverse = function (viewNode, renNode) {\n    if (model.deleted) {\n      return;\n    }\n    model._currentParent = null; // build\n\n    publicAPI.setCurrentOperation('buildPass');\n    viewNode.traverse(publicAPI);\n    var device = viewNode.getDevice();\n    if (!model.selectionRenderEncoder) {\n      publicAPI.createRenderEncoder(); // create color texture\n\n      model.colorTexture = vtkWebGPUTexture.newInstance({\n        label: 'hardwareSelectorColor'\n      });\n      model.colorTexture.create(device, {\n        width: viewNode.getCanvas().width,\n        height: viewNode.getCanvas().height,\n        format: 'rgba32uint',\n        /* eslint-disable no-undef */\n\n        /* eslint-disable no-bitwise */\n        usage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.COPY_SRC\n      });\n      var v1 = model.colorTexture.createView('hardwareSelectColorTexture');\n      model.selectionRenderEncoder.setColorTextureView(0, v1); // create depth texture\n\n      model.depthTexture = vtkWebGPUTexture.newInstance({\n        label: 'hardwareSelectorDepth'\n      });\n      model.depthTexture.create(device, {\n        width: viewNode.getCanvas().width,\n        height: viewNode.getCanvas().height,\n        format: 'depth32float',\n        /* eslint-disable no-undef */\n\n        /* eslint-disable no-bitwise */\n        usage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.COPY_SRC\n      });\n      var v2 = model.depthTexture.createView('hardwareSelectDepthTexture');\n      model.selectionRenderEncoder.setDepthTextureView(v2);\n    } else {\n      model.colorTexture.resize(viewNode.getCanvas().width, viewNode.getCanvas().height);\n      model.depthTexture.resizeToMatch(model.colorTexture);\n    }\n    model.selectionRenderEncoder.attachTextureViews();\n    renNode.setRenderEncoder(model.selectionRenderEncoder);\n    publicAPI.setCurrentOperation('cameraPass');\n    renNode.traverse(publicAPI); // opaque pass is used for selection\n\n    publicAPI.setCurrentOperation('opaquePass');\n    renNode.traverse(publicAPI);\n  };\n  publicAPI.createRenderEncoder = function () {\n    model.selectionRenderEncoder = vtkWebGPURenderEncoder.newInstance({\n      label: 'HardwareSelectionPass'\n    }); // default settings are fine for this\n\n    model.selectionRenderEncoder.setPipelineHash('sel');\n    model.selectionRenderEncoder.setReplaceShaderCodeFunction(function (pipeline) {\n      var fDesc = pipeline.getShaderDescription('fragment');\n      fDesc.addOutput('vec4<u32>', 'outColor');\n      var code = fDesc.getCode();\n      code = vtkWebGPUShaderCache.substitute(code, '//VTK::RenderEncoder::Impl', ['output.outColor = vec4<u32>(mapperUBO.PropID, compositeID, 0u, 0u);']).result;\n      fDesc.setCode(code);\n    });\n    var renDesc = model.selectionRenderEncoder.getDescription();\n    renDesc.colorAttachments[0].clearValue = [0.0, 0.0, 0.0, 0.0];\n    model.selectionRenderEncoder.setPipelineSettings({\n      primitive: {\n        cullMode: 'none'\n      },\n      depthStencil: {\n        depthWriteEnabled: true,\n        depthCompare: 'greater',\n        format: 'depth32float'\n      },\n      fragment: {\n        targets: [{\n          format: 'rgba32uint',\n          blend: undefined\n        }]\n      }\n    });\n  };\n} // ----------------------------------------------------------------------------\n// Object factory\n// ----------------------------------------------------------------------------\n\nvar DEFAULT_VALUES = {\n  selectionRenderEncoder: null,\n  colorTexture: null,\n  depthTexture: null\n}; // ----------------------------------------------------------------------------\n\nfunction extend(publicAPI, model) {\n  var initialValues = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  Object.assign(model, DEFAULT_VALUES, initialValues); // Build VTK API\n\n  vtkRenderPass.extend(publicAPI, model, initialValues);\n  macro.get(publicAPI, model, ['colorTexture', 'depthTexture']); // Object methods\n\n  vtkWebGPUHardwareSelectionPass(publicAPI, model);\n} // ----------------------------------------------------------------------------\n\nvar newInstance = macro.newInstance(extend, 'vtkWebGPUHardwareSelectionPass'); // ----------------------------------------------------------------------------\n\nvar vtkWebGPUHardwareSelectionPass$1 = {\n  newInstance: newInstance,\n  extend: extend\n};\nexport { vtkWebGPUHardwareSelectionPass$1 as default, extend, newInstance };","map":{"version":3,"names":["macro","vtkWebGPURenderEncoder","vtkWebGPUTexture","vtkWebGPUShaderCache","vtkRenderPass","vtkWebGPUHardwareSelectionPass","publicAPI","model","classHierarchy","push","traverse","viewNode","renNode","deleted","_currentParent","setCurrentOperation","device","getDevice","selectionRenderEncoder","createRenderEncoder","colorTexture","newInstance","label","create","width","getCanvas","height","format","usage","GPUTextureUsage","RENDER_ATTACHMENT","COPY_SRC","v1","createView","setColorTextureView","depthTexture","v2","setDepthTextureView","resize","resizeToMatch","attachTextureViews","setRenderEncoder","setPipelineHash","setReplaceShaderCodeFunction","pipeline","fDesc","getShaderDescription","addOutput","code","getCode","substitute","result","setCode","renDesc","getDescription","colorAttachments","clearValue","setPipelineSettings","primitive","cullMode","depthStencil","depthWriteEnabled","depthCompare","fragment","targets","blend","undefined","DEFAULT_VALUES","extend","initialValues","arguments","length","Object","assign","get","vtkWebGPUHardwareSelectionPass$1","default"],"sources":["/home/rakshith/Documents/RemoteRendering/vtk-js-react-app/node_modules/@kitware/vtk.js/Rendering/WebGPU/HardwareSelectionPass.js"],"sourcesContent":["import macro from '../../macros.js';\nimport vtkWebGPURenderEncoder from './RenderEncoder.js';\nimport vtkWebGPUTexture from './Texture.js';\nimport vtkWebGPUShaderCache from './ShaderCache.js';\nimport vtkRenderPass from '../SceneGraph/RenderPass.js';\n\nfunction vtkWebGPUHardwareSelectionPass(publicAPI, model) {\n  // Set our className\n  model.classHierarchy.push('vtkWebGPUHardwareSelectionPass'); // this pass implements a forward rendering pipeline\n  // if both volumes and opaque geometry are present\n  // it will mix the two together by capturing a zbuffer\n  // first\n\n  publicAPI.traverse = function (viewNode, renNode) {\n    if (model.deleted) {\n      return;\n    }\n\n    model._currentParent = null; // build\n\n    publicAPI.setCurrentOperation('buildPass');\n    viewNode.traverse(publicAPI);\n    var device = viewNode.getDevice();\n\n    if (!model.selectionRenderEncoder) {\n      publicAPI.createRenderEncoder(); // create color texture\n\n      model.colorTexture = vtkWebGPUTexture.newInstance({\n        label: 'hardwareSelectorColor'\n      });\n      model.colorTexture.create(device, {\n        width: viewNode.getCanvas().width,\n        height: viewNode.getCanvas().height,\n        format: 'rgba32uint',\n\n        /* eslint-disable no-undef */\n\n        /* eslint-disable no-bitwise */\n        usage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.COPY_SRC\n      });\n      var v1 = model.colorTexture.createView('hardwareSelectColorTexture');\n      model.selectionRenderEncoder.setColorTextureView(0, v1); // create depth texture\n\n      model.depthTexture = vtkWebGPUTexture.newInstance({\n        label: 'hardwareSelectorDepth'\n      });\n      model.depthTexture.create(device, {\n        width: viewNode.getCanvas().width,\n        height: viewNode.getCanvas().height,\n        format: 'depth32float',\n\n        /* eslint-disable no-undef */\n\n        /* eslint-disable no-bitwise */\n        usage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.COPY_SRC\n      });\n      var v2 = model.depthTexture.createView('hardwareSelectDepthTexture');\n      model.selectionRenderEncoder.setDepthTextureView(v2);\n    } else {\n      model.colorTexture.resize(viewNode.getCanvas().width, viewNode.getCanvas().height);\n      model.depthTexture.resizeToMatch(model.colorTexture);\n    }\n\n    model.selectionRenderEncoder.attachTextureViews();\n    renNode.setRenderEncoder(model.selectionRenderEncoder);\n    publicAPI.setCurrentOperation('cameraPass');\n    renNode.traverse(publicAPI); // opaque pass is used for selection\n\n    publicAPI.setCurrentOperation('opaquePass');\n    renNode.traverse(publicAPI);\n  };\n\n  publicAPI.createRenderEncoder = function () {\n    model.selectionRenderEncoder = vtkWebGPURenderEncoder.newInstance({\n      label: 'HardwareSelectionPass'\n    }); // default settings are fine for this\n\n    model.selectionRenderEncoder.setPipelineHash('sel');\n    model.selectionRenderEncoder.setReplaceShaderCodeFunction(function (pipeline) {\n      var fDesc = pipeline.getShaderDescription('fragment');\n      fDesc.addOutput('vec4<u32>', 'outColor');\n      var code = fDesc.getCode();\n      code = vtkWebGPUShaderCache.substitute(code, '//VTK::RenderEncoder::Impl', ['output.outColor = vec4<u32>(mapperUBO.PropID, compositeID, 0u, 0u);']).result;\n      fDesc.setCode(code);\n    });\n    var renDesc = model.selectionRenderEncoder.getDescription();\n    renDesc.colorAttachments[0].clearValue = [0.0, 0.0, 0.0, 0.0];\n    model.selectionRenderEncoder.setPipelineSettings({\n      primitive: {\n        cullMode: 'none'\n      },\n      depthStencil: {\n        depthWriteEnabled: true,\n        depthCompare: 'greater',\n        format: 'depth32float'\n      },\n      fragment: {\n        targets: [{\n          format: 'rgba32uint',\n          blend: undefined\n        }]\n      }\n    });\n  };\n} // ----------------------------------------------------------------------------\n// Object factory\n// ----------------------------------------------------------------------------\n\n\nvar DEFAULT_VALUES = {\n  selectionRenderEncoder: null,\n  colorTexture: null,\n  depthTexture: null\n}; // ----------------------------------------------------------------------------\n\nfunction extend(publicAPI, model) {\n  var initialValues = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  Object.assign(model, DEFAULT_VALUES, initialValues); // Build VTK API\n\n  vtkRenderPass.extend(publicAPI, model, initialValues);\n  macro.get(publicAPI, model, ['colorTexture', 'depthTexture']); // Object methods\n\n  vtkWebGPUHardwareSelectionPass(publicAPI, model);\n} // ----------------------------------------------------------------------------\n\nvar newInstance = macro.newInstance(extend, 'vtkWebGPUHardwareSelectionPass'); // ----------------------------------------------------------------------------\n\nvar vtkWebGPUHardwareSelectionPass$1 = {\n  newInstance: newInstance,\n  extend: extend\n};\n\nexport { vtkWebGPUHardwareSelectionPass$1 as default, extend, newInstance };\n"],"mappings":"AAAA,OAAOA,KAAK,MAAM,iBAAiB;AACnC,OAAOC,sBAAsB,MAAM,oBAAoB;AACvD,OAAOC,gBAAgB,MAAM,cAAc;AAC3C,OAAOC,oBAAoB,MAAM,kBAAkB;AACnD,OAAOC,aAAa,MAAM,6BAA6B;AAEvD,SAASC,8BAA8BA,CAACC,SAAS,EAAEC,KAAK,EAAE;EACxD;EACAA,KAAK,CAACC,cAAc,CAACC,IAAI,CAAC,gCAAgC,CAAC,CAAC,CAAC;EAC7D;EACA;EACA;;EAEAH,SAAS,CAACI,QAAQ,GAAG,UAAUC,QAAQ,EAAEC,OAAO,EAAE;IAChD,IAAIL,KAAK,CAACM,OAAO,EAAE;MACjB;IACF;IAEAN,KAAK,CAACO,cAAc,GAAG,IAAI,CAAC,CAAC;;IAE7BR,SAAS,CAACS,mBAAmB,CAAC,WAAW,CAAC;IAC1CJ,QAAQ,CAACD,QAAQ,CAACJ,SAAS,CAAC;IAC5B,IAAIU,MAAM,GAAGL,QAAQ,CAACM,SAAS,CAAC,CAAC;IAEjC,IAAI,CAACV,KAAK,CAACW,sBAAsB,EAAE;MACjCZ,SAAS,CAACa,mBAAmB,CAAC,CAAC,CAAC,CAAC;;MAEjCZ,KAAK,CAACa,YAAY,GAAGlB,gBAAgB,CAACmB,WAAW,CAAC;QAChDC,KAAK,EAAE;MACT,CAAC,CAAC;MACFf,KAAK,CAACa,YAAY,CAACG,MAAM,CAACP,MAAM,EAAE;QAChCQ,KAAK,EAAEb,QAAQ,CAACc,SAAS,CAAC,CAAC,CAACD,KAAK;QACjCE,MAAM,EAAEf,QAAQ,CAACc,SAAS,CAAC,CAAC,CAACC,MAAM;QACnCC,MAAM,EAAE,YAAY;QAEpB;;QAEA;QACAC,KAAK,EAAEC,eAAe,CAACC,iBAAiB,GAAGD,eAAe,CAACE;MAC7D,CAAC,CAAC;MACF,IAAIC,EAAE,GAAGzB,KAAK,CAACa,YAAY,CAACa,UAAU,CAAC,4BAA4B,CAAC;MACpE1B,KAAK,CAACW,sBAAsB,CAACgB,mBAAmB,CAAC,CAAC,EAAEF,EAAE,CAAC,CAAC,CAAC;;MAEzDzB,KAAK,CAAC4B,YAAY,GAAGjC,gBAAgB,CAACmB,WAAW,CAAC;QAChDC,KAAK,EAAE;MACT,CAAC,CAAC;MACFf,KAAK,CAAC4B,YAAY,CAACZ,MAAM,CAACP,MAAM,EAAE;QAChCQ,KAAK,EAAEb,QAAQ,CAACc,SAAS,CAAC,CAAC,CAACD,KAAK;QACjCE,MAAM,EAAEf,QAAQ,CAACc,SAAS,CAAC,CAAC,CAACC,MAAM;QACnCC,MAAM,EAAE,cAAc;QAEtB;;QAEA;QACAC,KAAK,EAAEC,eAAe,CAACC,iBAAiB,GAAGD,eAAe,CAACE;MAC7D,CAAC,CAAC;MACF,IAAIK,EAAE,GAAG7B,KAAK,CAAC4B,YAAY,CAACF,UAAU,CAAC,4BAA4B,CAAC;MACpE1B,KAAK,CAACW,sBAAsB,CAACmB,mBAAmB,CAACD,EAAE,CAAC;IACtD,CAAC,MAAM;MACL7B,KAAK,CAACa,YAAY,CAACkB,MAAM,CAAC3B,QAAQ,CAACc,SAAS,CAAC,CAAC,CAACD,KAAK,EAAEb,QAAQ,CAACc,SAAS,CAAC,CAAC,CAACC,MAAM,CAAC;MAClFnB,KAAK,CAAC4B,YAAY,CAACI,aAAa,CAAChC,KAAK,CAACa,YAAY,CAAC;IACtD;IAEAb,KAAK,CAACW,sBAAsB,CAACsB,kBAAkB,CAAC,CAAC;IACjD5B,OAAO,CAAC6B,gBAAgB,CAAClC,KAAK,CAACW,sBAAsB,CAAC;IACtDZ,SAAS,CAACS,mBAAmB,CAAC,YAAY,CAAC;IAC3CH,OAAO,CAACF,QAAQ,CAACJ,SAAS,CAAC,CAAC,CAAC;;IAE7BA,SAAS,CAACS,mBAAmB,CAAC,YAAY,CAAC;IAC3CH,OAAO,CAACF,QAAQ,CAACJ,SAAS,CAAC;EAC7B,CAAC;EAEDA,SAAS,CAACa,mBAAmB,GAAG,YAAY;IAC1CZ,KAAK,CAACW,sBAAsB,GAAGjB,sBAAsB,CAACoB,WAAW,CAAC;MAChEC,KAAK,EAAE;IACT,CAAC,CAAC,CAAC,CAAC;;IAEJf,KAAK,CAACW,sBAAsB,CAACwB,eAAe,CAAC,KAAK,CAAC;IACnDnC,KAAK,CAACW,sBAAsB,CAACyB,4BAA4B,CAAC,UAAUC,QAAQ,EAAE;MAC5E,IAAIC,KAAK,GAAGD,QAAQ,CAACE,oBAAoB,CAAC,UAAU,CAAC;MACrDD,KAAK,CAACE,SAAS,CAAC,WAAW,EAAE,UAAU,CAAC;MACxC,IAAIC,IAAI,GAAGH,KAAK,CAACI,OAAO,CAAC,CAAC;MAC1BD,IAAI,GAAG7C,oBAAoB,CAAC+C,UAAU,CAACF,IAAI,EAAE,4BAA4B,EAAE,CAAC,qEAAqE,CAAC,CAAC,CAACG,MAAM;MAC1JN,KAAK,CAACO,OAAO,CAACJ,IAAI,CAAC;IACrB,CAAC,CAAC;IACF,IAAIK,OAAO,GAAG9C,KAAK,CAACW,sBAAsB,CAACoC,cAAc,CAAC,CAAC;IAC3DD,OAAO,CAACE,gBAAgB,CAAC,CAAC,CAAC,CAACC,UAAU,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC;IAC7DjD,KAAK,CAACW,sBAAsB,CAACuC,mBAAmB,CAAC;MAC/CC,SAAS,EAAE;QACTC,QAAQ,EAAE;MACZ,CAAC;MACDC,YAAY,EAAE;QACZC,iBAAiB,EAAE,IAAI;QACvBC,YAAY,EAAE,SAAS;QACvBnC,MAAM,EAAE;MACV,CAAC;MACDoC,QAAQ,EAAE;QACRC,OAAO,EAAE,CAAC;UACRrC,MAAM,EAAE,YAAY;UACpBsC,KAAK,EAAEC;QACT,CAAC;MACH;IACF,CAAC,CAAC;EACJ,CAAC;AACH,CAAC,CAAC;AACF;AACA;;AAGA,IAAIC,cAAc,GAAG;EACnBjD,sBAAsB,EAAE,IAAI;EAC5BE,YAAY,EAAE,IAAI;EAClBe,YAAY,EAAE;AAChB,CAAC,CAAC,CAAC;;AAEH,SAASiC,MAAMA,CAAC9D,SAAS,EAAEC,KAAK,EAAE;EAChC,IAAI8D,aAAa,GAAGC,SAAS,CAACC,MAAM,GAAG,CAAC,IAAID,SAAS,CAAC,CAAC,CAAC,KAAKJ,SAAS,GAAGI,SAAS,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;EAC1FE,MAAM,CAACC,MAAM,CAAClE,KAAK,EAAE4D,cAAc,EAAEE,aAAa,CAAC,CAAC,CAAC;;EAErDjE,aAAa,CAACgE,MAAM,CAAC9D,SAAS,EAAEC,KAAK,EAAE8D,aAAa,CAAC;EACrDrE,KAAK,CAAC0E,GAAG,CAACpE,SAAS,EAAEC,KAAK,EAAE,CAAC,cAAc,EAAE,cAAc,CAAC,CAAC,CAAC,CAAC;;EAE/DF,8BAA8B,CAACC,SAAS,EAAEC,KAAK,CAAC;AAClD,CAAC,CAAC;;AAEF,IAAIc,WAAW,GAAGrB,KAAK,CAACqB,WAAW,CAAC+C,MAAM,EAAE,gCAAgC,CAAC,CAAC,CAAC;;AAE/E,IAAIO,gCAAgC,GAAG;EACrCtD,WAAW,EAAEA,WAAW;EACxB+C,MAAM,EAAEA;AACV,CAAC;AAED,SAASO,gCAAgC,IAAIC,OAAO,EAAER,MAAM,EAAE/C,WAAW"},"metadata":{},"sourceType":"module","externalDependencies":[]}