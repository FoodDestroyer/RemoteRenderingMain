{"ast":null,"code":"import _asyncToGenerator from '@babel/runtime/helpers/asyncToGenerator';\nimport _slicedToArray from '@babel/runtime/helpers/slicedToArray';\nimport _toConsumableArray from '@babel/runtime/helpers/toConsumableArray';\nimport _regeneratorRuntime from '@babel/runtime/regenerator';\nimport { f as vtkMath } from '../../Common/Core/Math/index.js';\nimport { FieldAssociations } from '../../Common/DataModel/DataSet/Constants.js';\nimport macro from '../../macros.js';\nimport WidgetManagerConst from './WidgetManager/Constants.js';\nimport { WIDGET_PRIORITY } from './AbstractWidget/Constants.js';\nvar ViewTypes = WidgetManagerConst.ViewTypes,\n  RenderingTypes = WidgetManagerConst.RenderingTypes,\n  CaptureOn = WidgetManagerConst.CaptureOn;\nvar vtkErrorMacro = macro.vtkErrorMacro,\n  vtkWarningMacro = macro.vtkWarningMacro;\nvar viewIdCount = 1; // ----------------------------------------------------------------------------\n// Helper\n// ----------------------------------------------------------------------------\n\nfunction extractRenderingComponents(renderer) {\n  var camera = renderer.getActiveCamera();\n  var renderWindow = renderer.getRenderWindow();\n  var interactor = renderWindow.getInteractor();\n  var apiSpecificRenderWindow = interactor.getView();\n  return {\n    renderer: renderer,\n    renderWindow: renderWindow,\n    interactor: interactor,\n    apiSpecificRenderWindow: apiSpecificRenderWindow,\n    camera: camera\n  };\n}\nfunction getPixelWorldHeightAtCoord(worldCoord, displayScaleParams) {\n  var dispHeightFactor = displayScaleParams.dispHeightFactor,\n    cameraPosition = displayScaleParams.cameraPosition,\n    cameraDir = displayScaleParams.cameraDir,\n    isParallel = displayScaleParams.isParallel,\n    rendererPixelDims = displayScaleParams.rendererPixelDims;\n  var scale = 1;\n  if (isParallel) {\n    scale = dispHeightFactor;\n  } else {\n    var worldCoordToCamera = _toConsumableArray(worldCoord);\n    vtkMath.subtract(worldCoordToCamera, cameraPosition, worldCoordToCamera);\n    scale = vtkMath.dot(worldCoordToCamera, cameraDir) * dispHeightFactor;\n  }\n  var rHeight = rendererPixelDims[1];\n  return scale / rHeight;\n} // ----------------------------------------------------------------------------\n// vtkWidgetManager methods\n// ----------------------------------------------------------------------------\n\nfunction vtkWidgetManager(publicAPI, model) {\n  if (!model.viewId) {\n    model.viewId = \"view-\".concat(viewIdCount++);\n  }\n  model.classHierarchy.push('vtkWidgetManager');\n  var propsWeakMap = new WeakMap();\n  var subscriptions = []; // --------------------------------------------------------------------------\n  // API internal\n  // --------------------------------------------------------------------------\n\n  function updateWidgetWeakMap(widget) {\n    var representations = widget.getRepresentations();\n    for (var i = 0; i < representations.length; i++) {\n      var representation = representations[i];\n      var origin = {\n        widget: widget,\n        representation: representation\n      };\n      var actors = representation.getActors();\n      for (var j = 0; j < actors.length; j++) {\n        var actor = actors[j];\n        propsWeakMap.set(actor, origin);\n      }\n    }\n  }\n  function getViewWidget(widget) {\n    return widget && (widget.isA('vtkAbstractWidget') ? widget : widget.getWidgetForView({\n      viewId: model.viewId\n    }));\n  } // --------------------------------------------------------------------------\n  // Widget scaling\n  // --------------------------------------------------------------------------\n\n  function updateDisplayScaleParams() {\n    var _apiSpecificRenderWindow = model._apiSpecificRenderWindow,\n      _camera = model._camera,\n      _renderer = model._renderer;\n    if (_renderer && _apiSpecificRenderWindow && _camera) {\n      var _apiSpecificRenderWin = _apiSpecificRenderWindow.getSize(),\n        _apiSpecificRenderWin2 = _slicedToArray(_apiSpecificRenderWin, 2),\n        rwW = _apiSpecificRenderWin2[0],\n        rwH = _apiSpecificRenderWin2[1];\n      var _renderer$getViewport = _renderer.getViewport(),\n        _renderer$getViewport2 = _slicedToArray(_renderer$getViewport, 4),\n        vxmin = _renderer$getViewport2[0],\n        vymin = _renderer$getViewport2[1],\n        vxmax = _renderer$getViewport2[2],\n        vymax = _renderer$getViewport2[3];\n      var pixelRatio = _apiSpecificRenderWindow.getComputedDevicePixelRatio();\n      var rendererPixelDims = [rwW * (vxmax - vxmin) / pixelRatio, rwH * (vymax - vymin) / pixelRatio];\n      var cameraPosition = _camera.getPosition();\n      var cameraDir = _camera.getDirectionOfProjection();\n      var isParallel = _camera.getParallelProjection();\n      var dispHeightFactor = isParallel ? 2 * _camera.getParallelScale() : 2 * Math.tan(vtkMath.radiansFromDegrees(_camera.getViewAngle()) / 2);\n      model.widgets.forEach(function (w) {\n        w.getNestedProps().forEach(function (r) {\n          if (r.getScaleInPixels()) {\n            r.setDisplayScaleParams({\n              dispHeightFactor: dispHeightFactor,\n              cameraPosition: cameraPosition,\n              cameraDir: cameraDir,\n              isParallel: isParallel,\n              rendererPixelDims: rendererPixelDims\n            });\n          }\n        });\n      });\n    }\n  } // --------------------------------------------------------------------------\n  // API public\n  // --------------------------------------------------------------------------\n\n  function updateSelection(_x, _x2, _x3) {\n    return _updateSelection.apply(this, arguments);\n  }\n  function _updateSelection() {\n    _updateSelection = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(callData, fromTouchEvent, callID) {\n      var position, _yield$publicAPI$getS, requestCount, selectedState, representation, widget, activateHandle, wantRender, i, w;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              activateHandle = function _activateHandle(w) {\n                if (fromTouchEvent) {\n                  // release any previous left button interaction\n                  model._interactor.invokeLeftButtonRelease(callData);\n                }\n                w.activateHandle({\n                  selectedState: selectedState,\n                  representation: representation\n                });\n                if (fromTouchEvent) {\n                  // re-trigger the left button press to pick the now-active widget\n                  model._interactor.invokeLeftButtonPress(callData);\n                }\n              };\n              position = callData.position;\n              _context3.next = 4;\n              return publicAPI.getSelectedDataForXY(position.x, position.y);\n            case 4:\n              _yield$publicAPI$getS = _context3.sent;\n              requestCount = _yield$publicAPI$getS.requestCount;\n              selectedState = _yield$publicAPI$getS.selectedState;\n              representation = _yield$publicAPI$getS.representation;\n              widget = _yield$publicAPI$getS.widget;\n              if (!(requestCount || callID !== model._currentUpdateSelectionCallID)) {\n                _context3.next = 11;\n                break;\n              }\n              return _context3.abrupt(\"return\");\n            case 11:\n              // Default cursor behavior\n              model._apiSpecificRenderWindow.setCursor(widget ? 'pointer' : 'default');\n              model.activeWidget = null;\n              wantRender = false;\n              if (model.widgetInFocus === widget && widget.hasFocus()) {\n                activateHandle(widget);\n                model.activeWidget = widget;\n                wantRender = true;\n              } else {\n                for (i = 0; i < model.widgets.length; i++) {\n                  w = model.widgets[i];\n                  if (w === widget && w.getNestedPickable()) {\n                    activateHandle(w);\n                    model.activeWidget = w;\n                    wantRender = true;\n                  } else {\n                    wantRender || (wantRender = !!w.getActiveState());\n                    w.deactivateAllHandles();\n                  }\n                }\n              }\n              if (wantRender) {\n                model._interactor.render();\n              }\n            case 16:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n    return _updateSelection.apply(this, arguments);\n  }\n  var handleEvent = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(callData) {\n      var fromTouchEvent,\n        callID,\n        _args = arguments;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              fromTouchEvent = _args.length > 1 && _args[1] !== undefined ? _args[1] : false;\n              if (!(!model.isAnimating && model.pickingEnabled && callData.pokedRenderer === model._renderer)) {\n                _context.next = 6;\n                break;\n              }\n              callID = Symbol('UpdateSelection');\n              model._currentUpdateSelectionCallID = callID;\n              _context.next = 6;\n              return updateSelection(callData, fromTouchEvent, callID);\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n    return function handleEvent(_x4) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n  function updateWidgetForRender(w) {\n    w.updateRepresentationForRender(model.renderingType);\n  }\n  function renderPickingBuffer() {\n    model.renderingType = RenderingTypes.PICKING_BUFFER;\n    model.widgets.forEach(updateWidgetForRender);\n  }\n  function renderFrontBuffer() {\n    model.renderingType = RenderingTypes.FRONT_BUFFER;\n    model.widgets.forEach(updateWidgetForRender);\n  }\n  function captureBuffers(_x5, _x6, _x7, _x8) {\n    return _captureBuffers.apply(this, arguments);\n  }\n  function _captureBuffers() {\n    _captureBuffers = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(x1, y1, x2, y2) {\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              if (!model._captureInProgress) {\n                _context4.next = 2;\n                break;\n              }\n              return _context4.abrupt(\"return\");\n            case 2:\n              model._captureInProgress = true;\n              renderPickingBuffer();\n              model._capturedBuffers = null;\n              _context4.next = 7;\n              return model._selector.getSourceDataAsync(model._renderer, x1, y1, x2, y2);\n            case 7:\n              model._capturedBuffers = _context4.sent;\n              model.previousSelectedData = null;\n              renderFrontBuffer();\n              model._captureInProgress = false;\n            case 11:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n    return _captureBuffers.apply(this, arguments);\n  }\n  publicAPI.enablePicking = function () {\n    model.pickingEnabled = true;\n    publicAPI.renderWidgets();\n  };\n  publicAPI.renderWidgets = function () {\n    if (model.pickingEnabled && model.captureOn === CaptureOn.MOUSE_RELEASE) {\n      var _model$_apiSpecificRe = model._apiSpecificRenderWindow.getSize(),\n        _model$_apiSpecificRe2 = _slicedToArray(_model$_apiSpecificRe, 2),\n        w = _model$_apiSpecificRe2[0],\n        h = _model$_apiSpecificRe2[1];\n      captureBuffers(0, 0, w, h);\n    }\n    renderFrontBuffer();\n    publicAPI.modified();\n  };\n  publicAPI.disablePicking = function () {\n    model.pickingEnabled = false;\n  };\n  publicAPI.setRenderer = function (renderer) {\n    var renderingComponents = extractRenderingComponents(renderer);\n    Object.assign(model, renderingComponents);\n    macro.moveToProtected({}, model, Object.keys(renderingComponents));\n    while (subscriptions.length) {\n      subscriptions.pop().unsubscribe();\n    }\n    model._selector = model._apiSpecificRenderWindow.createSelector();\n    model._selector.setFieldAssociation(FieldAssociations.FIELD_ASSOCIATION_POINTS);\n    subscriptions.push(model._apiSpecificRenderWindow.onWindowResizeEvent(updateDisplayScaleParams));\n    subscriptions.push(model._camera.onModified(updateDisplayScaleParams));\n    updateDisplayScaleParams();\n    subscriptions.push(model._interactor.onStartAnimation(function () {\n      model.isAnimating = true;\n    }));\n    subscriptions.push(model._interactor.onEndAnimation(function () {\n      model.isAnimating = false;\n      publicAPI.renderWidgets();\n    }));\n    subscriptions.push(model._interactor.onMouseMove(function (eventData) {\n      handleEvent(eventData);\n      return macro.VOID;\n    })); // must be handled after widgets, hence the given priority.\n\n    subscriptions.push(model._interactor.onLeftButtonPress(function (eventData) {\n      var deviceType = eventData.deviceType;\n      var touchEvent = deviceType === 'touch' || deviceType === 'pen'; // only try selection if the left button press is from touch.\n\n      if (touchEvent) {\n        handleEvent(eventData, touchEvent);\n      }\n      return macro.VOID;\n    }, WIDGET_PRIORITY / 2));\n    publicAPI.modified();\n    if (model.pickingEnabled) {\n      publicAPI.enablePicking();\n    }\n  };\n  function addWidgetInternal(viewWidget) {\n    viewWidget.setWidgetManager(publicAPI);\n    updateWidgetWeakMap(viewWidget);\n    updateDisplayScaleParams(); // Register to renderer\n\n    model._renderer.addActor(viewWidget);\n  }\n  publicAPI.addWidget = function (widget, viewType, initialValues) {\n    if (!model._renderer) {\n      vtkErrorMacro('Widget manager MUST BE link to a view before registering widgets');\n      return null;\n    }\n    var viewId = model.viewId,\n      _renderer = model._renderer;\n    var w = widget.getWidgetForView({\n      viewId: viewId,\n      renderer: _renderer,\n      viewType: viewType || ViewTypes.DEFAULT,\n      initialValues: initialValues\n    });\n    if (w != null && model.widgets.indexOf(w) === -1) {\n      model.widgets.push(w);\n      addWidgetInternal(w);\n      publicAPI.modified();\n    }\n    return w;\n  };\n  function removeWidgetInternal(viewWidget) {\n    model._renderer.removeActor(viewWidget);\n    viewWidget.delete();\n  }\n  function onWidgetRemoved() {\n    model._renderer.getRenderWindow().getInteractor().render();\n    publicAPI.renderWidgets();\n  }\n  publicAPI.removeWidgets = function () {\n    model.widgets.forEach(removeWidgetInternal);\n    model.widgets = [];\n    model.widgetInFocus = null;\n    onWidgetRemoved();\n  };\n  publicAPI.removeWidget = function (widget) {\n    var viewWidget = getViewWidget(widget);\n    var index = model.widgets.indexOf(viewWidget);\n    if (index !== -1) {\n      model.widgets.splice(index, 1);\n      var isWidgetInFocus = model.widgetInFocus === viewWidget;\n      if (isWidgetInFocus) {\n        publicAPI.releaseFocus();\n      }\n      removeWidgetInternal(viewWidget);\n      onWidgetRemoved();\n    }\n  };\n  publicAPI.getSelectedDataForXY = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(x, y) {\n      var capturedRegion;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              model.selections = null;\n              if (!model.pickingEnabled) {\n                _context2.next = 12;\n                break;\n              }\n              if (!(!model._capturedBuffers || model.captureOn === CaptureOn.MOUSE_MOVE)) {\n                _context2.next = 7;\n                break;\n              }\n              _context2.next = 5;\n              return captureBuffers(x, y, x, y);\n            case 5:\n              _context2.next = 11;\n              break;\n            case 7:\n              // or do we need a pixel that is outside the last capture?\n              capturedRegion = model._capturedBuffers.area;\n              if (!(x < capturedRegion[0] || x > capturedRegion[2] || y < capturedRegion[1] || y > capturedRegion[3])) {\n                _context2.next = 11;\n                break;\n              }\n              _context2.next = 11;\n              return captureBuffers(x, y, x, y);\n            case 11:\n              model.selections = model._capturedBuffers.generateSelection(x, y, x, y);\n            case 12:\n              return _context2.abrupt(\"return\", publicAPI.getSelectedData());\n            case 13:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n    return function (_x9, _x10) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  publicAPI.updateSelectionFromXY = function (x, y) {\n    vtkWarningMacro('updateSelectionFromXY is deprecated, please use getSelectedDataForXY');\n    if (model.pickingEnabled) {\n      // Then pick regular representations.\n      if (model.captureOn === CaptureOn.MOUSE_MOVE) {\n        captureBuffers(x, y, x, y);\n      }\n    }\n  };\n  publicAPI.updateSelectionFromMouseEvent = function (event) {\n    vtkWarningMacro('updateSelectionFromMouseEvent is deprecated, please use getSelectedDataForXY');\n    var pageX = event.pageX,\n      pageY = event.pageY;\n    var _model$_apiSpecificRe3 = model._apiSpecificRenderWindow.getCanvas().getBoundingClientRect(),\n      top = _model$_apiSpecificRe3.top,\n      left = _model$_apiSpecificRe3.left,\n      height = _model$_apiSpecificRe3.height;\n    var x = pageX - left;\n    var y = height - (pageY - top);\n    publicAPI.updateSelectionFromXY(x, y);\n  };\n  publicAPI.getSelectedData = function () {\n    if (!model.selections || !model.selections.length) {\n      model.previousSelectedData = null;\n      return {};\n    }\n    var _model$selections$0$g = model.selections[0].getProperties(),\n      propID = _model$selections$0$g.propID,\n      compositeID = _model$selections$0$g.compositeID,\n      prop = _model$selections$0$g.prop;\n    var _model$selections$0$g2 = model.selections[0].getProperties(),\n      widget = _model$selections$0$g2.widget,\n      representation = _model$selections$0$g2.representation; // widget is undefined for handle representation.\n\n    if (model.previousSelectedData && model.previousSelectedData.prop === prop && model.previousSelectedData.widget === widget && model.previousSelectedData.compositeID === compositeID) {\n      model.previousSelectedData.requestCount++;\n      return model.previousSelectedData;\n    }\n    if (propsWeakMap.has(prop)) {\n      var props = propsWeakMap.get(prop);\n      widget = props.widget;\n      representation = props.representation;\n    }\n    if (widget && representation) {\n      var selectedState = representation.getSelectedState(prop, compositeID);\n      model.previousSelectedData = {\n        requestCount: 0,\n        propID: propID,\n        compositeID: compositeID,\n        prop: prop,\n        widget: widget,\n        representation: representation,\n        selectedState: selectedState\n      };\n      return model.previousSelectedData;\n    }\n    model.previousSelectedData = null;\n    return {};\n  };\n  publicAPI.grabFocus = function (widget) {\n    var viewWidget = getViewWidget(widget);\n    if (model.widgetInFocus && model.widgetInFocus !== viewWidget) {\n      model.widgetInFocus.loseFocus();\n    }\n    model.widgetInFocus = viewWidget;\n    if (model.widgetInFocus) {\n      model.widgetInFocus.grabFocus();\n    }\n  };\n  publicAPI.releaseFocus = function () {\n    return publicAPI.grabFocus(null);\n  };\n  var superDelete = publicAPI.delete;\n  publicAPI.delete = function () {\n    while (subscriptions.length) {\n      subscriptions.pop().unsubscribe();\n    }\n    superDelete();\n  };\n} // ----------------------------------------------------------------------------\n// Object factory\n// ----------------------------------------------------------------------------\n\nvar DEFAULT_VALUES = {\n  // _camera: null,\n  // _selector: null,\n  // _currentUpdateSelectionCallID: null,\n  viewId: null,\n  widgets: [],\n  activeWidget: null,\n  renderer: null,\n  viewType: ViewTypes.DEFAULT,\n  isAnimating: false,\n  pickingEnabled: true,\n  selections: null,\n  previousSelectedData: null,\n  widgetInFocus: null,\n  captureOn: CaptureOn.MOUSE_MOVE\n}; // ----------------------------------------------------------------------------\n\nfunction extend(publicAPI, model) {\n  var initialValues = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n  macro.obj(publicAPI, model);\n  macro.setGet(publicAPI, model, ['captureOn', {\n    type: 'enum',\n    name: 'viewType',\n    enum: ViewTypes\n  }]);\n  macro.get(publicAPI, model, ['selections', 'widgets', 'viewId', 'pickingEnabled', 'activeWidget']); // Object specific methods\n\n  vtkWidgetManager(publicAPI, model);\n} // ----------------------------------------------------------------------------\n\nvar newInstance = macro.newInstance(extend, 'vtkWidgetManager'); // ----------------------------------------------------------------------------\n\nvar vtkWidgetManager$1 = {\n  newInstance: newInstance,\n  extend: extend,\n  Constants: WidgetManagerConst,\n  getPixelWorldHeightAtCoord: getPixelWorldHeightAtCoord\n};\nexport { vtkWidgetManager$1 as default, extend, extractRenderingComponents, getPixelWorldHeightAtCoord, newInstance };","map":{"version":3,"names":["_asyncToGenerator","_slicedToArray","_toConsumableArray","_regeneratorRuntime","f","vtkMath","FieldAssociations","macro","WidgetManagerConst","WIDGET_PRIORITY","ViewTypes","RenderingTypes","CaptureOn","vtkErrorMacro","vtkWarningMacro","viewIdCount","extractRenderingComponents","renderer","camera","getActiveCamera","renderWindow","getRenderWindow","interactor","getInteractor","apiSpecificRenderWindow","getView","getPixelWorldHeightAtCoord","worldCoord","displayScaleParams","dispHeightFactor","cameraPosition","cameraDir","isParallel","rendererPixelDims","scale","worldCoordToCamera","subtract","dot","rHeight","vtkWidgetManager","publicAPI","model","viewId","concat","classHierarchy","push","propsWeakMap","WeakMap","subscriptions","updateWidgetWeakMap","widget","representations","getRepresentations","i","length","representation","origin","actors","getActors","j","actor","set","getViewWidget","isA","getWidgetForView","updateDisplayScaleParams","_apiSpecificRenderWindow","_camera","_renderer","_apiSpecificRenderWin","getSize","_apiSpecificRenderWin2","rwW","rwH","_renderer$getViewport","getViewport","_renderer$getViewport2","vxmin","vymin","vxmax","vymax","pixelRatio","getComputedDevicePixelRatio","getPosition","getDirectionOfProjection","getParallelProjection","getParallelScale","Math","tan","radiansFromDegrees","getViewAngle","widgets","forEach","w","getNestedProps","r","getScaleInPixels","setDisplayScaleParams","updateSelection","_x","_x2","_x3","_updateSelection","apply","arguments","mark","_callee3","callData","fromTouchEvent","callID","position","_yield$publicAPI$getS","requestCount","selectedState","activateHandle","wantRender","wrap","_callee3$","_context3","prev","next","_activateHandle","_interactor","invokeLeftButtonRelease","invokeLeftButtonPress","getSelectedDataForXY","x","y","sent","_currentUpdateSelectionCallID","abrupt","setCursor","activeWidget","widgetInFocus","hasFocus","getNestedPickable","getActiveState","deactivateAllHandles","render","stop","handleEvent","_ref","_callee","_args","_callee$","_context","undefined","isAnimating","pickingEnabled","pokedRenderer","Symbol","_x4","updateWidgetForRender","updateRepresentationForRender","renderingType","renderPickingBuffer","PICKING_BUFFER","renderFrontBuffer","FRONT_BUFFER","captureBuffers","_x5","_x6","_x7","_x8","_captureBuffers","_callee4","x1","y1","x2","y2","_callee4$","_context4","_captureInProgress","_capturedBuffers","_selector","getSourceDataAsync","previousSelectedData","enablePicking","renderWidgets","captureOn","MOUSE_RELEASE","_model$_apiSpecificRe","_model$_apiSpecificRe2","h","modified","disablePicking","setRenderer","renderingComponents","Object","assign","moveToProtected","keys","pop","unsubscribe","createSelector","setFieldAssociation","FIELD_ASSOCIATION_POINTS","onWindowResizeEvent","onModified","onStartAnimation","onEndAnimation","onMouseMove","eventData","VOID","onLeftButtonPress","deviceType","touchEvent","addWidgetInternal","viewWidget","setWidgetManager","addActor","addWidget","viewType","initialValues","DEFAULT","indexOf","removeWidgetInternal","removeActor","delete","onWidgetRemoved","removeWidgets","removeWidget","index","splice","isWidgetInFocus","releaseFocus","_ref2","_callee2","capturedRegion","_callee2$","_context2","selections","MOUSE_MOVE","area","generateSelection","getSelectedData","_x9","_x10","updateSelectionFromXY","updateSelectionFromMouseEvent","event","pageX","pageY","_model$_apiSpecificRe3","getCanvas","getBoundingClientRect","top","left","height","_model$selections$0$g","getProperties","propID","compositeID","prop","_model$selections$0$g2","has","props","get","getSelectedState","grabFocus","loseFocus","superDelete","DEFAULT_VALUES","extend","obj","setGet","type","name","enum","newInstance","vtkWidgetManager$1","Constants","default"],"sources":["/home/rakshith/Documents/RemoteRendering/vtk-js-react-app/node_modules/@kitware/vtk.js/Widgets/Core/WidgetManager.js"],"sourcesContent":["import _asyncToGenerator from '@babel/runtime/helpers/asyncToGenerator';\nimport _slicedToArray from '@babel/runtime/helpers/slicedToArray';\nimport _toConsumableArray from '@babel/runtime/helpers/toConsumableArray';\nimport _regeneratorRuntime from '@babel/runtime/regenerator';\nimport { f as vtkMath } from '../../Common/Core/Math/index.js';\nimport { FieldAssociations } from '../../Common/DataModel/DataSet/Constants.js';\nimport macro from '../../macros.js';\nimport WidgetManagerConst from './WidgetManager/Constants.js';\nimport { WIDGET_PRIORITY } from './AbstractWidget/Constants.js';\n\nvar ViewTypes = WidgetManagerConst.ViewTypes,\n    RenderingTypes = WidgetManagerConst.RenderingTypes,\n    CaptureOn = WidgetManagerConst.CaptureOn;\nvar vtkErrorMacro = macro.vtkErrorMacro,\n    vtkWarningMacro = macro.vtkWarningMacro;\nvar viewIdCount = 1; // ----------------------------------------------------------------------------\n// Helper\n// ----------------------------------------------------------------------------\n\nfunction extractRenderingComponents(renderer) {\n  var camera = renderer.getActiveCamera();\n  var renderWindow = renderer.getRenderWindow();\n  var interactor = renderWindow.getInteractor();\n  var apiSpecificRenderWindow = interactor.getView();\n  return {\n    renderer: renderer,\n    renderWindow: renderWindow,\n    interactor: interactor,\n    apiSpecificRenderWindow: apiSpecificRenderWindow,\n    camera: camera\n  };\n}\nfunction getPixelWorldHeightAtCoord(worldCoord, displayScaleParams) {\n  var dispHeightFactor = displayScaleParams.dispHeightFactor,\n      cameraPosition = displayScaleParams.cameraPosition,\n      cameraDir = displayScaleParams.cameraDir,\n      isParallel = displayScaleParams.isParallel,\n      rendererPixelDims = displayScaleParams.rendererPixelDims;\n  var scale = 1;\n\n  if (isParallel) {\n    scale = dispHeightFactor;\n  } else {\n    var worldCoordToCamera = _toConsumableArray(worldCoord);\n\n    vtkMath.subtract(worldCoordToCamera, cameraPosition, worldCoordToCamera);\n    scale = vtkMath.dot(worldCoordToCamera, cameraDir) * dispHeightFactor;\n  }\n\n  var rHeight = rendererPixelDims[1];\n  return scale / rHeight;\n} // ----------------------------------------------------------------------------\n// vtkWidgetManager methods\n// ----------------------------------------------------------------------------\n\nfunction vtkWidgetManager(publicAPI, model) {\n  if (!model.viewId) {\n    model.viewId = \"view-\".concat(viewIdCount++);\n  }\n\n  model.classHierarchy.push('vtkWidgetManager');\n  var propsWeakMap = new WeakMap();\n  var subscriptions = []; // --------------------------------------------------------------------------\n  // API internal\n  // --------------------------------------------------------------------------\n\n  function updateWidgetWeakMap(widget) {\n    var representations = widget.getRepresentations();\n\n    for (var i = 0; i < representations.length; i++) {\n      var representation = representations[i];\n      var origin = {\n        widget: widget,\n        representation: representation\n      };\n      var actors = representation.getActors();\n\n      for (var j = 0; j < actors.length; j++) {\n        var actor = actors[j];\n        propsWeakMap.set(actor, origin);\n      }\n    }\n  }\n\n  function getViewWidget(widget) {\n    return widget && (widget.isA('vtkAbstractWidget') ? widget : widget.getWidgetForView({\n      viewId: model.viewId\n    }));\n  } // --------------------------------------------------------------------------\n  // Widget scaling\n  // --------------------------------------------------------------------------\n\n\n  function updateDisplayScaleParams() {\n    var _apiSpecificRenderWindow = model._apiSpecificRenderWindow,\n        _camera = model._camera,\n        _renderer = model._renderer;\n\n    if (_renderer && _apiSpecificRenderWindow && _camera) {\n      var _apiSpecificRenderWin = _apiSpecificRenderWindow.getSize(),\n          _apiSpecificRenderWin2 = _slicedToArray(_apiSpecificRenderWin, 2),\n          rwW = _apiSpecificRenderWin2[0],\n          rwH = _apiSpecificRenderWin2[1];\n\n      var _renderer$getViewport = _renderer.getViewport(),\n          _renderer$getViewport2 = _slicedToArray(_renderer$getViewport, 4),\n          vxmin = _renderer$getViewport2[0],\n          vymin = _renderer$getViewport2[1],\n          vxmax = _renderer$getViewport2[2],\n          vymax = _renderer$getViewport2[3];\n\n      var pixelRatio = _apiSpecificRenderWindow.getComputedDevicePixelRatio();\n\n      var rendererPixelDims = [rwW * (vxmax - vxmin) / pixelRatio, rwH * (vymax - vymin) / pixelRatio];\n\n      var cameraPosition = _camera.getPosition();\n\n      var cameraDir = _camera.getDirectionOfProjection();\n\n      var isParallel = _camera.getParallelProjection();\n\n      var dispHeightFactor = isParallel ? 2 * _camera.getParallelScale() : 2 * Math.tan(vtkMath.radiansFromDegrees(_camera.getViewAngle()) / 2);\n      model.widgets.forEach(function (w) {\n        w.getNestedProps().forEach(function (r) {\n          if (r.getScaleInPixels()) {\n            r.setDisplayScaleParams({\n              dispHeightFactor: dispHeightFactor,\n              cameraPosition: cameraPosition,\n              cameraDir: cameraDir,\n              isParallel: isParallel,\n              rendererPixelDims: rendererPixelDims\n            });\n          }\n        });\n      });\n    }\n  } // --------------------------------------------------------------------------\n  // API public\n  // --------------------------------------------------------------------------\n\n\n  function updateSelection(_x, _x2, _x3) {\n    return _updateSelection.apply(this, arguments);\n  }\n\n  function _updateSelection() {\n    _updateSelection = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(callData, fromTouchEvent, callID) {\n      var position, _yield$publicAPI$getS, requestCount, selectedState, representation, widget, activateHandle, wantRender, i, w;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              activateHandle = function _activateHandle(w) {\n                if (fromTouchEvent) {\n                  // release any previous left button interaction\n                  model._interactor.invokeLeftButtonRelease(callData);\n                }\n\n                w.activateHandle({\n                  selectedState: selectedState,\n                  representation: representation\n                });\n\n                if (fromTouchEvent) {\n                  // re-trigger the left button press to pick the now-active widget\n                  model._interactor.invokeLeftButtonPress(callData);\n                }\n              };\n\n              position = callData.position;\n              _context3.next = 4;\n              return publicAPI.getSelectedDataForXY(position.x, position.y);\n\n            case 4:\n              _yield$publicAPI$getS = _context3.sent;\n              requestCount = _yield$publicAPI$getS.requestCount;\n              selectedState = _yield$publicAPI$getS.selectedState;\n              representation = _yield$publicAPI$getS.representation;\n              widget = _yield$publicAPI$getS.widget;\n\n              if (!(requestCount || callID !== model._currentUpdateSelectionCallID)) {\n                _context3.next = 11;\n                break;\n              }\n\n              return _context3.abrupt(\"return\");\n\n            case 11:\n              // Default cursor behavior\n              model._apiSpecificRenderWindow.setCursor(widget ? 'pointer' : 'default');\n\n              model.activeWidget = null;\n              wantRender = false;\n\n              if (model.widgetInFocus === widget && widget.hasFocus()) {\n                activateHandle(widget);\n                model.activeWidget = widget;\n                wantRender = true;\n              } else {\n                for (i = 0; i < model.widgets.length; i++) {\n                  w = model.widgets[i];\n\n                  if (w === widget && w.getNestedPickable()) {\n                    activateHandle(w);\n                    model.activeWidget = w;\n                    wantRender = true;\n                  } else {\n                    wantRender || (wantRender = !!w.getActiveState());\n                    w.deactivateAllHandles();\n                  }\n                }\n              }\n\n              if (wantRender) {\n                model._interactor.render();\n              }\n\n            case 16:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n    return _updateSelection.apply(this, arguments);\n  }\n\n  var handleEvent = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(callData) {\n      var fromTouchEvent,\n          callID,\n          _args = arguments;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              fromTouchEvent = _args.length > 1 && _args[1] !== undefined ? _args[1] : false;\n\n              if (!(!model.isAnimating && model.pickingEnabled && callData.pokedRenderer === model._renderer)) {\n                _context.next = 6;\n                break;\n              }\n\n              callID = Symbol('UpdateSelection');\n              model._currentUpdateSelectionCallID = callID;\n              _context.next = 6;\n              return updateSelection(callData, fromTouchEvent, callID);\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleEvent(_x4) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  function updateWidgetForRender(w) {\n    w.updateRepresentationForRender(model.renderingType);\n  }\n\n  function renderPickingBuffer() {\n    model.renderingType = RenderingTypes.PICKING_BUFFER;\n    model.widgets.forEach(updateWidgetForRender);\n  }\n\n  function renderFrontBuffer() {\n    model.renderingType = RenderingTypes.FRONT_BUFFER;\n    model.widgets.forEach(updateWidgetForRender);\n  }\n\n  function captureBuffers(_x5, _x6, _x7, _x8) {\n    return _captureBuffers.apply(this, arguments);\n  }\n\n  function _captureBuffers() {\n    _captureBuffers = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(x1, y1, x2, y2) {\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              if (!model._captureInProgress) {\n                _context4.next = 2;\n                break;\n              }\n\n              return _context4.abrupt(\"return\");\n\n            case 2:\n              model._captureInProgress = true;\n              renderPickingBuffer();\n              model._capturedBuffers = null;\n              _context4.next = 7;\n              return model._selector.getSourceDataAsync(model._renderer, x1, y1, x2, y2);\n\n            case 7:\n              model._capturedBuffers = _context4.sent;\n              model.previousSelectedData = null;\n              renderFrontBuffer();\n              model._captureInProgress = false;\n\n            case 11:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n    return _captureBuffers.apply(this, arguments);\n  }\n\n  publicAPI.enablePicking = function () {\n    model.pickingEnabled = true;\n    publicAPI.renderWidgets();\n  };\n\n  publicAPI.renderWidgets = function () {\n    if (model.pickingEnabled && model.captureOn === CaptureOn.MOUSE_RELEASE) {\n      var _model$_apiSpecificRe = model._apiSpecificRenderWindow.getSize(),\n          _model$_apiSpecificRe2 = _slicedToArray(_model$_apiSpecificRe, 2),\n          w = _model$_apiSpecificRe2[0],\n          h = _model$_apiSpecificRe2[1];\n\n      captureBuffers(0, 0, w, h);\n    }\n\n    renderFrontBuffer();\n    publicAPI.modified();\n  };\n\n  publicAPI.disablePicking = function () {\n    model.pickingEnabled = false;\n  };\n\n  publicAPI.setRenderer = function (renderer) {\n    var renderingComponents = extractRenderingComponents(renderer);\n    Object.assign(model, renderingComponents);\n    macro.moveToProtected({}, model, Object.keys(renderingComponents));\n\n    while (subscriptions.length) {\n      subscriptions.pop().unsubscribe();\n    }\n\n    model._selector = model._apiSpecificRenderWindow.createSelector();\n\n    model._selector.setFieldAssociation(FieldAssociations.FIELD_ASSOCIATION_POINTS);\n\n    subscriptions.push(model._apiSpecificRenderWindow.onWindowResizeEvent(updateDisplayScaleParams));\n    subscriptions.push(model._camera.onModified(updateDisplayScaleParams));\n    updateDisplayScaleParams();\n    subscriptions.push(model._interactor.onStartAnimation(function () {\n      model.isAnimating = true;\n    }));\n    subscriptions.push(model._interactor.onEndAnimation(function () {\n      model.isAnimating = false;\n      publicAPI.renderWidgets();\n    }));\n    subscriptions.push(model._interactor.onMouseMove(function (eventData) {\n      handleEvent(eventData);\n      return macro.VOID;\n    })); // must be handled after widgets, hence the given priority.\n\n    subscriptions.push(model._interactor.onLeftButtonPress(function (eventData) {\n      var deviceType = eventData.deviceType;\n      var touchEvent = deviceType === 'touch' || deviceType === 'pen'; // only try selection if the left button press is from touch.\n\n      if (touchEvent) {\n        handleEvent(eventData, touchEvent);\n      }\n\n      return macro.VOID;\n    }, WIDGET_PRIORITY / 2));\n    publicAPI.modified();\n\n    if (model.pickingEnabled) {\n      publicAPI.enablePicking();\n    }\n  };\n\n  function addWidgetInternal(viewWidget) {\n    viewWidget.setWidgetManager(publicAPI);\n    updateWidgetWeakMap(viewWidget);\n    updateDisplayScaleParams(); // Register to renderer\n\n    model._renderer.addActor(viewWidget);\n  }\n\n  publicAPI.addWidget = function (widget, viewType, initialValues) {\n    if (!model._renderer) {\n      vtkErrorMacro('Widget manager MUST BE link to a view before registering widgets');\n      return null;\n    }\n\n    var viewId = model.viewId,\n        _renderer = model._renderer;\n    var w = widget.getWidgetForView({\n      viewId: viewId,\n      renderer: _renderer,\n      viewType: viewType || ViewTypes.DEFAULT,\n      initialValues: initialValues\n    });\n\n    if (w != null && model.widgets.indexOf(w) === -1) {\n      model.widgets.push(w);\n      addWidgetInternal(w);\n      publicAPI.modified();\n    }\n\n    return w;\n  };\n\n  function removeWidgetInternal(viewWidget) {\n    model._renderer.removeActor(viewWidget);\n\n    viewWidget.delete();\n  }\n\n  function onWidgetRemoved() {\n    model._renderer.getRenderWindow().getInteractor().render();\n\n    publicAPI.renderWidgets();\n  }\n\n  publicAPI.removeWidgets = function () {\n    model.widgets.forEach(removeWidgetInternal);\n    model.widgets = [];\n    model.widgetInFocus = null;\n    onWidgetRemoved();\n  };\n\n  publicAPI.removeWidget = function (widget) {\n    var viewWidget = getViewWidget(widget);\n    var index = model.widgets.indexOf(viewWidget);\n\n    if (index !== -1) {\n      model.widgets.splice(index, 1);\n      var isWidgetInFocus = model.widgetInFocus === viewWidget;\n\n      if (isWidgetInFocus) {\n        publicAPI.releaseFocus();\n      }\n\n      removeWidgetInternal(viewWidget);\n      onWidgetRemoved();\n    }\n  };\n\n  publicAPI.getSelectedDataForXY = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(x, y) {\n      var capturedRegion;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              model.selections = null;\n\n              if (!model.pickingEnabled) {\n                _context2.next = 12;\n                break;\n              }\n\n              if (!(!model._capturedBuffers || model.captureOn === CaptureOn.MOUSE_MOVE)) {\n                _context2.next = 7;\n                break;\n              }\n\n              _context2.next = 5;\n              return captureBuffers(x, y, x, y);\n\n            case 5:\n              _context2.next = 11;\n              break;\n\n            case 7:\n              // or do we need a pixel that is outside the last capture?\n              capturedRegion = model._capturedBuffers.area;\n\n              if (!(x < capturedRegion[0] || x > capturedRegion[2] || y < capturedRegion[1] || y > capturedRegion[3])) {\n                _context2.next = 11;\n                break;\n              }\n\n              _context2.next = 11;\n              return captureBuffers(x, y, x, y);\n\n            case 11:\n              model.selections = model._capturedBuffers.generateSelection(x, y, x, y);\n\n            case 12:\n              return _context2.abrupt(\"return\", publicAPI.getSelectedData());\n\n            case 13:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function (_x9, _x10) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  publicAPI.updateSelectionFromXY = function (x, y) {\n    vtkWarningMacro('updateSelectionFromXY is deprecated, please use getSelectedDataForXY');\n\n    if (model.pickingEnabled) {\n      // Then pick regular representations.\n      if (model.captureOn === CaptureOn.MOUSE_MOVE) {\n        captureBuffers(x, y, x, y);\n      }\n    }\n  };\n\n  publicAPI.updateSelectionFromMouseEvent = function (event) {\n    vtkWarningMacro('updateSelectionFromMouseEvent is deprecated, please use getSelectedDataForXY');\n    var pageX = event.pageX,\n        pageY = event.pageY;\n\n    var _model$_apiSpecificRe3 = model._apiSpecificRenderWindow.getCanvas().getBoundingClientRect(),\n        top = _model$_apiSpecificRe3.top,\n        left = _model$_apiSpecificRe3.left,\n        height = _model$_apiSpecificRe3.height;\n\n    var x = pageX - left;\n    var y = height - (pageY - top);\n    publicAPI.updateSelectionFromXY(x, y);\n  };\n\n  publicAPI.getSelectedData = function () {\n    if (!model.selections || !model.selections.length) {\n      model.previousSelectedData = null;\n      return {};\n    }\n\n    var _model$selections$0$g = model.selections[0].getProperties(),\n        propID = _model$selections$0$g.propID,\n        compositeID = _model$selections$0$g.compositeID,\n        prop = _model$selections$0$g.prop;\n\n    var _model$selections$0$g2 = model.selections[0].getProperties(),\n        widget = _model$selections$0$g2.widget,\n        representation = _model$selections$0$g2.representation; // widget is undefined for handle representation.\n\n\n    if (model.previousSelectedData && model.previousSelectedData.prop === prop && model.previousSelectedData.widget === widget && model.previousSelectedData.compositeID === compositeID) {\n      model.previousSelectedData.requestCount++;\n      return model.previousSelectedData;\n    }\n\n    if (propsWeakMap.has(prop)) {\n      var props = propsWeakMap.get(prop);\n      widget = props.widget;\n      representation = props.representation;\n    }\n\n    if (widget && representation) {\n      var selectedState = representation.getSelectedState(prop, compositeID);\n      model.previousSelectedData = {\n        requestCount: 0,\n        propID: propID,\n        compositeID: compositeID,\n        prop: prop,\n        widget: widget,\n        representation: representation,\n        selectedState: selectedState\n      };\n      return model.previousSelectedData;\n    }\n\n    model.previousSelectedData = null;\n    return {};\n  };\n\n  publicAPI.grabFocus = function (widget) {\n    var viewWidget = getViewWidget(widget);\n\n    if (model.widgetInFocus && model.widgetInFocus !== viewWidget) {\n      model.widgetInFocus.loseFocus();\n    }\n\n    model.widgetInFocus = viewWidget;\n\n    if (model.widgetInFocus) {\n      model.widgetInFocus.grabFocus();\n    }\n  };\n\n  publicAPI.releaseFocus = function () {\n    return publicAPI.grabFocus(null);\n  };\n\n  var superDelete = publicAPI.delete;\n\n  publicAPI.delete = function () {\n    while (subscriptions.length) {\n      subscriptions.pop().unsubscribe();\n    }\n\n    superDelete();\n  };\n} // ----------------------------------------------------------------------------\n// Object factory\n// ----------------------------------------------------------------------------\n\n\nvar DEFAULT_VALUES = {\n  // _camera: null,\n  // _selector: null,\n  // _currentUpdateSelectionCallID: null,\n  viewId: null,\n  widgets: [],\n  activeWidget: null,\n  renderer: null,\n  viewType: ViewTypes.DEFAULT,\n  isAnimating: false,\n  pickingEnabled: true,\n  selections: null,\n  previousSelectedData: null,\n  widgetInFocus: null,\n  captureOn: CaptureOn.MOUSE_MOVE\n}; // ----------------------------------------------------------------------------\n\nfunction extend(publicAPI, model) {\n  var initialValues = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n  macro.obj(publicAPI, model);\n  macro.setGet(publicAPI, model, ['captureOn', {\n    type: 'enum',\n    name: 'viewType',\n    enum: ViewTypes\n  }]);\n  macro.get(publicAPI, model, ['selections', 'widgets', 'viewId', 'pickingEnabled', 'activeWidget']); // Object specific methods\n\n  vtkWidgetManager(publicAPI, model);\n} // ----------------------------------------------------------------------------\n\nvar newInstance = macro.newInstance(extend, 'vtkWidgetManager'); // ----------------------------------------------------------------------------\n\nvar vtkWidgetManager$1 = {\n  newInstance: newInstance,\n  extend: extend,\n  Constants: WidgetManagerConst,\n  getPixelWorldHeightAtCoord: getPixelWorldHeightAtCoord\n};\n\nexport { vtkWidgetManager$1 as default, extend, extractRenderingComponents, getPixelWorldHeightAtCoord, newInstance };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}