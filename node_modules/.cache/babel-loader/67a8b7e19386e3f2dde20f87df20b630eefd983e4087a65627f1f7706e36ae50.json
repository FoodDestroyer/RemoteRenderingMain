{"ast":null,"code":"import _toConsumableArray from '@babel/runtime/helpers/toConsumableArray';\nimport _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport macro from '../../../macros.js';\nimport { f as vtkMath } from '../../../Common/Core/Math/index.js';\nimport vtkBoundingBox from '../../../Common/DataModel/BoundingBox.js';\nimport vtkPlane from '../../../Common/DataModel/Plane.js';\nimport { ShapeBehavior, BehaviorCategory, TextPosition } from './Constants.js';\nimport { boundPlane } from '../ResliceCursorWidget/helpers.js';\nimport { vec3 } from 'gl-matrix';\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n  return target;\n}\nvar vtkErrorMacro = macro.vtkErrorMacro;\nvar EPSILON = 1e-6;\nfunction widgetBehavior(publicAPI, model) {\n  model.classHierarchy.push('vtkShapeWidgetProp');\n  model._isDragging = false;\n  model.keysDown = {};\n  var superClass = _objectSpread({}, publicAPI); // --------------------------------------------------------------------------\n  // Display 2D\n  // --------------------------------------------------------------------------\n\n  publicAPI.setDisplayCallback = function (callback) {\n    return model.representations[0].setDisplayCallback(callback);\n  };\n  publicAPI.setText = function (text) {\n    model.widgetState.getText().setText(text); // Recompute position\n\n    model._interactor.render();\n  }; // --------------------------------------------------------------------------\n  // Public methods\n  // --------------------------------------------------------------------------\n\n  publicAPI.setResetAfterPointPlacement = model._factory.setResetAfterPointPlacement;\n  publicAPI.getResetAfterPointPlacement = model._factory.getResetAfterPointPlacement;\n  publicAPI.setModifierBehavior = model._factory.setModifierBehavior;\n  publicAPI.getModifierBehavior = model._factory.getModifierBehavior;\n  publicAPI.isBehaviorActive = function (category, flag) {\n    return Object.keys(model.keysDown).some(function (key) {\n      return model.keysDown[key] && publicAPI.getModifierBehavior()[key] && publicAPI.getModifierBehavior()[key][category] === flag;\n    });\n  };\n  publicAPI.isOppositeBehaviorActive = function (category, flag) {\n    return Object.values(ShapeBehavior[category]).some(function (flagToTry) {\n      return flag !== flagToTry && publicAPI.isBehaviorActive(category, flagToTry);\n    });\n  };\n  publicAPI.getActiveBehaviorFromCategory = function (category) {\n    return Object.values(ShapeBehavior[category]).find(function (flag) {\n      return publicAPI.isBehaviorActive(category, flag) || !publicAPI.isOppositeBehaviorActive(category, flag) && publicAPI.getModifierBehavior().None[category] === flag;\n    });\n  };\n  publicAPI.isRatioFixed = function () {\n    return publicAPI.getActiveBehaviorFromCategory(BehaviorCategory.RATIO) === ShapeBehavior[BehaviorCategory.RATIO].FIXED;\n  };\n  publicAPI.isDraggingEnabled = function () {\n    var behavior = publicAPI.getActiveBehaviorFromCategory(BehaviorCategory.PLACEMENT);\n    return behavior === ShapeBehavior[BehaviorCategory.PLACEMENT].DRAG || behavior === ShapeBehavior[BehaviorCategory.PLACEMENT].CLICK_AND_DRAG;\n  };\n  publicAPI.isDraggingForced = function () {\n    return publicAPI.isBehaviorActive(BehaviorCategory.PLACEMENT, ShapeBehavior[BehaviorCategory.PLACEMENT].DRAG) || publicAPI.getModifierBehavior().None[BehaviorCategory.PLACEMENT] === ShapeBehavior[BehaviorCategory.PLACEMENT].DRAG;\n  };\n  publicAPI.getPoint1 = function () {\n    return model.point1;\n  };\n  publicAPI.getPoint2 = function () {\n    return model.point2;\n  };\n  publicAPI.setPoints = function (point1, point2) {\n    model.point1 = point1;\n    model.point2 = point2;\n    model.point1Handle.setOrigin(model.point1);\n    model.point2Handle.setOrigin(model.point2);\n    publicAPI.updateShapeBounds();\n  }; // This method is to be called to place the first point\n  // for the first time. It is not inlined so that\n  // the user can specify himself where the first point\n  // is right after publicAPI.grabFocus() without waiting\n  // for interactions.\n\n  publicAPI.placePoint1 = function (point) {\n    if (model.hasFocus) {\n      publicAPI.setPoints(point, point);\n      model.point1Handle.deactivate();\n      model.point2Handle.activate();\n      model.activeState = model.point2Handle;\n      model.point2Handle.setVisible(true);\n      model.widgetState.getText().setVisible(true);\n      publicAPI.updateShapeBounds();\n      model.shapeHandle.setVisible(true);\n    }\n  };\n  publicAPI.placePoint2 = function (point2) {\n    if (model.hasFocus) {\n      model.point2 = point2;\n      model.point2Handle.setOrigin(model.point2);\n      publicAPI.updateShapeBounds();\n    }\n  }; // --------------------------------------------------------------------------\n  // Private methods\n  // --------------------------------------------------------------------------\n\n  publicAPI.makeSquareFromPoints = function (point1, point2) {\n    var diagonal = [0, 0, 0];\n    vec3.subtract(diagonal, point2, point1);\n    var dir = model.shapeHandle.getDirection();\n    var right = model.shapeHandle.getRight();\n    var up = model.shapeHandle.getUp();\n    var dirComponent = vec3.dot(diagonal, dir);\n    var rightComponent = vec3.dot(diagonal, right);\n    var upComponent = vec3.dot(diagonal, up);\n    var absRightComponent = Math.abs(rightComponent);\n    var absUpComponent = Math.abs(upComponent);\n    if (absRightComponent < EPSILON) {\n      rightComponent = upComponent;\n    } else if (absUpComponent < EPSILON) {\n      upComponent = rightComponent;\n    } else if (absRightComponent > absUpComponent) {\n      upComponent = upComponent / absUpComponent * absRightComponent;\n    } else {\n      rightComponent = rightComponent / absRightComponent * absUpComponent;\n    }\n    return [point1[0] + rightComponent * right[0] + upComponent * up[0] + dirComponent * dir[0], point1[1] + rightComponent * right[1] + upComponent * up[1] + dirComponent * dir[1], point1[2] + rightComponent * right[2] + upComponent * up[2] + dirComponent * dir[2]];\n  };\n  var getCornersFromRadius = function getCornersFromRadius(center, pointOnCircle) {\n    var radius = vec3.distance(center, pointOnCircle);\n    var up = model.shapeHandle.getUp();\n    var right = model.shapeHandle.getRight();\n    var point1 = [center[0] + (up[0] - right[0]) * radius, center[1] + (up[1] - right[1]) * radius, center[2] + (up[2] - right[2]) * radius];\n    var point2 = [center[0] + (right[0] - up[0]) * radius, center[1] + (right[1] - up[1]) * radius, center[2] + (right[2] - up[2]) * radius];\n    return {\n      point1: point1,\n      point2: point2\n    };\n  };\n  var getCornersFromDiameter = function getCornersFromDiameter(point1, point2) {\n    var center = [0.5 * (point1[0] + point2[0]), 0.5 * (point1[1] + point2[1]), 0.5 * (point1[2] + point2[2])];\n    return getCornersFromRadius(center, point1);\n  }; // TODO: move to ShapeWidget/index.js\n\n  publicAPI.getBounds = function () {\n    return model.point1 && model.point2 ? vtkBoundingBox.addPoints(vtkBoundingBox.reset([]), [model.point1, model.point2]) : vtkMath.uninitializeBounds([]);\n  }; // To be reimplemented by subclass\n\n  publicAPI.setCorners = function (point1, point2) {\n    publicAPI.updateTextPosition(point1, point2);\n  };\n  publicAPI.updateShapeBounds = function () {\n    if (model.point1 && model.point2) {\n      var point1 = _toConsumableArray(model.point1);\n      var point2 = _toConsumableArray(model.point2);\n      if (publicAPI.isRatioFixed()) {\n        point2 = publicAPI.makeSquareFromPoints(point1, point2);\n      }\n      switch (publicAPI.getActiveBehaviorFromCategory(BehaviorCategory.POINTS)) {\n        case ShapeBehavior[BehaviorCategory.POINTS].CORNER_TO_CORNER:\n          {\n            publicAPI.setCorners(point1, point2);\n            break;\n          }\n        case ShapeBehavior[BehaviorCategory.POINTS].CENTER_TO_CORNER:\n          {\n            var diagonal = [0, 0, 0];\n            vec3.subtract(diagonal, point1, point2);\n            vec3.add(point1, point1, diagonal);\n            publicAPI.setCorners(point1, point2);\n            break;\n          }\n        case ShapeBehavior[BehaviorCategory.POINTS].RADIUS:\n          {\n            var points = getCornersFromRadius(point1, point2);\n            publicAPI.setCorners(points.point1, points.point2);\n            break;\n          }\n        case ShapeBehavior[BehaviorCategory.POINTS].DIAMETER:\n          {\n            var _points = getCornersFromDiameter(point1, point2);\n            publicAPI.setCorners(_points.point1, _points.point2);\n            break;\n          }\n        default:\n          // This should never be executed\n          vtkErrorMacro('vtk internal error');\n      }\n    }\n  };\n  var computePositionVector = function computePositionVector(textPosition, minPoint, maxPoint) {\n    var positionVector = [0, 0, 0];\n    switch (textPosition) {\n      case TextPosition.MIN:\n        break;\n      case TextPosition.MAX:\n        vtkMath.subtract(maxPoint, minPoint, positionVector);\n        break;\n      case TextPosition.CENTER:\n      default:\n        vtkMath.subtract(maxPoint, minPoint, positionVector);\n        vtkMath.multiplyScalar(positionVector, 0.5);\n        break;\n    }\n    return positionVector;\n  };\n  var computeTextPosition = function computeTextPosition(worldBounds, textPosition) {\n    var _model$_apiSpecificRe, _model$_apiSpecificRe2, _model$_apiSpecificRe5;\n    var worldMargin = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n    var viewPlaneOrigin = vtkBoundingBox.getCenter(worldBounds);\n    var viewPlaneNormal = model._renderer.getActiveCamera().getDirectionOfProjection();\n    var viewUp = model._renderer.getActiveCamera().getViewUp();\n    var positionMargin = Array.isArray(worldMargin) ? _toConsumableArray(worldMargin) : [worldMargin, worldMargin, viewPlaneOrigin ? worldMargin : 0]; // Map bounds from world positions to display positions\n\n    var minPoint = (_model$_apiSpecificRe = model._apiSpecificRenderWindow).worldToDisplay.apply(_model$_apiSpecificRe, _toConsumableArray(vtkBoundingBox.getMinPoint(worldBounds)).concat([model._renderer]));\n    var maxPoint = (_model$_apiSpecificRe2 = model._apiSpecificRenderWindow).worldToDisplay.apply(_model$_apiSpecificRe2, _toConsumableArray(vtkBoundingBox.getMaxPoint(worldBounds)).concat([model._renderer]));\n    var displayBounds = vtkBoundingBox.addPoints(vtkBoundingBox.reset([]), [minPoint, maxPoint]);\n    var planeOrigin = [];\n    var p1 = [];\n    var p2 = [];\n    var p3 = []; // If we are in a 2D projection\n\n    if (viewPlaneOrigin && viewPlaneNormal && viewUp && vtkBoundingBox.intersectPlane(displayBounds, viewPlaneOrigin, viewPlaneNormal)) {\n      var _model$_apiSpecificRe3, _model$_apiSpecificRe4;\n\n      // Map plane origin from world positions to display positions\n      var displayPlaneOrigin = (_model$_apiSpecificRe3 = model._apiSpecificRenderWindow).worldToDisplay.apply(_model$_apiSpecificRe3, _toConsumableArray(viewPlaneOrigin).concat([model._renderer])); // Map plane normal from world positions to display positions\n\n      var planeNormalPoint = vtkMath.add(viewPlaneOrigin, viewPlaneNormal, []);\n      var displayPlaneNormalPoint = (_model$_apiSpecificRe4 = model._apiSpecificRenderWindow).worldToDisplay.apply(_model$_apiSpecificRe4, _toConsumableArray(planeNormalPoint).concat([model._renderer]));\n      var displayPlaneNormal = vtkMath.subtract(displayPlaneNormalPoint, displayPlaneOrigin, []); // Project view plane into bounding box\n\n      var largeDistance = 10 * vtkBoundingBox.getDiagonalLength(displayBounds);\n      vtkPlane.projectPoint(vtkBoundingBox.getCenter(displayBounds), displayPlaneOrigin, displayPlaneNormal, planeOrigin);\n      var planeU = vtkMath.cross(viewUp, displayPlaneNormal, []);\n      vtkMath.normalize(planeU); // u\n\n      vtkMath.normalize(viewUp); // v\n\n      vtkMath.normalize(displayPlaneNormal); // w\n\n      vtkMath.multiplyAccumulate(planeOrigin, viewUp, -largeDistance, planeOrigin);\n      vtkMath.multiplyAccumulate(planeOrigin, planeU, -largeDistance, planeOrigin);\n      p1 = vtkMath.multiplyAccumulate(planeOrigin, planeU, 2 * largeDistance, []);\n      p2 = vtkMath.multiplyAccumulate(planeOrigin, viewUp, 2 * largeDistance, []);\n      p3 = planeOrigin;\n      boundPlane(displayBounds, planeOrigin, p1, p2);\n    } else {\n      planeOrigin = [displayBounds[0], displayBounds[2], displayBounds[4]];\n      p1 = [displayBounds[1], displayBounds[2], displayBounds[4]];\n      p2 = [displayBounds[0], displayBounds[3], displayBounds[4]];\n      p3 = [displayBounds[0], displayBounds[2], displayBounds[5]];\n    } // Compute horizontal, vertical and depth position\n\n    var u = computePositionVector(textPosition[0], planeOrigin, p1);\n    var v = computePositionVector(textPosition[1], planeOrigin, p2);\n    var w = computePositionVector(textPosition[2], planeOrigin, p3);\n    var finalPosition = planeOrigin;\n    vtkMath.add(finalPosition, u, finalPosition);\n    vtkMath.add(finalPosition, v, finalPosition);\n    vtkMath.add(finalPosition, w, finalPosition);\n    vtkMath.add(finalPosition, positionMargin, finalPosition);\n    return (_model$_apiSpecificRe5 = model._apiSpecificRenderWindow).displayToWorld.apply(_model$_apiSpecificRe5, finalPosition.concat([model._renderer]));\n  };\n  publicAPI.updateTextPosition = function (point1, point2) {\n    var bounds = vtkBoundingBox.addPoints(vtkBoundingBox.reset([]), [point1, point2]);\n    var screenPosition = computeTextPosition(bounds, model.widgetState.getTextPosition(), model.widgetState.getTextWorldMargin());\n    var textHandle = model.widgetState.getText();\n    textHandle.setOrigin(screenPosition);\n  };\n  /*\n   * If the widget has the focus, this method reset the widget\n   * to it's state just after it grabbed the focus. Otherwise\n   * it resets the widget to its state before it grabbed the focus.\n   */\n\n  publicAPI.reset = function () {\n    model.point1 = null;\n    model.point2 = null;\n    model.widgetState.getText().setVisible(false);\n    model.point1Handle.setOrigin(null);\n    model.point2Handle.setOrigin(null);\n    model.shapeHandle.setOrigin(null);\n    model.shapeHandle.setVisible(false);\n    model.point2Handle.setVisible(false);\n    model.point2Handle.deactivate();\n    if (model.hasFocus) {\n      model.point1Handle.activate();\n      model.activeState = model.point1Handle;\n    } else {\n      model.point1Handle.setVisible(false);\n      model.point1Handle.deactivate();\n      model.activeState = null;\n    }\n    publicAPI.updateShapeBounds();\n  }; // --------------------------------------------------------------------------\n  // Interactor events\n  // --------------------------------------------------------------------------\n\n  publicAPI.handleMouseMove = function (callData) {\n    var _model$activeState$ge, _model$activeState, _model$activeState$ge2;\n    var manipulator = (_model$activeState$ge = (_model$activeState = model.activeState) === null || _model$activeState === void 0 ? void 0 : (_model$activeState$ge2 = _model$activeState.getManipulator) === null || _model$activeState$ge2 === void 0 ? void 0 : _model$activeState$ge2.call(_model$activeState)) !== null && _model$activeState$ge !== void 0 ? _model$activeState$ge : model.manipulator;\n    if (!manipulator || !model.activeState || !model.activeState.getActive() || !model.pickable || !model.dragable) {\n      return macro.VOID;\n    }\n    if (!model.point2) {\n      // Update orientation to match the camera's plane\n      // if the corners are not yet placed\n      var normal = model._camera.getDirectionOfProjection();\n      var up = model._camera.getViewUp();\n      var right = [];\n      vec3.cross(right, up, normal);\n      model.shapeHandle.setUp(up);\n      model.shapeHandle.setRight(right);\n      model.shapeHandle.setDirection(normal);\n    }\n    var _manipulator$handleEv = manipulator.handleEvent(callData, model._apiSpecificRenderWindow),\n      worldCoords = _manipulator$handleEv.worldCoords;\n    if (!worldCoords.length) {\n      return macro.VOID;\n    }\n    if (model.hasFocus) {\n      if (!model.point1) {\n        model.point1Handle.setOrigin(worldCoords);\n      } else {\n        model.point2Handle.setOrigin(worldCoords);\n        model.point2 = worldCoords;\n        publicAPI.updateShapeBounds();\n        publicAPI.invokeInteractionEvent();\n      }\n    } else if (model._isDragging) {\n      if (model.activeState === model.point1Handle) {\n        model.point1Handle.setOrigin(worldCoords);\n        model.point1 = worldCoords;\n      } else {\n        model.point2Handle.setOrigin(worldCoords);\n        model.point2 = worldCoords;\n      }\n      publicAPI.updateShapeBounds();\n      publicAPI.invokeInteractionEvent();\n    }\n    return model.hasFocus || model._isDragging ? macro.EVENT_ABORT : macro.VOID;\n  }; // --------------------------------------------------------------------------\n  // Left click: Add point / End interaction\n  // --------------------------------------------------------------------------\n\n  publicAPI.handleLeftButtonPress = function (e) {\n    var _model$activeState$ge3, _model$activeState2, _model$activeState2$g;\n    var manipulator = (_model$activeState$ge3 = (_model$activeState2 = model.activeState) === null || _model$activeState2 === void 0 ? void 0 : (_model$activeState2$g = _model$activeState2.getManipulator) === null || _model$activeState2$g === void 0 ? void 0 : _model$activeState2$g.call(_model$activeState2)) !== null && _model$activeState$ge3 !== void 0 ? _model$activeState$ge3 : model.manipulator;\n    if (!model.activeState || !model.activeState.getActive() || !model.pickable || !manipulator) {\n      return macro.VOID;\n    }\n    if (model.hasFocus) {\n      var _manipulator$handleEv2 = manipulator.handleEvent(e, model._apiSpecificRenderWindow),\n        worldCoords = _manipulator$handleEv2.worldCoords;\n      if (!model.point1) {\n        model.point1Handle.setOrigin(worldCoords);\n        publicAPI.placePoint1(model.point1Handle.getOrigin());\n        publicAPI.invokeStartInteractionEvent();\n      } else {\n        model.point2Handle.setOrigin(worldCoords);\n        publicAPI.placePoint2(model.point2Handle.getOrigin());\n        publicAPI.invokeInteractionEvent();\n        publicAPI.invokeEndInteractionEvent();\n        if (publicAPI.getResetAfterPointPlacement()) {\n          publicAPI.reset();\n        } else {\n          publicAPI.loseFocus();\n        }\n      }\n      return macro.EVENT_ABORT;\n    }\n    if (model.point1 && (model.activeState === model.point1Handle || model.activeState === model.point2Handle) && model.dragable) {\n      model._isDragging = true;\n      model._apiSpecificRenderWindow.setCursor('grabbing');\n      model._interactor.requestAnimation(publicAPI);\n    }\n    publicAPI.invokeStartInteractionEvent();\n    return macro.EVENT_ABORT;\n  }; // --------------------------------------------------------------------------\n  // Left release: Maybe end interaction\n  // --------------------------------------------------------------------------\n\n  publicAPI.handleLeftButtonRelease = function (e) {\n    if (model._isDragging) {\n      model._isDragging = false;\n      model._apiSpecificRenderWindow.setCursor('pointer');\n      model.widgetState.deactivate();\n      model._interactor.cancelAnimation(publicAPI);\n      publicAPI.invokeEndInteractionEvent();\n      return macro.EVENT_ABORT;\n    }\n    if (!model.hasFocus || !model.pickable) {\n      return macro.VOID;\n    }\n    var viewSize = model._apiSpecificRenderWindow.getSize();\n    if (e.position.x < 0 || e.position.x > viewSize[0] - 1 || e.position.y < 0 || e.position.y > viewSize[1] - 1) {\n      return macro.VOID;\n    }\n    if (model.point1) {\n      publicAPI.placePoint2(model.point2Handle.getOrigin());\n      if (publicAPI.isDraggingEnabled()) {\n        var distance = vec3.squaredDistance(model.point1, model.point2);\n        var maxDistance = 100;\n        if (distance > maxDistance || publicAPI.isDraggingForced()) {\n          publicAPI.invokeInteractionEvent();\n          publicAPI.invokeEndInteractionEvent();\n          if (publicAPI.getResetAfterPointPlacement()) {\n            publicAPI.reset();\n          } else {\n            publicAPI.loseFocus();\n          }\n        }\n      }\n    }\n    return macro.EVENT_ABORT;\n  }; // --------------------------------------------------------------------------\n  // Register key presses/releases\n  // --------------------------------------------------------------------------\n\n  publicAPI.handleKeyDown = function (_ref) {\n    var key = _ref.key;\n    if (key === 'Escape') {\n      if (model.hasFocus) {\n        publicAPI.reset();\n        publicAPI.loseFocus();\n        publicAPI.invokeEndInteractionEvent();\n      }\n    } else {\n      model.keysDown[key] = true;\n    }\n    if (model.hasFocus) {\n      if (model.point1) {\n        model.point2 = model.point2Handle.getOrigin();\n        publicAPI.updateShapeBounds();\n      }\n    }\n  };\n  publicAPI.handleKeyUp = function (_ref2) {\n    var key = _ref2.key;\n    model.keysDown[key] = false;\n    if (model.hasFocus) {\n      if (model.point1) {\n        model.point2 = model.point2Handle.getOrigin();\n        publicAPI.updateShapeBounds();\n      }\n    }\n  }; // --------------------------------------------------------------------------\n  // Focus API - follow mouse when widget has focus\n  // --------------------------------------------------------------------------\n\n  publicAPI.grabFocus = function () {\n    if (!model.hasFocus) {\n      publicAPI.reset();\n      model.point1Handle.activate();\n      model.activeState = model.point1Handle;\n      model.point1Handle.setVisible(true);\n      model.shapeHandle.setVisible(false);\n      model._interactor.requestAnimation(publicAPI);\n    }\n    superClass.grabFocus();\n  }; // --------------------------------------------------------------------------\n\n  publicAPI.loseFocus = function () {\n    if (model.hasFocus) {\n      model._interactor.cancelAnimation(publicAPI);\n    }\n    if (!model.point1) {\n      model.point1Handle.setVisible(false);\n      model.point2Handle.setVisible(false);\n    }\n    model.widgetState.deactivate();\n    model.point1Handle.deactivate();\n    model.point2Handle.deactivate();\n    model.activeState = null;\n    model._interactor.render();\n    model._widgetManager.enablePicking();\n    superClass.loseFocus();\n  };\n}\nexport { widgetBehavior as default };","map":{"version":3,"names":["_toConsumableArray","_defineProperty","macro","f","vtkMath","vtkBoundingBox","vtkPlane","ShapeBehavior","BehaviorCategory","TextPosition","boundPlane","vec3","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","getOwnPropertyDescriptors","defineProperties","defineProperty","vtkErrorMacro","EPSILON","widgetBehavior","publicAPI","model","classHierarchy","_isDragging","keysDown","superClass","setDisplayCallback","callback","representations","setText","text","widgetState","getText","_interactor","render","setResetAfterPointPlacement","_factory","getResetAfterPointPlacement","setModifierBehavior","getModifierBehavior","isBehaviorActive","category","flag","some","isOppositeBehaviorActive","values","flagToTry","getActiveBehaviorFromCategory","find","None","isRatioFixed","RATIO","FIXED","isDraggingEnabled","behavior","PLACEMENT","DRAG","CLICK_AND_DRAG","isDraggingForced","getPoint1","point1","getPoint2","point2","setPoints","point1Handle","setOrigin","point2Handle","updateShapeBounds","placePoint1","point","hasFocus","deactivate","activate","activeState","setVisible","shapeHandle","placePoint2","makeSquareFromPoints","diagonal","subtract","dir","getDirection","right","getRight","up","getUp","dirComponent","dot","rightComponent","upComponent","absRightComponent","Math","abs","absUpComponent","getCornersFromRadius","center","pointOnCircle","radius","distance","getCornersFromDiameter","getBounds","addPoints","reset","uninitializeBounds","setCorners","updateTextPosition","POINTS","CORNER_TO_CORNER","CENTER_TO_CORNER","add","RADIUS","points","DIAMETER","_points","computePositionVector","textPosition","minPoint","maxPoint","positionVector","MIN","MAX","CENTER","multiplyScalar","computeTextPosition","worldBounds","_model$_apiSpecificRe","_model$_apiSpecificRe2","_model$_apiSpecificRe5","worldMargin","undefined","viewPlaneOrigin","getCenter","viewPlaneNormal","_renderer","getActiveCamera","getDirectionOfProjection","viewUp","getViewUp","positionMargin","Array","isArray","_apiSpecificRenderWindow","worldToDisplay","getMinPoint","concat","getMaxPoint","displayBounds","planeOrigin","p1","p2","p3","intersectPlane","_model$_apiSpecificRe3","_model$_apiSpecificRe4","displayPlaneOrigin","planeNormalPoint","displayPlaneNormalPoint","displayPlaneNormal","largeDistance","getDiagonalLength","projectPoint","planeU","cross","normalize","multiplyAccumulate","u","v","w","finalPosition","displayToWorld","bounds","screenPosition","getTextPosition","getTextWorldMargin","textHandle","handleMouseMove","callData","_model$activeState$ge","_model$activeState","_model$activeState$ge2","manipulator","getManipulator","call","getActive","pickable","dragable","VOID","normal","_camera","setUp","setRight","setDirection","_manipulator$handleEv","handleEvent","worldCoords","invokeInteractionEvent","EVENT_ABORT","handleLeftButtonPress","e","_model$activeState$ge3","_model$activeState2","_model$activeState2$g","_manipulator$handleEv2","getOrigin","invokeStartInteractionEvent","invokeEndInteractionEvent","loseFocus","setCursor","requestAnimation","handleLeftButtonRelease","cancelAnimation","viewSize","getSize","position","x","y","squaredDistance","maxDistance","handleKeyDown","_ref","handleKeyUp","_ref2","grabFocus","_widgetManager","enablePicking","default"],"sources":["/home/rakshith/Documents/RemoteRendering/vtk-js-react-app/node_modules/@kitware/vtk.js/Widgets/Widgets3D/ShapeWidget/behavior.js"],"sourcesContent":["import _toConsumableArray from '@babel/runtime/helpers/toConsumableArray';\nimport _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport macro from '../../../macros.js';\nimport { f as vtkMath } from '../../../Common/Core/Math/index.js';\nimport vtkBoundingBox from '../../../Common/DataModel/BoundingBox.js';\nimport vtkPlane from '../../../Common/DataModel/Plane.js';\nimport { ShapeBehavior, BehaviorCategory, TextPosition } from './Constants.js';\nimport { boundPlane } from '../ResliceCursorWidget/helpers.js';\nimport { vec3 } from 'gl-matrix';\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nvar vtkErrorMacro = macro.vtkErrorMacro;\nvar EPSILON = 1e-6;\nfunction widgetBehavior(publicAPI, model) {\n  model.classHierarchy.push('vtkShapeWidgetProp');\n  model._isDragging = false;\n  model.keysDown = {};\n\n  var superClass = _objectSpread({}, publicAPI); // --------------------------------------------------------------------------\n  // Display 2D\n  // --------------------------------------------------------------------------\n\n\n  publicAPI.setDisplayCallback = function (callback) {\n    return model.representations[0].setDisplayCallback(callback);\n  };\n\n  publicAPI.setText = function (text) {\n    model.widgetState.getText().setText(text); // Recompute position\n\n    model._interactor.render();\n  }; // --------------------------------------------------------------------------\n  // Public methods\n  // --------------------------------------------------------------------------\n\n\n  publicAPI.setResetAfterPointPlacement = model._factory.setResetAfterPointPlacement;\n  publicAPI.getResetAfterPointPlacement = model._factory.getResetAfterPointPlacement;\n  publicAPI.setModifierBehavior = model._factory.setModifierBehavior;\n  publicAPI.getModifierBehavior = model._factory.getModifierBehavior;\n\n  publicAPI.isBehaviorActive = function (category, flag) {\n    return Object.keys(model.keysDown).some(function (key) {\n      return model.keysDown[key] && publicAPI.getModifierBehavior()[key] && publicAPI.getModifierBehavior()[key][category] === flag;\n    });\n  };\n\n  publicAPI.isOppositeBehaviorActive = function (category, flag) {\n    return Object.values(ShapeBehavior[category]).some(function (flagToTry) {\n      return flag !== flagToTry && publicAPI.isBehaviorActive(category, flagToTry);\n    });\n  };\n\n  publicAPI.getActiveBehaviorFromCategory = function (category) {\n    return Object.values(ShapeBehavior[category]).find(function (flag) {\n      return publicAPI.isBehaviorActive(category, flag) || !publicAPI.isOppositeBehaviorActive(category, flag) && publicAPI.getModifierBehavior().None[category] === flag;\n    });\n  };\n\n  publicAPI.isRatioFixed = function () {\n    return publicAPI.getActiveBehaviorFromCategory(BehaviorCategory.RATIO) === ShapeBehavior[BehaviorCategory.RATIO].FIXED;\n  };\n\n  publicAPI.isDraggingEnabled = function () {\n    var behavior = publicAPI.getActiveBehaviorFromCategory(BehaviorCategory.PLACEMENT);\n    return behavior === ShapeBehavior[BehaviorCategory.PLACEMENT].DRAG || behavior === ShapeBehavior[BehaviorCategory.PLACEMENT].CLICK_AND_DRAG;\n  };\n\n  publicAPI.isDraggingForced = function () {\n    return publicAPI.isBehaviorActive(BehaviorCategory.PLACEMENT, ShapeBehavior[BehaviorCategory.PLACEMENT].DRAG) || publicAPI.getModifierBehavior().None[BehaviorCategory.PLACEMENT] === ShapeBehavior[BehaviorCategory.PLACEMENT].DRAG;\n  };\n\n  publicAPI.getPoint1 = function () {\n    return model.point1;\n  };\n\n  publicAPI.getPoint2 = function () {\n    return model.point2;\n  };\n\n  publicAPI.setPoints = function (point1, point2) {\n    model.point1 = point1;\n    model.point2 = point2;\n    model.point1Handle.setOrigin(model.point1);\n    model.point2Handle.setOrigin(model.point2);\n    publicAPI.updateShapeBounds();\n  }; // This method is to be called to place the first point\n  // for the first time. It is not inlined so that\n  // the user can specify himself where the first point\n  // is right after publicAPI.grabFocus() without waiting\n  // for interactions.\n\n\n  publicAPI.placePoint1 = function (point) {\n    if (model.hasFocus) {\n      publicAPI.setPoints(point, point);\n      model.point1Handle.deactivate();\n      model.point2Handle.activate();\n      model.activeState = model.point2Handle;\n      model.point2Handle.setVisible(true);\n      model.widgetState.getText().setVisible(true);\n      publicAPI.updateShapeBounds();\n      model.shapeHandle.setVisible(true);\n    }\n  };\n\n  publicAPI.placePoint2 = function (point2) {\n    if (model.hasFocus) {\n      model.point2 = point2;\n      model.point2Handle.setOrigin(model.point2);\n      publicAPI.updateShapeBounds();\n    }\n  }; // --------------------------------------------------------------------------\n  // Private methods\n  // --------------------------------------------------------------------------\n\n\n  publicAPI.makeSquareFromPoints = function (point1, point2) {\n    var diagonal = [0, 0, 0];\n    vec3.subtract(diagonal, point2, point1);\n    var dir = model.shapeHandle.getDirection();\n    var right = model.shapeHandle.getRight();\n    var up = model.shapeHandle.getUp();\n    var dirComponent = vec3.dot(diagonal, dir);\n    var rightComponent = vec3.dot(diagonal, right);\n    var upComponent = vec3.dot(diagonal, up);\n    var absRightComponent = Math.abs(rightComponent);\n    var absUpComponent = Math.abs(upComponent);\n\n    if (absRightComponent < EPSILON) {\n      rightComponent = upComponent;\n    } else if (absUpComponent < EPSILON) {\n      upComponent = rightComponent;\n    } else if (absRightComponent > absUpComponent) {\n      upComponent = upComponent / absUpComponent * absRightComponent;\n    } else {\n      rightComponent = rightComponent / absRightComponent * absUpComponent;\n    }\n\n    return [point1[0] + rightComponent * right[0] + upComponent * up[0] + dirComponent * dir[0], point1[1] + rightComponent * right[1] + upComponent * up[1] + dirComponent * dir[1], point1[2] + rightComponent * right[2] + upComponent * up[2] + dirComponent * dir[2]];\n  };\n\n  var getCornersFromRadius = function getCornersFromRadius(center, pointOnCircle) {\n    var radius = vec3.distance(center, pointOnCircle);\n    var up = model.shapeHandle.getUp();\n    var right = model.shapeHandle.getRight();\n    var point1 = [center[0] + (up[0] - right[0]) * radius, center[1] + (up[1] - right[1]) * radius, center[2] + (up[2] - right[2]) * radius];\n    var point2 = [center[0] + (right[0] - up[0]) * radius, center[1] + (right[1] - up[1]) * radius, center[2] + (right[2] - up[2]) * radius];\n    return {\n      point1: point1,\n      point2: point2\n    };\n  };\n\n  var getCornersFromDiameter = function getCornersFromDiameter(point1, point2) {\n    var center = [0.5 * (point1[0] + point2[0]), 0.5 * (point1[1] + point2[1]), 0.5 * (point1[2] + point2[2])];\n    return getCornersFromRadius(center, point1);\n  }; // TODO: move to ShapeWidget/index.js\n\n\n  publicAPI.getBounds = function () {\n    return model.point1 && model.point2 ? vtkBoundingBox.addPoints(vtkBoundingBox.reset([]), [model.point1, model.point2]) : vtkMath.uninitializeBounds([]);\n  }; // To be reimplemented by subclass\n\n\n  publicAPI.setCorners = function (point1, point2) {\n    publicAPI.updateTextPosition(point1, point2);\n  };\n\n  publicAPI.updateShapeBounds = function () {\n    if (model.point1 && model.point2) {\n      var point1 = _toConsumableArray(model.point1);\n\n      var point2 = _toConsumableArray(model.point2);\n\n      if (publicAPI.isRatioFixed()) {\n        point2 = publicAPI.makeSquareFromPoints(point1, point2);\n      }\n\n      switch (publicAPI.getActiveBehaviorFromCategory(BehaviorCategory.POINTS)) {\n        case ShapeBehavior[BehaviorCategory.POINTS].CORNER_TO_CORNER:\n          {\n            publicAPI.setCorners(point1, point2);\n            break;\n          }\n\n        case ShapeBehavior[BehaviorCategory.POINTS].CENTER_TO_CORNER:\n          {\n            var diagonal = [0, 0, 0];\n            vec3.subtract(diagonal, point1, point2);\n            vec3.add(point1, point1, diagonal);\n            publicAPI.setCorners(point1, point2);\n            break;\n          }\n\n        case ShapeBehavior[BehaviorCategory.POINTS].RADIUS:\n          {\n            var points = getCornersFromRadius(point1, point2);\n            publicAPI.setCorners(points.point1, points.point2);\n            break;\n          }\n\n        case ShapeBehavior[BehaviorCategory.POINTS].DIAMETER:\n          {\n            var _points = getCornersFromDiameter(point1, point2);\n\n            publicAPI.setCorners(_points.point1, _points.point2);\n            break;\n          }\n\n        default:\n          // This should never be executed\n          vtkErrorMacro('vtk internal error');\n      }\n    }\n  };\n\n  var computePositionVector = function computePositionVector(textPosition, minPoint, maxPoint) {\n    var positionVector = [0, 0, 0];\n\n    switch (textPosition) {\n      case TextPosition.MIN:\n        break;\n\n      case TextPosition.MAX:\n        vtkMath.subtract(maxPoint, minPoint, positionVector);\n        break;\n\n      case TextPosition.CENTER:\n      default:\n        vtkMath.subtract(maxPoint, minPoint, positionVector);\n        vtkMath.multiplyScalar(positionVector, 0.5);\n        break;\n    }\n\n    return positionVector;\n  };\n\n  var computeTextPosition = function computeTextPosition(worldBounds, textPosition) {\n    var _model$_apiSpecificRe, _model$_apiSpecificRe2, _model$_apiSpecificRe5;\n\n    var worldMargin = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n    var viewPlaneOrigin = vtkBoundingBox.getCenter(worldBounds);\n\n    var viewPlaneNormal = model._renderer.getActiveCamera().getDirectionOfProjection();\n\n    var viewUp = model._renderer.getActiveCamera().getViewUp();\n\n    var positionMargin = Array.isArray(worldMargin) ? _toConsumableArray(worldMargin) : [worldMargin, worldMargin, viewPlaneOrigin ? worldMargin : 0]; // Map bounds from world positions to display positions\n\n    var minPoint = (_model$_apiSpecificRe = model._apiSpecificRenderWindow).worldToDisplay.apply(_model$_apiSpecificRe, _toConsumableArray(vtkBoundingBox.getMinPoint(worldBounds)).concat([model._renderer]));\n\n    var maxPoint = (_model$_apiSpecificRe2 = model._apiSpecificRenderWindow).worldToDisplay.apply(_model$_apiSpecificRe2, _toConsumableArray(vtkBoundingBox.getMaxPoint(worldBounds)).concat([model._renderer]));\n\n    var displayBounds = vtkBoundingBox.addPoints(vtkBoundingBox.reset([]), [minPoint, maxPoint]);\n    var planeOrigin = [];\n    var p1 = [];\n    var p2 = [];\n    var p3 = []; // If we are in a 2D projection\n\n    if (viewPlaneOrigin && viewPlaneNormal && viewUp && vtkBoundingBox.intersectPlane(displayBounds, viewPlaneOrigin, viewPlaneNormal)) {\n      var _model$_apiSpecificRe3, _model$_apiSpecificRe4;\n\n      // Map plane origin from world positions to display positions\n      var displayPlaneOrigin = (_model$_apiSpecificRe3 = model._apiSpecificRenderWindow).worldToDisplay.apply(_model$_apiSpecificRe3, _toConsumableArray(viewPlaneOrigin).concat([model._renderer])); // Map plane normal from world positions to display positions\n\n\n      var planeNormalPoint = vtkMath.add(viewPlaneOrigin, viewPlaneNormal, []);\n\n      var displayPlaneNormalPoint = (_model$_apiSpecificRe4 = model._apiSpecificRenderWindow).worldToDisplay.apply(_model$_apiSpecificRe4, _toConsumableArray(planeNormalPoint).concat([model._renderer]));\n\n      var displayPlaneNormal = vtkMath.subtract(displayPlaneNormalPoint, displayPlaneOrigin, []); // Project view plane into bounding box\n\n      var largeDistance = 10 * vtkBoundingBox.getDiagonalLength(displayBounds);\n      vtkPlane.projectPoint(vtkBoundingBox.getCenter(displayBounds), displayPlaneOrigin, displayPlaneNormal, planeOrigin);\n      var planeU = vtkMath.cross(viewUp, displayPlaneNormal, []);\n      vtkMath.normalize(planeU); // u\n\n      vtkMath.normalize(viewUp); // v\n\n      vtkMath.normalize(displayPlaneNormal); // w\n\n      vtkMath.multiplyAccumulate(planeOrigin, viewUp, -largeDistance, planeOrigin);\n      vtkMath.multiplyAccumulate(planeOrigin, planeU, -largeDistance, planeOrigin);\n      p1 = vtkMath.multiplyAccumulate(planeOrigin, planeU, 2 * largeDistance, []);\n      p2 = vtkMath.multiplyAccumulate(planeOrigin, viewUp, 2 * largeDistance, []);\n      p3 = planeOrigin;\n      boundPlane(displayBounds, planeOrigin, p1, p2);\n    } else {\n      planeOrigin = [displayBounds[0], displayBounds[2], displayBounds[4]];\n      p1 = [displayBounds[1], displayBounds[2], displayBounds[4]];\n      p2 = [displayBounds[0], displayBounds[3], displayBounds[4]];\n      p3 = [displayBounds[0], displayBounds[2], displayBounds[5]];\n    } // Compute horizontal, vertical and depth position\n\n\n    var u = computePositionVector(textPosition[0], planeOrigin, p1);\n    var v = computePositionVector(textPosition[1], planeOrigin, p2);\n    var w = computePositionVector(textPosition[2], planeOrigin, p3);\n    var finalPosition = planeOrigin;\n    vtkMath.add(finalPosition, u, finalPosition);\n    vtkMath.add(finalPosition, v, finalPosition);\n    vtkMath.add(finalPosition, w, finalPosition);\n    vtkMath.add(finalPosition, positionMargin, finalPosition);\n    return (_model$_apiSpecificRe5 = model._apiSpecificRenderWindow).displayToWorld.apply(_model$_apiSpecificRe5, finalPosition.concat([model._renderer]));\n  };\n\n  publicAPI.updateTextPosition = function (point1, point2) {\n    var bounds = vtkBoundingBox.addPoints(vtkBoundingBox.reset([]), [point1, point2]);\n    var screenPosition = computeTextPosition(bounds, model.widgetState.getTextPosition(), model.widgetState.getTextWorldMargin());\n    var textHandle = model.widgetState.getText();\n    textHandle.setOrigin(screenPosition);\n  };\n  /*\n   * If the widget has the focus, this method reset the widget\n   * to it's state just after it grabbed the focus. Otherwise\n   * it resets the widget to its state before it grabbed the focus.\n   */\n\n\n  publicAPI.reset = function () {\n    model.point1 = null;\n    model.point2 = null;\n    model.widgetState.getText().setVisible(false);\n    model.point1Handle.setOrigin(null);\n    model.point2Handle.setOrigin(null);\n    model.shapeHandle.setOrigin(null);\n    model.shapeHandle.setVisible(false);\n    model.point2Handle.setVisible(false);\n    model.point2Handle.deactivate();\n\n    if (model.hasFocus) {\n      model.point1Handle.activate();\n      model.activeState = model.point1Handle;\n    } else {\n      model.point1Handle.setVisible(false);\n      model.point1Handle.deactivate();\n      model.activeState = null;\n    }\n\n    publicAPI.updateShapeBounds();\n  }; // --------------------------------------------------------------------------\n  // Interactor events\n  // --------------------------------------------------------------------------\n\n\n  publicAPI.handleMouseMove = function (callData) {\n    var _model$activeState$ge, _model$activeState, _model$activeState$ge2;\n\n    var manipulator = (_model$activeState$ge = (_model$activeState = model.activeState) === null || _model$activeState === void 0 ? void 0 : (_model$activeState$ge2 = _model$activeState.getManipulator) === null || _model$activeState$ge2 === void 0 ? void 0 : _model$activeState$ge2.call(_model$activeState)) !== null && _model$activeState$ge !== void 0 ? _model$activeState$ge : model.manipulator;\n\n    if (!manipulator || !model.activeState || !model.activeState.getActive() || !model.pickable || !model.dragable) {\n      return macro.VOID;\n    }\n\n    if (!model.point2) {\n      // Update orientation to match the camera's plane\n      // if the corners are not yet placed\n      var normal = model._camera.getDirectionOfProjection();\n\n      var up = model._camera.getViewUp();\n\n      var right = [];\n      vec3.cross(right, up, normal);\n      model.shapeHandle.setUp(up);\n      model.shapeHandle.setRight(right);\n      model.shapeHandle.setDirection(normal);\n    }\n\n    var _manipulator$handleEv = manipulator.handleEvent(callData, model._apiSpecificRenderWindow),\n        worldCoords = _manipulator$handleEv.worldCoords;\n\n    if (!worldCoords.length) {\n      return macro.VOID;\n    }\n\n    if (model.hasFocus) {\n      if (!model.point1) {\n        model.point1Handle.setOrigin(worldCoords);\n      } else {\n        model.point2Handle.setOrigin(worldCoords);\n        model.point2 = worldCoords;\n        publicAPI.updateShapeBounds();\n        publicAPI.invokeInteractionEvent();\n      }\n    } else if (model._isDragging) {\n      if (model.activeState === model.point1Handle) {\n        model.point1Handle.setOrigin(worldCoords);\n        model.point1 = worldCoords;\n      } else {\n        model.point2Handle.setOrigin(worldCoords);\n        model.point2 = worldCoords;\n      }\n\n      publicAPI.updateShapeBounds();\n      publicAPI.invokeInteractionEvent();\n    }\n\n    return model.hasFocus || model._isDragging ? macro.EVENT_ABORT : macro.VOID;\n  }; // --------------------------------------------------------------------------\n  // Left click: Add point / End interaction\n  // --------------------------------------------------------------------------\n\n\n  publicAPI.handleLeftButtonPress = function (e) {\n    var _model$activeState$ge3, _model$activeState2, _model$activeState2$g;\n\n    var manipulator = (_model$activeState$ge3 = (_model$activeState2 = model.activeState) === null || _model$activeState2 === void 0 ? void 0 : (_model$activeState2$g = _model$activeState2.getManipulator) === null || _model$activeState2$g === void 0 ? void 0 : _model$activeState2$g.call(_model$activeState2)) !== null && _model$activeState$ge3 !== void 0 ? _model$activeState$ge3 : model.manipulator;\n\n    if (!model.activeState || !model.activeState.getActive() || !model.pickable || !manipulator) {\n      return macro.VOID;\n    }\n\n    if (model.hasFocus) {\n      var _manipulator$handleEv2 = manipulator.handleEvent(e, model._apiSpecificRenderWindow),\n          worldCoords = _manipulator$handleEv2.worldCoords;\n\n      if (!model.point1) {\n        model.point1Handle.setOrigin(worldCoords);\n        publicAPI.placePoint1(model.point1Handle.getOrigin());\n        publicAPI.invokeStartInteractionEvent();\n      } else {\n        model.point2Handle.setOrigin(worldCoords);\n        publicAPI.placePoint2(model.point2Handle.getOrigin());\n        publicAPI.invokeInteractionEvent();\n        publicAPI.invokeEndInteractionEvent();\n\n        if (publicAPI.getResetAfterPointPlacement()) {\n          publicAPI.reset();\n        } else {\n          publicAPI.loseFocus();\n        }\n      }\n\n      return macro.EVENT_ABORT;\n    }\n\n    if (model.point1 && (model.activeState === model.point1Handle || model.activeState === model.point2Handle) && model.dragable) {\n      model._isDragging = true;\n\n      model._apiSpecificRenderWindow.setCursor('grabbing');\n\n      model._interactor.requestAnimation(publicAPI);\n    }\n\n    publicAPI.invokeStartInteractionEvent();\n    return macro.EVENT_ABORT;\n  }; // --------------------------------------------------------------------------\n  // Left release: Maybe end interaction\n  // --------------------------------------------------------------------------\n\n\n  publicAPI.handleLeftButtonRelease = function (e) {\n    if (model._isDragging) {\n      model._isDragging = false;\n\n      model._apiSpecificRenderWindow.setCursor('pointer');\n\n      model.widgetState.deactivate();\n\n      model._interactor.cancelAnimation(publicAPI);\n\n      publicAPI.invokeEndInteractionEvent();\n      return macro.EVENT_ABORT;\n    }\n\n    if (!model.hasFocus || !model.pickable) {\n      return macro.VOID;\n    }\n\n    var viewSize = model._apiSpecificRenderWindow.getSize();\n\n    if (e.position.x < 0 || e.position.x > viewSize[0] - 1 || e.position.y < 0 || e.position.y > viewSize[1] - 1) {\n      return macro.VOID;\n    }\n\n    if (model.point1) {\n      publicAPI.placePoint2(model.point2Handle.getOrigin());\n\n      if (publicAPI.isDraggingEnabled()) {\n        var distance = vec3.squaredDistance(model.point1, model.point2);\n        var maxDistance = 100;\n\n        if (distance > maxDistance || publicAPI.isDraggingForced()) {\n          publicAPI.invokeInteractionEvent();\n          publicAPI.invokeEndInteractionEvent();\n\n          if (publicAPI.getResetAfterPointPlacement()) {\n            publicAPI.reset();\n          } else {\n            publicAPI.loseFocus();\n          }\n        }\n      }\n    }\n\n    return macro.EVENT_ABORT;\n  }; // --------------------------------------------------------------------------\n  // Register key presses/releases\n  // --------------------------------------------------------------------------\n\n\n  publicAPI.handleKeyDown = function (_ref) {\n    var key = _ref.key;\n\n    if (key === 'Escape') {\n      if (model.hasFocus) {\n        publicAPI.reset();\n        publicAPI.loseFocus();\n        publicAPI.invokeEndInteractionEvent();\n      }\n    } else {\n      model.keysDown[key] = true;\n    }\n\n    if (model.hasFocus) {\n      if (model.point1) {\n        model.point2 = model.point2Handle.getOrigin();\n        publicAPI.updateShapeBounds();\n      }\n    }\n  };\n\n  publicAPI.handleKeyUp = function (_ref2) {\n    var key = _ref2.key;\n    model.keysDown[key] = false;\n\n    if (model.hasFocus) {\n      if (model.point1) {\n        model.point2 = model.point2Handle.getOrigin();\n        publicAPI.updateShapeBounds();\n      }\n    }\n  }; // --------------------------------------------------------------------------\n  // Focus API - follow mouse when widget has focus\n  // --------------------------------------------------------------------------\n\n\n  publicAPI.grabFocus = function () {\n    if (!model.hasFocus) {\n      publicAPI.reset();\n      model.point1Handle.activate();\n      model.activeState = model.point1Handle;\n      model.point1Handle.setVisible(true);\n      model.shapeHandle.setVisible(false);\n\n      model._interactor.requestAnimation(publicAPI);\n    }\n\n    superClass.grabFocus();\n  }; // --------------------------------------------------------------------------\n\n\n  publicAPI.loseFocus = function () {\n    if (model.hasFocus) {\n      model._interactor.cancelAnimation(publicAPI);\n    }\n\n    if (!model.point1) {\n      model.point1Handle.setVisible(false);\n      model.point2Handle.setVisible(false);\n    }\n\n    model.widgetState.deactivate();\n    model.point1Handle.deactivate();\n    model.point2Handle.deactivate();\n    model.activeState = null;\n\n    model._interactor.render();\n\n    model._widgetManager.enablePicking();\n\n    superClass.loseFocus();\n  };\n}\n\nexport { widgetBehavior as default };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}