{"ast":null,"code":"import _slicedToArray from '@babel/runtime/helpers/slicedToArray';\nimport _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport _toConsumableArray from '@babel/runtime/helpers/toConsumableArray';\nimport macro from '../../macros.js';\nimport { D as arrayRange } from '../../Common/Core/Math/index.js';\nimport WebworkerPromise from 'webworker-promise';\nimport { W as WorkerFactory } from '../../_virtual/rollup-plugin-worker-loader__module_Sources/Interaction/Widgets/PiecewiseGaussianWidget/ComputeHistogram.worker.js';\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n  return target;\n}\n/* eslint-disable no-continue */\n// ----------------------------------------------------------------------------\n// Global structures\n// ----------------------------------------------------------------------------\n\nvar MIN_GAUSSIAN_WIDTH = 0.001;\nvar ACTION_TO_CURSOR = {\n  adjustPosition: '-webkit-grab',\n  adjustHeight: 'row-resize',\n  adjustBias: 'crosshair',\n  adjustWidth: 'col-resize',\n  adjustZoom: 'col-resize'\n};\nvar TOUCH_CLICK = []; // ----------------------------------------------------------------------------\n// Global methods\n// ----------------------------------------------------------------------------\n\nvar ACTIONS = {\n  adjustPosition: function adjustPosition(x, y, _ref) {\n    var originalXY = _ref.originalXY,\n      gaussian = _ref.gaussian,\n      originalGaussian = _ref.originalGaussian;\n    var xOffset = originalGaussian.position - originalXY[0];\n    gaussian.position = x + xOffset;\n    return true;\n  },\n  adjustHeight: function adjustHeight(x, y, _ref2) {\n    var model = _ref2.model,\n      gaussian = _ref2.gaussian;\n    gaussian.height = 1 - y;\n    gaussian.height = Math.min(1, Math.max(model.gaussianMinimumHeight, gaussian.height));\n    return true;\n  },\n  adjustBias: function adjustBias(x, y, _ref3) {\n    var originalXY = _ref3.originalXY,\n      gaussian = _ref3.gaussian,\n      originalGaussian = _ref3.originalGaussian;\n    gaussian.xBias = originalGaussian.xBias - (originalXY[0] - x) / gaussian.height;\n    gaussian.yBias = originalGaussian.yBias + 4 * (originalXY[1] - y) / gaussian.height; // Clamps\n\n    gaussian.xBias = Math.max(-1, Math.min(1, gaussian.xBias));\n    gaussian.yBias = Math.max(0, Math.min(2, gaussian.yBias));\n    return true;\n  },\n  adjustWidth: function adjustWidth(x, y, _ref4) {\n    var originalXY = _ref4.originalXY,\n      gaussian = _ref4.gaussian,\n      originalGaussian = _ref4.originalGaussian,\n      gaussianSide = _ref4.gaussianSide;\n    gaussian.width = gaussianSide < 0 ? originalGaussian.width - (originalXY[0] - x) : originalGaussian.width + (originalXY[0] - x);\n    if (gaussian.width < MIN_GAUSSIAN_WIDTH) {\n      gaussian.width = MIN_GAUSSIAN_WIDTH;\n    }\n    return true;\n  },\n  adjustZoom: function adjustZoom(x, y, _ref5) {\n    var rangeZoom = _ref5.rangeZoom,\n      publicAPI = _ref5.publicAPI;\n    var delta = rangeZoom[1] - rangeZoom[0];\n    var absNormX = (x - rangeZoom[0]) / delta;\n    var minDelta = Math.abs(absNormX - rangeZoom[0]);\n    var maxDelta = Math.abs(absNormX - rangeZoom[1]);\n    var meanDelta = Math.abs(absNormX - 0.5 * (rangeZoom[0] + rangeZoom[1]));\n    if (meanDelta < Math.min(minDelta, maxDelta)) {\n      var halfDelta = delta * 0.5;\n      rangeZoom[0] = Math.min(Math.max(absNormX - halfDelta, 0), rangeZoom[1] - 0.1);\n      rangeZoom[1] = Math.max(Math.min(absNormX + halfDelta, 1), rangeZoom[0] + 0.1);\n    } else if (minDelta < maxDelta) {\n      rangeZoom[0] = Math.min(Math.max(absNormX, 0), rangeZoom[1] - 0.1);\n    } else {\n      rangeZoom[1] = Math.max(Math.min(absNormX, 1), rangeZoom[0] + 0.1);\n    }\n    publicAPI.invokeZoomChange(rangeZoom); // The opacity did not changed\n\n    return false;\n  }\n}; // ----------------------------------------------------------------------------\n\nfunction computeOpacities(gaussians) {\n  var sampling = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 256;\n  var opacities = [];\n  while (opacities.length < sampling) {\n    opacities.push(0);\n  }\n  var count = gaussians.length;\n  while (count--) {\n    var _gaussians$count = gaussians[count],\n      position = _gaussians$count.position,\n      height = _gaussians$count.height,\n      width = _gaussians$count.width,\n      xBias = _gaussians$count.xBias,\n      yBias = _gaussians$count.yBias;\n    for (var i = 0; i < sampling; i++) {\n      var x = i / (sampling - 1); // clamp non-zero values to pos +/- width\n\n      if (x > position + width || x < position - width) {\n        if (opacities[i] < 0.0) {\n          opacities[i] = 0.0;\n        }\n        continue;\n      } // non-zero width\n\n      var correctedWidth = width < MIN_GAUSSIAN_WIDTH ? MIN_GAUSSIAN_WIDTH : width; // translate the original x to a new x based on the xbias\n\n      var x0 = 0;\n      if (xBias === 0 || x === position + xBias) {\n        x0 = x;\n      } else if (x > position + xBias) {\n        if (correctedWidth === xBias) {\n          x0 = position;\n        } else {\n          x0 = position + (x - position - xBias) * (correctedWidth / (correctedWidth - xBias));\n        }\n      } else if (-correctedWidth === xBias) {\n        // (x < pos+xBias)\n        x0 = position;\n      } else {\n        x0 = position - (x - position - xBias) * (correctedWidth / (correctedWidth + xBias));\n      } // center around 0 and normalize to -1,1\n\n      var x1 = (x0 - position) / correctedWidth; // do a linear interpolation between:\n      //    a gaussian and a parabola        if 0 < yBias <1\n      //    a parabola and a step function   if 1 < yBias <2\n\n      var h0a = Math.exp(-(4 * x1 * x1));\n      var h0b = 1.0 - x1 * x1;\n      var h0c = 1.0;\n      var h1 = void 0;\n      if (yBias < 1) {\n        h1 = yBias * h0b + (1 - yBias) * h0a;\n      } else {\n        h1 = (2 - yBias) * h0b + (yBias - 1) * h0c;\n      }\n      var h2 = height * h1; // perform the MAX over different gaussians, not the sum\n\n      if (h2 > opacities[i]) {\n        opacities[i] = h2;\n      }\n    }\n  }\n  return opacities;\n} // ----------------------------------------------------------------------------\n\nfunction applyGaussianToPiecewiseFunction(gaussians, sampling, rangeToUse, piecewiseFunction) {\n  var opacities = computeOpacities(gaussians, sampling);\n  var nodes = [];\n  var delta = (rangeToUse[1] - rangeToUse[0]) / (opacities.length - 1);\n  var midpoint = 0.5;\n  var sharpness = 0;\n  for (var index = 0; index < opacities.length; index++) {\n    var x = rangeToUse[0] + delta * index;\n    var y = opacities[index];\n    nodes.push({\n      x: x,\n      y: y,\n      midpoint: midpoint,\n      sharpness: sharpness\n    });\n  }\n  piecewiseFunction.setNodes(nodes);\n} // ----------------------------------------------------------------------------\n\nfunction drawChart(ctx, area, values) {\n  var style = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {\n    lineWidth: 1,\n    strokeStyle: '#000'\n  };\n  var verticalScale = area[3];\n  var horizontalScale = area[2] / (values.length - 1);\n  var fill = !!style.fillStyle;\n  var offset = verticalScale + area[1];\n  ctx.lineWidth = style.lineWidth;\n  ctx.strokeStyle = style.strokeStyle;\n  ctx.beginPath();\n  ctx.moveTo(area[0], area[1] + area[3]);\n  for (var index = 0; index < values.length; index++) {\n    ctx.lineTo(area[0] + index * horizontalScale, Math.max(area[1], offset - values[index] * verticalScale));\n  }\n  if (fill) {\n    ctx.fillStyle = style.fillStyle;\n    ctx.lineTo(area[0] + area[2], area[1] + area[3]);\n    if (style.clip) {\n      ctx.clip();\n      return;\n    }\n    ctx.fill();\n  }\n  ctx.stroke();\n} // ----------------------------------------------------------------------------\n\nfunction updateColorCanvas(colorTransferFunction, width, rangeToUse, canvas) {\n  var workCanvas = canvas || document.createElement('canvas');\n  workCanvas.setAttribute('width', width);\n  workCanvas.setAttribute('height', 256);\n  var ctx = workCanvas.getContext('2d');\n  var rgba = colorTransferFunction.getUint8Table(rangeToUse[0], rangeToUse[1], width, 4);\n  var pixelsArea = ctx.getImageData(0, 0, width, 256);\n  for (var lineIdx = 0; lineIdx < 256; lineIdx++) {\n    pixelsArea.data.set(rgba, lineIdx * 4 * width);\n  }\n  var nbValues = 256 * width * 4;\n  var lineSize = width * 4;\n  for (var i = 3; i < nbValues; i += 4) {\n    pixelsArea.data[i] = 255 - Math.floor(i / lineSize);\n  }\n  ctx.putImageData(pixelsArea, 0, 0);\n  return workCanvas;\n} // ----------------------------------------------------------------------------\n\nfunction updateColorCanvasFromImage(img, width, canvas) {\n  var workCanvas = canvas || document.createElement('canvas');\n  workCanvas.setAttribute('width', width);\n  workCanvas.setAttribute('height', 256);\n  var ctx = workCanvas.getContext('2d');\n  ctx.drawImage(img, 0, 0, img.width, img.height, 0, 0, width, 256);\n  return workCanvas;\n} // ----------------------------------------------------------------------------\n\nfunction normalizeCoordinates(x, y, subRectangeArea) {\n  var zoomRange = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : [0, 1];\n  return [zoomRange[0] + (x - subRectangeArea[0]) / subRectangeArea[2] * (zoomRange[1] - zoomRange[0]), (y - subRectangeArea[1]) / subRectangeArea[3]];\n} // ----------------------------------------------------------------------------\n\nfunction findGaussian(x, gaussians) {\n  var distances = gaussians.map(function (g) {\n    return Math.abs(g.position - x);\n  });\n  var min = Math.min.apply(Math, _toConsumableArray(distances));\n  return distances.indexOf(min);\n} // ----------------------------------------------------------------------------\n\nfunction createListener(callback) {\n  var preventDefault = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n  return function (e) {\n    var offsetX = e.offsetX,\n      offsetY = e.offsetY;\n    if (preventDefault) {\n      e.preventDefault();\n    }\n    callback(offsetX, offsetY);\n  };\n} // ----------------------------------------------------------------------------\n\nfunction createTouchClickListener() {\n  var id = TOUCH_CLICK.length;\n  for (var _len = arguments.length, callbacks = new Array(_len), _key = 0; _key < _len; _key++) {\n    callbacks[_key] = arguments[_key];\n  }\n  TOUCH_CLICK.push({\n    callbacks: callbacks,\n    timeout: 0,\n    deltaT: 200,\n    count: 0,\n    ready: false\n  });\n  return id;\n} // ----------------------------------------------------------------------------\n\nfunction processTouchClicks() {\n  TOUCH_CLICK.filter(function (t) {\n    return t.ready;\n  }).forEach(function (touchHandle) {\n    touchHandle.callbacks.forEach(function (callback) {\n      if (callback.touches === touchHandle.touches && callback.clicks === touchHandle.count) {\n        callback.action.apply(callback, _toConsumableArray(touchHandle.singleTouche));\n      }\n    }); // Clear state\n\n    touchHandle.ts = 0;\n    touchHandle.count = 0;\n    touchHandle.touches = 0;\n    touchHandle.ready = false;\n  });\n} // ----------------------------------------------------------------------------\n\nfunction createTouchListener(id, callback) {\n  var nbTouches = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n  var preventDefault = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n  return function (e) {\n    var targetBounds = e.target.getBoundingClientRect();\n    var relativeTouches = Array.prototype.map.call(e.touches, function (t) {\n      return [t.pageX - targetBounds.left, t.pageY - targetBounds.top];\n    });\n    var singleTouche = relativeTouches.reduce(function (a, b) {\n      return [a[0] + b[0], a[1] + b[1]];\n    }, [0, 0]).map(function (v) {\n      return v / e.touches.length;\n    });\n    if (e.type === 'touchstart') {\n      clearTimeout(TOUCH_CLICK[id].timeout);\n      TOUCH_CLICK[id].ts = e.timeStamp;\n      TOUCH_CLICK[id].singleTouche = singleTouche;\n      TOUCH_CLICK[id].touches = e.touches.length;\n    } else if (e.type === 'touchmove') {\n      TOUCH_CLICK[id].ts = 0;\n      TOUCH_CLICK[id].count = 0;\n      TOUCH_CLICK[id].ready = false;\n    } else if (e.type === 'touchend') {\n      if (e.timeStamp - TOUCH_CLICK[id].ts < TOUCH_CLICK[id].deltaT) {\n        TOUCH_CLICK[id].count += 1;\n        TOUCH_CLICK[id].ready = true;\n        if (preventDefault) {\n          e.preventDefault();\n        }\n        TOUCH_CLICK[id].timeout = setTimeout(processTouchClicks, TOUCH_CLICK[id].deltaT);\n      } else {\n        TOUCH_CLICK[id].ready = false;\n      }\n    }\n    if (e.touches.length === nbTouches) {\n      callback.apply(void 0, _toConsumableArray(singleTouche));\n      if (preventDefault) {\n        e.preventDefault();\n      }\n    }\n  };\n} // ----------------------------------------------------------------------------\n\nfunction listenerSelector(condition, ok, ko) {\n  return function (e) {\n    return condition() ? ok(e) : ko(e);\n  };\n} // ----------------------------------------------------------------------------\n\nfunction rescaleArray(array, focusArea) {\n  if (!focusArea) {\n    return array;\n  }\n  var maxIdx = array.length - 1;\n  var idxRange = focusArea.map(function (v) {\n    return Math.round(v * maxIdx);\n  });\n  return array.slice(idxRange[0], idxRange[1] + 1);\n} // ----------------------------------------------------------------------------\n\nfunction rescaleValue(value, focusArea) {\n  if (!focusArea) {\n    return value;\n  }\n  return (value - focusArea[0]) / (focusArea[1] - focusArea[0]);\n} // ----------------------------------------------------------------------------\n// Static API\n// ----------------------------------------------------------------------------\n\nvar STATIC = {\n  applyGaussianToPiecewiseFunction: applyGaussianToPiecewiseFunction,\n  computeOpacities: computeOpacities,\n  createListener: createListener,\n  drawChart: drawChart,\n  findGaussian: findGaussian,\n  listenerSelector: listenerSelector,\n  normalizeCoordinates: normalizeCoordinates\n}; // ----------------------------------------------------------------------------\n// vtkPiecewiseGaussianWidget methods\n// ----------------------------------------------------------------------------\n\nfunction vtkPiecewiseGaussianWidget(publicAPI, model) {\n  // Set our className\n  model.classHierarchy.push('vtkPiecewiseGaussianWidget');\n  if (!model.canvas) {\n    model.canvas = document.createElement('canvas');\n  }\n  publicAPI.setContainer = function (el) {\n    if (model.container && model.container !== el) {\n      model.container.removeChild(model.canvas);\n    }\n    if (model.container !== el) {\n      model.container = el;\n      if (model.container) {\n        model.container.appendChild(model.canvas);\n      }\n      publicAPI.modified();\n    }\n  };\n  publicAPI.setGaussians = function (gaussians) {\n    if (model.gaussians === gaussians) {\n      return;\n    }\n    model.gaussians = gaussians;\n    model.opacities = computeOpacities(model.gaussians, model.piecewiseSize);\n    publicAPI.invokeOpacityChange(publicAPI);\n    publicAPI.modified();\n  };\n  publicAPI.addGaussian = function (position, height, width, xBias, yBias) {\n    var nextIndex = model.gaussians.length;\n    model.gaussians.push({\n      position: position,\n      height: height,\n      width: width,\n      xBias: xBias,\n      yBias: yBias\n    });\n    model.opacities = computeOpacities(model.gaussians, model.piecewiseSize);\n    publicAPI.invokeOpacityChange(publicAPI);\n    publicAPI.modified();\n    return nextIndex;\n  };\n  publicAPI.removeGaussian = function (index) {\n    model.gaussians.splice(index, 1);\n    model.opacities = computeOpacities(model.gaussians, model.piecewiseSize);\n    publicAPI.invokeOpacityChange(publicAPI);\n    publicAPI.modified();\n  };\n  publicAPI.setSize = function (width, height) {\n    model.canvas.setAttribute('width', width);\n    model.canvas.setAttribute('height', height);\n    if (model.size[0] !== width || model.size[1] !== height) {\n      model.size = [width, height];\n      model.colorCanvasMTime = 0;\n      publicAPI.modified();\n    }\n  };\n  publicAPI.updateStyle = function (style) {\n    model.style = _objectSpread(_objectSpread({}, model.style), style);\n    publicAPI.modified();\n  }; // Method used to compute and show data distribution in the background.\n  // When an array with many components is used, you can provide additional\n  // information to choose which component you want to extract the histogram\n  // from.\n\n  publicAPI.setDataArray = function (array) {\n    var _ref6 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n      _ref6$numberOfBinToCo = _ref6.numberOfBinToConsiders,\n      numberOfBinToConsiders = _ref6$numberOfBinToCo === void 0 ? 1 : _ref6$numberOfBinToCo,\n      _ref6$numberOfBinsToS = _ref6.numberOfBinsToSkip,\n      numberOfBinsToSkip = _ref6$numberOfBinsToS === void 0 ? 1 : _ref6$numberOfBinsToS,\n      _ref6$numberOfCompone = _ref6.numberOfComponents,\n      numberOfComponents = _ref6$numberOfCompone === void 0 ? 1 : _ref6$numberOfCompone,\n      _ref6$component = _ref6.component,\n      component = _ref6$component === void 0 ? 0 : _ref6$component;\n    model.histogram = null;\n    model.histogramArray = array;\n    model.dataRange = arrayRange(array, component, numberOfComponents);\n    var _model$dataRange = _slicedToArray(model.dataRange, 2),\n      min = _model$dataRange[0],\n      max = _model$dataRange[1];\n    var maxNumberOfWorkers = 4;\n    var arrayStride = Math.floor(array.length / maxNumberOfWorkers) || 1;\n    arrayStride += arrayStride % numberOfComponents;\n    var arrayIndex = 0;\n    var workerChunks = [];\n    var workers = [];\n    while (arrayIndex < array.length) {\n      var worker = new WorkerFactory();\n      workers.push(worker);\n      var workerPromise = new WebworkerPromise(worker);\n      var arrayStart = arrayIndex;\n      var arrayEnd = Math.min(arrayIndex + arrayStride, array.length - 1);\n      var subArray = new array.constructor(array.slice(arrayStart, arrayEnd + 1));\n      workerChunks.push(workerPromise.postMessage({\n        array: subArray,\n        component: component,\n        numberOfComponents: numberOfComponents,\n        min: min,\n        max: max,\n        numberOfBins: model.numberOfBins\n      }, [subArray.buffer]));\n      arrayIndex += arrayStride;\n    }\n    Promise.all(workerChunks).then(function (subHistograms) {\n      workers.forEach(function (worker) {\n        return worker.terminate();\n      });\n      model.histogram = new Float32Array(model.numberOfBins);\n      model.histogram.fill(0);\n      subHistograms.forEach(function (subHistogram) {\n        for (var i = 0, len = subHistogram.length; i < len; ++i) {\n          model.histogram[i] += subHistogram[i];\n        }\n      }); // Smart Rescale Histogram\n\n      var sampleSize = Math.min(numberOfBinToConsiders, model.histogram.length - numberOfBinsToSkip);\n      var sortedArray = Array.from(model.histogram);\n      sortedArray.sort(function (a, b) {\n        return Number(a) - Number(b);\n      });\n      for (var i = 0; i < numberOfBinsToSkip; i++) {\n        sortedArray.pop();\n      }\n      while (sortedArray.length > sampleSize) {\n        sortedArray.shift();\n      }\n      var mean = sortedArray.reduce(function (a, b) {\n        return a + b;\n      }, 0) / sampleSize;\n      for (var _i = 0, len = model.histogram.length; _i < len; ++_i) {\n        model.histogram[_i] /= mean;\n      }\n      publicAPI.modified();\n      setTimeout(publicAPI.render, 0);\n    });\n    publicAPI.modified();\n  };\n  publicAPI.onClick = function (x, y) {\n    var _normalizeCoordinates = normalizeCoordinates(x, y, model.graphArea, model.enableRangeZoom ? model.rangeZoom : null),\n      _normalizeCoordinates2 = _slicedToArray(_normalizeCoordinates, 2),\n      xNormalized = _normalizeCoordinates2[0],\n      yNormalized = _normalizeCoordinates2[1];\n    if (xNormalized < 0 && model.style.iconSize > 1) {\n      // Control buttons\n      var delta = model.style.iconSize + model.style.padding;\n      var offset = delta;\n      var buttonIdx = 0;\n      while (y > offset) {\n        buttonIdx += 1;\n        offset += delta;\n      }\n      switch (buttonIdx) {\n        case 0:\n          {\n            var gaussianIdx = publicAPI.addGaussian(0, 1, 0.1, 0, 0);\n            var gaussian = model.gaussians[gaussianIdx];\n            var originalGaussian = _objectSpread({}, gaussian);\n            var action = ACTIONS.adjustPosition;\n            model.activeGaussian = gaussianIdx;\n            model.selectedGaussian = gaussianIdx; // Fake active action\n\n            macro.setImmediate(function () {\n              publicAPI.onDown(x, y);\n              model.dragAction = {\n                originalXY: [0, 0],\n                action: action,\n                gaussian: gaussian,\n                originalGaussian: originalGaussian\n              };\n            });\n            break;\n          }\n        case 1:\n          {\n            if (model.selectedGaussian !== -1) {\n              publicAPI.removeGaussian(model.selectedGaussian);\n            }\n            break;\n          }\n        default:\n          {\n            model.selectedGaussian = -1;\n            model.dragAction = null;\n          }\n      }\n    } else if (xNormalized < 0 || xNormalized > 1 || yNormalized < 0 || yNormalized > 1) {\n      model.selectedGaussian = -1;\n      model.dragAction = null;\n    } else {\n      var newSelected = findGaussian(xNormalized, model.gaussians);\n      if (newSelected !== model.selectedGaussian) {\n        model.selectedGaussian = newSelected;\n        publicAPI.modified();\n      }\n    }\n    return true;\n  };\n  publicAPI.onHover = function (x, y) {\n    // Determines the interaction region size for adjusting the Gaussian's\n    // height.\n    var tolerance = 20 / model.canvas.height;\n    var _normalizeCoordinates3 = normalizeCoordinates(x, y, model.graphArea, model.enableRangeZoom ? model.rangeZoom : null),\n      _normalizeCoordinates4 = _slicedToArray(_normalizeCoordinates3, 2),\n      xNormalized = _normalizeCoordinates4[0],\n      yNormalized = _normalizeCoordinates4[1];\n    var _normalizeCoordinates5 = normalizeCoordinates(x, y, model.graphArea),\n      _normalizeCoordinates6 = _slicedToArray(_normalizeCoordinates5, 1),\n      xNormalizedAbs = _normalizeCoordinates6[0];\n    var newActive = xNormalized < 0 ? model.selectedGaussian : findGaussian(xNormalized, model.gaussians);\n    model.canvas.style.cursor = 'default';\n    var gaussian = model.gaussians[newActive];\n    if (model.enableRangeZoom && xNormalizedAbs >= 0 && y < model.graphArea[1] - 6 // circle radius\n    ) {\n      var thirdDelta = (model.rangeZoom[1] - model.rangeZoom[0]) / 3;\n      if (xNormalizedAbs < model.rangeZoom[0] + thirdDelta || xNormalizedAbs > model.rangeZoom[1] - thirdDelta) {\n        model.canvas.style.cursor = ACTION_TO_CURSOR.adjustZoom;\n      } else {\n        model.canvas.style.cursor = ACTION_TO_CURSOR.adjustPosition;\n      }\n      model.dragAction = {\n        rangeZoom: model.rangeZoom,\n        action: ACTIONS.adjustZoom\n      };\n    } else if (gaussian && xNormalizedAbs >= 0) {\n      var invY = 1 - yNormalized;\n      var actionName = null;\n      if (invY > gaussian.height + tolerance) {\n        actionName = 'adjustPosition';\n      } else if (invY > gaussian.height - tolerance) {\n        if (Math.abs(xNormalized - gaussian.position) < tolerance) {\n          actionName = 'adjustHeight';\n        } else {\n          actionName = 'adjustPosition';\n        }\n      } else if (invY > gaussian.height * 0.5 + tolerance) {\n        actionName = 'adjustPosition';\n      } else if (invY > gaussian.height * 0.5 - tolerance) {\n        if (Math.abs(xNormalized - gaussian.position) < tolerance) {\n          actionName = 'adjustBias';\n        } else {\n          actionName = 'adjustPosition';\n        }\n      } else if (invY > tolerance) {\n        actionName = 'adjustPosition';\n      } else {\n        actionName = 'adjustWidth';\n      }\n      model.canvas.style.cursor = ACTION_TO_CURSOR[actionName];\n      var action = ACTIONS[actionName];\n      var originalGaussian = _objectSpread({}, gaussian);\n      model.dragAction = {\n        originalXY: [xNormalized, yNormalized],\n        action: action,\n        gaussian: gaussian,\n        originalGaussian: originalGaussian\n      };\n    }\n    if (newActive !== model.activeGaussian) {\n      model.activeGaussian = newActive;\n      publicAPI.modified();\n    }\n    return true;\n  };\n  publicAPI.onDown = function (x, y) {\n    if (!model.mouseIsDown) {\n      publicAPI.invokeAnimation(true);\n    }\n    model.mouseIsDown = true;\n    var xNormalized = normalizeCoordinates(x, y, model.graphArea, model.enableRangeZoom ? model.rangeZoom : null)[0];\n    var newSelected = findGaussian(xNormalized, model.gaussians);\n    model.gaussianSide = 0;\n    var gaussian = model.gaussians[newSelected];\n    if (gaussian) {\n      model.gaussianSide = gaussian.position - xNormalized;\n    }\n    if (newSelected !== model.selectedGaussian && xNormalized > 0) {\n      model.selectedGaussian = newSelected;\n      publicAPI.modified();\n    }\n    return true;\n  };\n  publicAPI.onDrag = function (x, y) {\n    if (model.dragAction) {\n      var _normalizeCoordinates7 = normalizeCoordinates(x, y, model.graphArea, model.enableRangeZoom ? model.rangeZoom : null),\n        _normalizeCoordinates8 = _slicedToArray(_normalizeCoordinates7, 2),\n        xNormalized = _normalizeCoordinates8[0],\n        yNormalized = _normalizeCoordinates8[1];\n      var action = model.dragAction.action;\n      if (action(xNormalized, yNormalized, _objectSpread({\n        gaussianSide: model.gaussianSide,\n        model: model,\n        publicAPI: publicAPI\n      }, model.dragAction))) {\n        model.opacities = computeOpacities(model.gaussians, model.piecewiseSize);\n        publicAPI.invokeOpacityChange(publicAPI, true);\n      }\n      publicAPI.modified();\n    }\n    return true;\n  };\n  publicAPI.onUp = function (x, y) {\n    if (model.mouseIsDown) {\n      publicAPI.invokeAnimation(false);\n    }\n    model.mouseIsDown = false;\n    return true;\n  };\n  publicAPI.onLeave = function (x, y) {\n    publicAPI.onUp(x, y);\n    model.canvas.style.cursor = 'default';\n    model.activeGaussian = -1;\n    publicAPI.modified();\n    return true;\n  };\n  publicAPI.onAddGaussian = function (x, y) {\n    var _normalizeCoordinates9 = normalizeCoordinates(x, y, model.graphArea, model.enableRangeZoom ? model.rangeZoom : null),\n      _normalizeCoordinates10 = _slicedToArray(_normalizeCoordinates9, 2),\n      xNormalized = _normalizeCoordinates10[0],\n      yNormalized = _normalizeCoordinates10[1];\n    if (xNormalized >= 0) {\n      publicAPI.addGaussian(xNormalized, 1 - yNormalized, 0.1, 0, 0);\n    }\n    return true;\n  };\n  publicAPI.onRemoveGaussian = function (x, y) {\n    var xNormalized = normalizeCoordinates(x, y, model.graphArea, model.enableRangeZoom ? model.rangeZoom : null)[0];\n    var newSelected = findGaussian(xNormalized, model.gaussians);\n    if (xNormalized >= 0 && newSelected !== -1) {\n      publicAPI.removeGaussian(newSelected);\n    }\n    return true;\n  };\n  publicAPI.bindMouseListeners = function () {\n    if (!model.listeners) {\n      var isDown = function isDown() {\n        return !!model.mouseIsDown;\n      };\n      var touchId = createTouchClickListener({\n        clicks: 1,\n        touches: 1,\n        action: publicAPI.onClick\n      }, {\n        clicks: 2,\n        touches: 1,\n        action: publicAPI.onAddGaussian\n      }, {\n        clicks: 2,\n        touches: 2,\n        action: publicAPI.onRemoveGaussian\n      });\n      model.listeners = {\n        mousemove: listenerSelector(isDown, createListener(publicAPI.onDrag), createListener(publicAPI.onHover)),\n        dblclick: createListener(publicAPI.onAddGaussian),\n        contextmenu: createListener(publicAPI.onRemoveGaussian),\n        click: createListener(publicAPI.onClick),\n        mouseup: createListener(publicAPI.onUp),\n        mousedown: createListener(publicAPI.onDown),\n        mouseout: createListener(publicAPI.onLeave),\n        touchstart: createTouchListener(touchId, macro.chain(publicAPI.onHover, publicAPI.onDown)),\n        touchmove: listenerSelector(isDown, createTouchListener(touchId, publicAPI.onDrag), createTouchListener(touchId, publicAPI.onHover)),\n        touchend: createTouchListener(touchId, publicAPI.onUp, 0) // touchend have 0 touch event...\n      };\n\n      Object.keys(model.listeners).forEach(function (eventType) {\n        model.canvas.addEventListener(eventType, model.listeners[eventType], false);\n      });\n    }\n  };\n  publicAPI.unbindMouseListeners = function () {\n    if (model.listeners) {\n      Object.keys(model.listeners).forEach(function (eventType) {\n        model.canvas.removeEventListener(eventType, model.listeners[eventType]);\n      });\n      delete model.listeners;\n    }\n  };\n  publicAPI.render = function () {\n    var ctx = model.canvas.getContext('2d');\n    ctx.imageSmoothingEnabled = true;\n    var _model$size = _slicedToArray(model.size, 2),\n      width = _model$size[0],\n      height = _model$size[1];\n    var offset = model.style.padding;\n    var graphArea = [Math.floor(model.style.iconSize + offset), Math.floor(offset), Math.ceil(width - 2 * offset - model.style.iconSize), Math.ceil(height - 2 * offset)];\n    var zoomControlHeight = model.style.zoomControlHeight;\n    if (model.enableRangeZoom) {\n      graphArea[1] += Math.floor(zoomControlHeight);\n      graphArea[3] -= Math.floor(zoomControlHeight);\n    }\n    model.graphArea = graphArea; // Clear canvas\n\n    ctx.clearRect(0, 0, width, height);\n    ctx.lineJoin = 'round';\n    ctx.fillStyle = model.style.backgroundColor;\n    ctx.fillRect.apply(ctx, graphArea);\n    if (model.style.iconSize > 1) {\n      // Draw icons\n      // +\n      var halfSize = Math.round(model.style.iconSize / 2 - model.style.strokeWidth);\n      var center = Math.round(halfSize + offset + model.style.strokeWidth);\n      ctx.beginPath();\n      ctx.lineWidth = model.style.buttonStrokeWidth;\n      ctx.strokeStyle = model.style.buttonStrokeColor;\n      ctx.arc(center - offset / 2, center, halfSize, 0, 2 * Math.PI, false);\n      ctx.fillStyle = model.style.buttonFillColor;\n      ctx.fill();\n      ctx.stroke();\n      ctx.moveTo(center - halfSize + model.style.strokeWidth + 2 - offset / 2, center);\n      ctx.lineTo(center + halfSize - model.style.strokeWidth - 2 - offset / 2, center);\n      ctx.stroke();\n      ctx.moveTo(center - offset / 2, center - halfSize + model.style.strokeWidth + 2);\n      ctx.lineTo(center - offset / 2, center + halfSize - model.style.strokeWidth - 2);\n      ctx.stroke(); // -\n\n      if (model.selectedGaussian === -1) {\n        ctx.fillStyle = model.style.buttonDisableFillColor;\n        ctx.lineWidth = model.style.buttonDisableStrokeWidth;\n        ctx.strokeStyle = model.style.buttonDisableStrokeColor;\n      } else {\n        ctx.fillStyle = model.style.buttonFillColor;\n        ctx.lineWidth = model.style.buttonStrokeWidth;\n        ctx.strokeStyle = model.style.buttonStrokeColor;\n      }\n      ctx.beginPath();\n      ctx.arc(center - offset / 2, center + offset / 2 + model.style.iconSize, halfSize, 0, 2 * Math.PI, false);\n      ctx.fill();\n      ctx.stroke();\n      ctx.moveTo(center - halfSize + model.style.strokeWidth + 2 - offset / 2, center + offset / 2 + model.style.iconSize);\n      ctx.lineTo(center + halfSize - model.style.strokeWidth - 2 - offset / 2, center + offset / 2 + model.style.iconSize);\n      ctx.stroke();\n    } // Draw histogram\n\n    if (model.histogram) {\n      drawChart(ctx, graphArea, rescaleArray(model.histogram, model.rangeZoom), {\n        lineWidth: 1,\n        strokeStyle: model.style.histogramColor,\n        fillStyle: model.style.histogramColor\n      });\n    } // Draw gaussians\n\n    drawChart(ctx, graphArea, rescaleArray(model.opacities, model.enableRangeZoom && model.rangeZoom), {\n      lineWidth: model.style.strokeWidth,\n      strokeStyle: model.style.strokeColor\n    }); // Draw color function if any\n\n    if (model.colorTransferFunction && model.colorTransferFunction.getSize()) {\n      var rangeToUse = model.dataRange || model.colorTransferFunction.getMappingRange();\n      if (!model.colorCanvas || model.colorCanvasMTime !== model.colorTransferFunction.getMTime()) {\n        model.colorCanvasMTime = model.colorTransferFunction.getMTime();\n        model.colorCanvas = updateColorCanvas(model.colorTransferFunction, graphArea[2], rangeToUse, model.colorCanvas);\n      }\n      ctx.save();\n      drawChart(ctx, graphArea, rescaleArray(model.opacities, model.enableRangeZoom && model.rangeZoom), {\n        lineWidth: 1,\n        strokeStyle: 'rgba(0,0,0,0)',\n        fillStyle: 'rgba(0,0,0,1)',\n        clip: true\n      }); // Draw the correct portion of the color BG image\n\n      if (model.enableRangeZoom) {\n        ctx.drawImage(model.colorCanvas, model.rangeZoom[0] * graphArea[2], 0, graphArea[2], graphArea[3], graphArea[0], graphArea[1], graphArea[2] / (model.rangeZoom[1] - model.rangeZoom[0]), graphArea[3]);\n      } else {\n        ctx.drawImage(model.colorCanvas, graphArea[0], graphArea[1]);\n      }\n      ctx.restore();\n    } else if (model.backgroundImage) {\n      model.colorCanvas = updateColorCanvasFromImage(model.backgroundImage, graphArea[2], model.colorCanvas);\n      ctx.save();\n      drawChart(ctx, graphArea, rescaleArray(model.opacities, model.enableRangeZoom && model.rangeZoom), {\n        lineWidth: 1,\n        strokeStyle: 'rgba(0,0,0,0)',\n        fillStyle: 'rgba(0,0,0,1)',\n        clip: true\n      });\n      ctx.drawImage(model.colorCanvas, graphArea[0], graphArea[1]);\n      ctx.restore();\n    } // Draw zoomed area\n\n    if (model.enableRangeZoom) {\n      ctx.fillStyle = model.style.zoomControlColor;\n      ctx.beginPath();\n      ctx.rect(graphArea[0] + model.rangeZoom[0] * graphArea[2], 0, (model.rangeZoom[1] - model.rangeZoom[0]) * graphArea[2], zoomControlHeight);\n      ctx.fill();\n    } // Draw active gaussian\n\n    var activeGaussian = model.gaussians[model.activeGaussian] || model.gaussians[model.selectedGaussian];\n    if (activeGaussian) {\n      var activeOpacities = computeOpacities([activeGaussian], graphArea[2]);\n      drawChart(ctx, graphArea, rescaleArray(activeOpacities, model.enableRangeZoom && model.rangeZoom), {\n        lineWidth: model.style.activeStrokeWidth,\n        strokeStyle: model.style.activeColor\n      }); // Draw controls\n\n      var xCenter = graphArea[0] + rescaleValue(activeGaussian.position, model.enableRangeZoom && model.rangeZoom) * graphArea[2];\n      var yTop = graphArea[1] + (1 - activeGaussian.height) * graphArea[3];\n      var yMiddle = graphArea[1] + (1 - 0.5 * activeGaussian.height) * graphArea[3];\n      var yBottom = graphArea[1] + graphArea[3];\n      var widthInPixel = activeGaussian.width * graphArea[2];\n      if (model.enableRangeZoom) {\n        widthInPixel /= model.rangeZoom[1] - model.rangeZoom[0];\n      }\n      ctx.lineWidth = model.style.handleWidth;\n      ctx.strokeStyle = model.style.handleColor;\n      ctx.fillStyle = model.style.backgroundColor;\n      ctx.beginPath();\n      ctx.moveTo(xCenter, graphArea[1] + (1 - activeGaussian.height) * graphArea[3]);\n      ctx.lineTo(xCenter, graphArea[1] + graphArea[3]);\n      ctx.stroke(); // Height\n\n      ctx.beginPath();\n      ctx.arc(xCenter, yTop, 6, 0, 2 * Math.PI);\n      ctx.fill();\n      ctx.stroke(); // Bias\n\n      var radius = Math.min(widthInPixel * 0.1, activeGaussian.height * graphArea[3] * 0.2);\n      ctx.beginPath();\n      ctx.rect(xCenter - radius, yMiddle - radius, radius * 2, radius * 2);\n      ctx.fill();\n      ctx.stroke();\n      ctx.beginPath(); // Width\n\n      var sliderWidth = widthInPixel * 0.8;\n      ctx.rect(xCenter - sliderWidth, yBottom - 5, 2 * sliderWidth, 10);\n      ctx.fill();\n      ctx.stroke();\n    }\n  };\n  publicAPI.getOpacityNodes = function (dataRange) {\n    var rangeToUse = dataRange || model.dataRange;\n    var delta = (rangeToUse[1] - rangeToUse[0]) / (model.opacities.length - 1);\n    var nodes = [];\n    var midpoint = 0.5;\n    var sharpness = 0;\n    for (var index = 0; index < model.opacities.length; index++) {\n      var x = rangeToUse[0] + delta * index;\n      var y = model.opacities[index];\n      nodes.push({\n        x: x,\n        y: y,\n        midpoint: midpoint,\n        sharpness: sharpness\n      });\n    }\n    return nodes;\n  };\n  publicAPI.applyOpacity = function (piecewiseFunction, dataRange) {\n    var nodes = publicAPI.getOpacityNodes(dataRange);\n    piecewiseFunction.setNodes(nodes);\n  };\n  publicAPI.getOpacityRange = function (dataRange) {\n    var rangeToUse = dataRange || model.dataRange;\n    var delta = (rangeToUse[1] - rangeToUse[0]) / (model.opacities.length - 1);\n    var minIndex = model.opacities.length - 1;\n    var maxIndex = 0;\n    for (var index = 0; index < model.opacities.length; index++) {\n      if (model.opacities[index] > 0) {\n        minIndex = Math.min(minIndex, index);\n      }\n      if (model.opacities[index] > 0) {\n        maxIndex = Math.max(maxIndex, index);\n      }\n    }\n    return [rangeToUse[0] + minIndex * delta, rangeToUse[0] + maxIndex * delta];\n  };\n  var enableZoom = publicAPI.setEnableRangeZoom;\n  publicAPI.setEnableRangeZoom = function (v) {\n    var change = enableZoom(v);\n    if (change) {\n      model.colorCanvasMTime = 0;\n      model.rangeZoom = [0, 1];\n    }\n    return change;\n  };\n  var rangeZoom = publicAPI.setRangeZoom;\n  publicAPI.setRangeZoom = function () {\n    var change = rangeZoom.apply(void 0, arguments);\n    if (change) {\n      model.colorCanvasMTime = 0;\n    }\n    return change;\n  }; // Trigger rendering for any modified event\n\n  publicAPI.onModified(function () {\n    return publicAPI.render();\n  });\n  publicAPI.setSize.apply(publicAPI, _toConsumableArray(model.size));\n} // ----------------------------------------------------------------------------\n// Object factory\n// ----------------------------------------------------------------------------\n\nvar DEFAULT_VALUES = {\n  histogram: [],\n  numberOfBins: 256,\n  histogramArray: null,\n  dataRange: [0, 1],\n  gaussians: [],\n  opacities: [],\n  size: [600, 300],\n  piecewiseSize: 256,\n  colorCanvasMTime: 0,\n  gaussianMinimumHeight: 0.05,\n  style: {\n    backgroundColor: 'rgba(255, 255, 255, 1)',\n    histogramColor: 'rgba(200, 200, 200, 0.5)',\n    strokeColor: 'rgb(0, 0, 0)',\n    activeColor: 'rgb(0, 0, 150)',\n    buttonDisableFillColor: 'rgba(255, 255, 255, 0.5)',\n    buttonDisableStrokeColor: 'rgba(0, 0, 0, 0.5)',\n    buttonStrokeColor: 'rgba(0, 0, 0, 1)',\n    buttonFillColor: 'rgba(255, 255, 255, 1)',\n    handleColor: 'rgb(0, 150, 0)',\n    strokeWidth: 2,\n    activeStrokeWidth: 3,\n    buttonStrokeWidth: 1.5,\n    handleWidth: 3,\n    iconSize: 20,\n    padding: 10,\n    zoomControlHeight: 10,\n    zoomControlColor: '#999'\n  },\n  activeGaussian: -1,\n  selectedGaussian: -1,\n  enableRangeZoom: true,\n  rangeZoom: [0, 1] // normalized value\n}; // ----------------------------------------------------------------------------\n\nfunction extend(publicAPI, model) {\n  var initialValues = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  Object.assign(model, DEFAULT_VALUES, initialValues); // Object methods\n\n  macro.obj(publicAPI, model);\n  macro.setGet(publicAPI, model, ['piecewiseSize', 'numberOfBins', 'colorTransferFunction', 'backgroundImage', 'enableRangeZoom', 'gaussianMinimumHeight']);\n  macro.setGetArray(publicAPI, model, ['rangeZoom'], 2);\n  macro.get(publicAPI, model, ['size', 'canvas', 'gaussians']);\n  macro.event(publicAPI, model, 'opacityChange');\n  macro.event(publicAPI, model, 'animation');\n  macro.event(publicAPI, model, 'zoomChange'); // Object specific methods\n\n  vtkPiecewiseGaussianWidget(publicAPI, model);\n} // ----------------------------------------------------------------------------\n\nvar newInstance = macro.newInstance(extend, 'vtkPiecewiseGaussianWidget'); // ----------------------------------------------------------------------------\n\nvar vtkPiecewiseGaussianWidget$1 = _objectSpread({\n  newInstance: newInstance,\n  extend: extend\n}, STATIC);\nexport { STATIC, vtkPiecewiseGaussianWidget$1 as default, extend, newInstance };","map":{"version":3,"names":["_slicedToArray","_defineProperty","_toConsumableArray","macro","D","arrayRange","WebworkerPromise","W","WorkerFactory","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","getOwnPropertyDescriptors","defineProperties","defineProperty","MIN_GAUSSIAN_WIDTH","ACTION_TO_CURSOR","adjustPosition","adjustHeight","adjustBias","adjustWidth","adjustZoom","TOUCH_CLICK","ACTIONS","x","y","_ref","originalXY","gaussian","originalGaussian","xOffset","position","_ref2","model","height","Math","min","max","gaussianMinimumHeight","_ref3","xBias","yBias","_ref4","gaussianSide","width","_ref5","rangeZoom","publicAPI","delta","absNormX","minDelta","abs","maxDelta","meanDelta","halfDelta","invokeZoomChange","computeOpacities","gaussians","sampling","undefined","opacities","count","_gaussians$count","correctedWidth","x0","x1","h0a","exp","h0b","h0c","h1","h2","applyGaussianToPiecewiseFunction","rangeToUse","piecewiseFunction","nodes","midpoint","sharpness","index","setNodes","drawChart","ctx","area","values","style","lineWidth","strokeStyle","verticalScale","horizontalScale","fill","fillStyle","offset","beginPath","moveTo","lineTo","clip","stroke","updateColorCanvas","colorTransferFunction","canvas","workCanvas","document","createElement","setAttribute","getContext","rgba","getUint8Table","pixelsArea","getImageData","lineIdx","data","set","nbValues","lineSize","floor","putImageData","updateColorCanvasFromImage","img","drawImage","normalizeCoordinates","subRectangeArea","zoomRange","findGaussian","distances","map","g","indexOf","createListener","callback","preventDefault","e","offsetX","offsetY","createTouchClickListener","id","_len","callbacks","Array","_key","timeout","deltaT","ready","processTouchClicks","t","touchHandle","touches","clicks","action","singleTouche","ts","createTouchListener","nbTouches","targetBounds","getBoundingClientRect","relativeTouches","prototype","call","pageX","left","pageY","top","reduce","a","b","v","type","clearTimeout","timeStamp","setTimeout","listenerSelector","condition","ok","ko","rescaleArray","array","focusArea","maxIdx","idxRange","round","slice","rescaleValue","value","STATIC","vtkPiecewiseGaussianWidget","classHierarchy","setContainer","el","container","removeChild","appendChild","modified","setGaussians","piecewiseSize","invokeOpacityChange","addGaussian","nextIndex","removeGaussian","splice","setSize","size","colorCanvasMTime","updateStyle","setDataArray","_ref6","_ref6$numberOfBinToCo","numberOfBinToConsiders","_ref6$numberOfBinsToS","numberOfBinsToSkip","_ref6$numberOfCompone","numberOfComponents","_ref6$component","component","histogram","histogramArray","dataRange","_model$dataRange","maxNumberOfWorkers","arrayStride","arrayIndex","workerChunks","workers","worker","workerPromise","arrayStart","arrayEnd","subArray","constructor","postMessage","numberOfBins","buffer","Promise","all","then","subHistograms","terminate","Float32Array","subHistogram","len","sampleSize","sortedArray","from","sort","Number","pop","shift","mean","_i","render","onClick","_normalizeCoordinates","graphArea","enableRangeZoom","_normalizeCoordinates2","xNormalized","yNormalized","iconSize","padding","buttonIdx","gaussianIdx","activeGaussian","selectedGaussian","setImmediate","onDown","dragAction","newSelected","onHover","tolerance","_normalizeCoordinates3","_normalizeCoordinates4","_normalizeCoordinates5","_normalizeCoordinates6","xNormalizedAbs","newActive","cursor","thirdDelta","invY","actionName","mouseIsDown","invokeAnimation","onDrag","_normalizeCoordinates7","_normalizeCoordinates8","onUp","onLeave","onAddGaussian","_normalizeCoordinates9","_normalizeCoordinates10","onRemoveGaussian","bindMouseListeners","listeners","isDown","touchId","mousemove","dblclick","contextmenu","click","mouseup","mousedown","mouseout","touchstart","chain","touchmove","touchend","eventType","addEventListener","unbindMouseListeners","removeEventListener","imageSmoothingEnabled","_model$size","ceil","zoomControlHeight","clearRect","lineJoin","backgroundColor","fillRect","halfSize","strokeWidth","center","buttonStrokeWidth","buttonStrokeColor","arc","PI","buttonFillColor","buttonDisableFillColor","buttonDisableStrokeWidth","buttonDisableStrokeColor","histogramColor","strokeColor","getSize","getMappingRange","colorCanvas","getMTime","save","restore","backgroundImage","zoomControlColor","rect","activeOpacities","activeStrokeWidth","activeColor","xCenter","yTop","yMiddle","yBottom","widthInPixel","handleWidth","handleColor","radius","sliderWidth","getOpacityNodes","applyOpacity","getOpacityRange","minIndex","maxIndex","enableZoom","setEnableRangeZoom","change","setRangeZoom","onModified","DEFAULT_VALUES","extend","initialValues","assign","obj","setGet","setGetArray","get","event","newInstance","vtkPiecewiseGaussianWidget$1","default"],"sources":["/home/rakshith/Documents/RemoteRendering/vtk-js-react-app/node_modules/@kitware/vtk.js/Interaction/Widgets/PiecewiseGaussianWidget.js"],"sourcesContent":["import _slicedToArray from '@babel/runtime/helpers/slicedToArray';\nimport _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport _toConsumableArray from '@babel/runtime/helpers/toConsumableArray';\nimport macro from '../../macros.js';\nimport { D as arrayRange } from '../../Common/Core/Math/index.js';\nimport WebworkerPromise from 'webworker-promise';\nimport { W as WorkerFactory } from '../../_virtual/rollup-plugin-worker-loader__module_Sources/Interaction/Widgets/PiecewiseGaussianWidget/ComputeHistogram.worker.js';\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n/* eslint-disable no-continue */\n// ----------------------------------------------------------------------------\n// Global structures\n// ----------------------------------------------------------------------------\n\nvar MIN_GAUSSIAN_WIDTH = 0.001;\nvar ACTION_TO_CURSOR = {\n  adjustPosition: '-webkit-grab',\n  adjustHeight: 'row-resize',\n  adjustBias: 'crosshair',\n  adjustWidth: 'col-resize',\n  adjustZoom: 'col-resize'\n};\nvar TOUCH_CLICK = []; // ----------------------------------------------------------------------------\n// Global methods\n// ----------------------------------------------------------------------------\n\nvar ACTIONS = {\n  adjustPosition: function adjustPosition(x, y, _ref) {\n    var originalXY = _ref.originalXY,\n        gaussian = _ref.gaussian,\n        originalGaussian = _ref.originalGaussian;\n    var xOffset = originalGaussian.position - originalXY[0];\n    gaussian.position = x + xOffset;\n    return true;\n  },\n  adjustHeight: function adjustHeight(x, y, _ref2) {\n    var model = _ref2.model,\n        gaussian = _ref2.gaussian;\n    gaussian.height = 1 - y;\n    gaussian.height = Math.min(1, Math.max(model.gaussianMinimumHeight, gaussian.height));\n    return true;\n  },\n  adjustBias: function adjustBias(x, y, _ref3) {\n    var originalXY = _ref3.originalXY,\n        gaussian = _ref3.gaussian,\n        originalGaussian = _ref3.originalGaussian;\n    gaussian.xBias = originalGaussian.xBias - (originalXY[0] - x) / gaussian.height;\n    gaussian.yBias = originalGaussian.yBias + 4 * (originalXY[1] - y) / gaussian.height; // Clamps\n\n    gaussian.xBias = Math.max(-1, Math.min(1, gaussian.xBias));\n    gaussian.yBias = Math.max(0, Math.min(2, gaussian.yBias));\n    return true;\n  },\n  adjustWidth: function adjustWidth(x, y, _ref4) {\n    var originalXY = _ref4.originalXY,\n        gaussian = _ref4.gaussian,\n        originalGaussian = _ref4.originalGaussian,\n        gaussianSide = _ref4.gaussianSide;\n    gaussian.width = gaussianSide < 0 ? originalGaussian.width - (originalXY[0] - x) : originalGaussian.width + (originalXY[0] - x);\n\n    if (gaussian.width < MIN_GAUSSIAN_WIDTH) {\n      gaussian.width = MIN_GAUSSIAN_WIDTH;\n    }\n\n    return true;\n  },\n  adjustZoom: function adjustZoom(x, y, _ref5) {\n    var rangeZoom = _ref5.rangeZoom,\n        publicAPI = _ref5.publicAPI;\n    var delta = rangeZoom[1] - rangeZoom[0];\n    var absNormX = (x - rangeZoom[0]) / delta;\n    var minDelta = Math.abs(absNormX - rangeZoom[0]);\n    var maxDelta = Math.abs(absNormX - rangeZoom[1]);\n    var meanDelta = Math.abs(absNormX - 0.5 * (rangeZoom[0] + rangeZoom[1]));\n\n    if (meanDelta < Math.min(minDelta, maxDelta)) {\n      var halfDelta = delta * 0.5;\n      rangeZoom[0] = Math.min(Math.max(absNormX - halfDelta, 0), rangeZoom[1] - 0.1);\n      rangeZoom[1] = Math.max(Math.min(absNormX + halfDelta, 1), rangeZoom[0] + 0.1);\n    } else if (minDelta < maxDelta) {\n      rangeZoom[0] = Math.min(Math.max(absNormX, 0), rangeZoom[1] - 0.1);\n    } else {\n      rangeZoom[1] = Math.max(Math.min(absNormX, 1), rangeZoom[0] + 0.1);\n    }\n\n    publicAPI.invokeZoomChange(rangeZoom); // The opacity did not changed\n\n    return false;\n  }\n}; // ----------------------------------------------------------------------------\n\nfunction computeOpacities(gaussians) {\n  var sampling = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 256;\n  var opacities = [];\n\n  while (opacities.length < sampling) {\n    opacities.push(0);\n  }\n\n  var count = gaussians.length;\n\n  while (count--) {\n    var _gaussians$count = gaussians[count],\n        position = _gaussians$count.position,\n        height = _gaussians$count.height,\n        width = _gaussians$count.width,\n        xBias = _gaussians$count.xBias,\n        yBias = _gaussians$count.yBias;\n\n    for (var i = 0; i < sampling; i++) {\n      var x = i / (sampling - 1); // clamp non-zero values to pos +/- width\n\n      if (x > position + width || x < position - width) {\n        if (opacities[i] < 0.0) {\n          opacities[i] = 0.0;\n        }\n\n        continue;\n      } // non-zero width\n\n\n      var correctedWidth = width < MIN_GAUSSIAN_WIDTH ? MIN_GAUSSIAN_WIDTH : width; // translate the original x to a new x based on the xbias\n\n      var x0 = 0;\n\n      if (xBias === 0 || x === position + xBias) {\n        x0 = x;\n      } else if (x > position + xBias) {\n        if (correctedWidth === xBias) {\n          x0 = position;\n        } else {\n          x0 = position + (x - position - xBias) * (correctedWidth / (correctedWidth - xBias));\n        }\n      } else if (-correctedWidth === xBias) {\n        // (x < pos+xBias)\n        x0 = position;\n      } else {\n        x0 = position - (x - position - xBias) * (correctedWidth / (correctedWidth + xBias));\n      } // center around 0 and normalize to -1,1\n\n\n      var x1 = (x0 - position) / correctedWidth; // do a linear interpolation between:\n      //    a gaussian and a parabola        if 0 < yBias <1\n      //    a parabola and a step function   if 1 < yBias <2\n\n      var h0a = Math.exp(-(4 * x1 * x1));\n      var h0b = 1.0 - x1 * x1;\n      var h0c = 1.0;\n      var h1 = void 0;\n\n      if (yBias < 1) {\n        h1 = yBias * h0b + (1 - yBias) * h0a;\n      } else {\n        h1 = (2 - yBias) * h0b + (yBias - 1) * h0c;\n      }\n\n      var h2 = height * h1; // perform the MAX over different gaussians, not the sum\n\n      if (h2 > opacities[i]) {\n        opacities[i] = h2;\n      }\n    }\n  }\n\n  return opacities;\n} // ----------------------------------------------------------------------------\n\n\nfunction applyGaussianToPiecewiseFunction(gaussians, sampling, rangeToUse, piecewiseFunction) {\n  var opacities = computeOpacities(gaussians, sampling);\n  var nodes = [];\n  var delta = (rangeToUse[1] - rangeToUse[0]) / (opacities.length - 1);\n  var midpoint = 0.5;\n  var sharpness = 0;\n\n  for (var index = 0; index < opacities.length; index++) {\n    var x = rangeToUse[0] + delta * index;\n    var y = opacities[index];\n    nodes.push({\n      x: x,\n      y: y,\n      midpoint: midpoint,\n      sharpness: sharpness\n    });\n  }\n\n  piecewiseFunction.setNodes(nodes);\n} // ----------------------------------------------------------------------------\n\n\nfunction drawChart(ctx, area, values) {\n  var style = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {\n    lineWidth: 1,\n    strokeStyle: '#000'\n  };\n  var verticalScale = area[3];\n  var horizontalScale = area[2] / (values.length - 1);\n  var fill = !!style.fillStyle;\n  var offset = verticalScale + area[1];\n  ctx.lineWidth = style.lineWidth;\n  ctx.strokeStyle = style.strokeStyle;\n  ctx.beginPath();\n  ctx.moveTo(area[0], area[1] + area[3]);\n\n  for (var index = 0; index < values.length; index++) {\n    ctx.lineTo(area[0] + index * horizontalScale, Math.max(area[1], offset - values[index] * verticalScale));\n  }\n\n  if (fill) {\n    ctx.fillStyle = style.fillStyle;\n    ctx.lineTo(area[0] + area[2], area[1] + area[3]);\n\n    if (style.clip) {\n      ctx.clip();\n      return;\n    }\n\n    ctx.fill();\n  }\n\n  ctx.stroke();\n} // ----------------------------------------------------------------------------\n\n\nfunction updateColorCanvas(colorTransferFunction, width, rangeToUse, canvas) {\n  var workCanvas = canvas || document.createElement('canvas');\n  workCanvas.setAttribute('width', width);\n  workCanvas.setAttribute('height', 256);\n  var ctx = workCanvas.getContext('2d');\n  var rgba = colorTransferFunction.getUint8Table(rangeToUse[0], rangeToUse[1], width, 4);\n  var pixelsArea = ctx.getImageData(0, 0, width, 256);\n\n  for (var lineIdx = 0; lineIdx < 256; lineIdx++) {\n    pixelsArea.data.set(rgba, lineIdx * 4 * width);\n  }\n\n  var nbValues = 256 * width * 4;\n  var lineSize = width * 4;\n\n  for (var i = 3; i < nbValues; i += 4) {\n    pixelsArea.data[i] = 255 - Math.floor(i / lineSize);\n  }\n\n  ctx.putImageData(pixelsArea, 0, 0);\n  return workCanvas;\n} // ----------------------------------------------------------------------------\n\n\nfunction updateColorCanvasFromImage(img, width, canvas) {\n  var workCanvas = canvas || document.createElement('canvas');\n  workCanvas.setAttribute('width', width);\n  workCanvas.setAttribute('height', 256);\n  var ctx = workCanvas.getContext('2d');\n  ctx.drawImage(img, 0, 0, img.width, img.height, 0, 0, width, 256);\n  return workCanvas;\n} // ----------------------------------------------------------------------------\n\n\nfunction normalizeCoordinates(x, y, subRectangeArea) {\n  var zoomRange = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : [0, 1];\n  return [zoomRange[0] + (x - subRectangeArea[0]) / subRectangeArea[2] * (zoomRange[1] - zoomRange[0]), (y - subRectangeArea[1]) / subRectangeArea[3]];\n} // ----------------------------------------------------------------------------\n\n\nfunction findGaussian(x, gaussians) {\n  var distances = gaussians.map(function (g) {\n    return Math.abs(g.position - x);\n  });\n  var min = Math.min.apply(Math, _toConsumableArray(distances));\n  return distances.indexOf(min);\n} // ----------------------------------------------------------------------------\n\n\nfunction createListener(callback) {\n  var preventDefault = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n  return function (e) {\n    var offsetX = e.offsetX,\n        offsetY = e.offsetY;\n\n    if (preventDefault) {\n      e.preventDefault();\n    }\n\n    callback(offsetX, offsetY);\n  };\n} // ----------------------------------------------------------------------------\n\n\nfunction createTouchClickListener() {\n  var id = TOUCH_CLICK.length;\n\n  for (var _len = arguments.length, callbacks = new Array(_len), _key = 0; _key < _len; _key++) {\n    callbacks[_key] = arguments[_key];\n  }\n\n  TOUCH_CLICK.push({\n    callbacks: callbacks,\n    timeout: 0,\n    deltaT: 200,\n    count: 0,\n    ready: false\n  });\n  return id;\n} // ----------------------------------------------------------------------------\n\n\nfunction processTouchClicks() {\n  TOUCH_CLICK.filter(function (t) {\n    return t.ready;\n  }).forEach(function (touchHandle) {\n    touchHandle.callbacks.forEach(function (callback) {\n      if (callback.touches === touchHandle.touches && callback.clicks === touchHandle.count) {\n        callback.action.apply(callback, _toConsumableArray(touchHandle.singleTouche));\n      }\n    }); // Clear state\n\n    touchHandle.ts = 0;\n    touchHandle.count = 0;\n    touchHandle.touches = 0;\n    touchHandle.ready = false;\n  });\n} // ----------------------------------------------------------------------------\n\n\nfunction createTouchListener(id, callback) {\n  var nbTouches = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n  var preventDefault = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n  return function (e) {\n    var targetBounds = e.target.getBoundingClientRect();\n    var relativeTouches = Array.prototype.map.call(e.touches, function (t) {\n      return [t.pageX - targetBounds.left, t.pageY - targetBounds.top];\n    });\n    var singleTouche = relativeTouches.reduce(function (a, b) {\n      return [a[0] + b[0], a[1] + b[1]];\n    }, [0, 0]).map(function (v) {\n      return v / e.touches.length;\n    });\n\n    if (e.type === 'touchstart') {\n      clearTimeout(TOUCH_CLICK[id].timeout);\n      TOUCH_CLICK[id].ts = e.timeStamp;\n      TOUCH_CLICK[id].singleTouche = singleTouche;\n      TOUCH_CLICK[id].touches = e.touches.length;\n    } else if (e.type === 'touchmove') {\n      TOUCH_CLICK[id].ts = 0;\n      TOUCH_CLICK[id].count = 0;\n      TOUCH_CLICK[id].ready = false;\n    } else if (e.type === 'touchend') {\n      if (e.timeStamp - TOUCH_CLICK[id].ts < TOUCH_CLICK[id].deltaT) {\n        TOUCH_CLICK[id].count += 1;\n        TOUCH_CLICK[id].ready = true;\n\n        if (preventDefault) {\n          e.preventDefault();\n        }\n\n        TOUCH_CLICK[id].timeout = setTimeout(processTouchClicks, TOUCH_CLICK[id].deltaT);\n      } else {\n        TOUCH_CLICK[id].ready = false;\n      }\n    }\n\n    if (e.touches.length === nbTouches) {\n      callback.apply(void 0, _toConsumableArray(singleTouche));\n\n      if (preventDefault) {\n        e.preventDefault();\n      }\n    }\n  };\n} // ----------------------------------------------------------------------------\n\n\nfunction listenerSelector(condition, ok, ko) {\n  return function (e) {\n    return condition() ? ok(e) : ko(e);\n  };\n} // ----------------------------------------------------------------------------\n\n\nfunction rescaleArray(array, focusArea) {\n  if (!focusArea) {\n    return array;\n  }\n\n  var maxIdx = array.length - 1;\n  var idxRange = focusArea.map(function (v) {\n    return Math.round(v * maxIdx);\n  });\n  return array.slice(idxRange[0], idxRange[1] + 1);\n} // ----------------------------------------------------------------------------\n\n\nfunction rescaleValue(value, focusArea) {\n  if (!focusArea) {\n    return value;\n  }\n\n  return (value - focusArea[0]) / (focusArea[1] - focusArea[0]);\n} // ----------------------------------------------------------------------------\n// Static API\n// ----------------------------------------------------------------------------\n\n\nvar STATIC = {\n  applyGaussianToPiecewiseFunction: applyGaussianToPiecewiseFunction,\n  computeOpacities: computeOpacities,\n  createListener: createListener,\n  drawChart: drawChart,\n  findGaussian: findGaussian,\n  listenerSelector: listenerSelector,\n  normalizeCoordinates: normalizeCoordinates\n}; // ----------------------------------------------------------------------------\n// vtkPiecewiseGaussianWidget methods\n// ----------------------------------------------------------------------------\n\nfunction vtkPiecewiseGaussianWidget(publicAPI, model) {\n  // Set our className\n  model.classHierarchy.push('vtkPiecewiseGaussianWidget');\n\n  if (!model.canvas) {\n    model.canvas = document.createElement('canvas');\n  }\n\n  publicAPI.setContainer = function (el) {\n    if (model.container && model.container !== el) {\n      model.container.removeChild(model.canvas);\n    }\n\n    if (model.container !== el) {\n      model.container = el;\n\n      if (model.container) {\n        model.container.appendChild(model.canvas);\n      }\n\n      publicAPI.modified();\n    }\n  };\n\n  publicAPI.setGaussians = function (gaussians) {\n    if (model.gaussians === gaussians) {\n      return;\n    }\n\n    model.gaussians = gaussians;\n    model.opacities = computeOpacities(model.gaussians, model.piecewiseSize);\n    publicAPI.invokeOpacityChange(publicAPI);\n    publicAPI.modified();\n  };\n\n  publicAPI.addGaussian = function (position, height, width, xBias, yBias) {\n    var nextIndex = model.gaussians.length;\n    model.gaussians.push({\n      position: position,\n      height: height,\n      width: width,\n      xBias: xBias,\n      yBias: yBias\n    });\n    model.opacities = computeOpacities(model.gaussians, model.piecewiseSize);\n    publicAPI.invokeOpacityChange(publicAPI);\n    publicAPI.modified();\n    return nextIndex;\n  };\n\n  publicAPI.removeGaussian = function (index) {\n    model.gaussians.splice(index, 1);\n    model.opacities = computeOpacities(model.gaussians, model.piecewiseSize);\n    publicAPI.invokeOpacityChange(publicAPI);\n    publicAPI.modified();\n  };\n\n  publicAPI.setSize = function (width, height) {\n    model.canvas.setAttribute('width', width);\n    model.canvas.setAttribute('height', height);\n\n    if (model.size[0] !== width || model.size[1] !== height) {\n      model.size = [width, height];\n      model.colorCanvasMTime = 0;\n      publicAPI.modified();\n    }\n  };\n\n  publicAPI.updateStyle = function (style) {\n    model.style = _objectSpread(_objectSpread({}, model.style), style);\n    publicAPI.modified();\n  }; // Method used to compute and show data distribution in the background.\n  // When an array with many components is used, you can provide additional\n  // information to choose which component you want to extract the histogram\n  // from.\n\n\n  publicAPI.setDataArray = function (array) {\n    var _ref6 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n        _ref6$numberOfBinToCo = _ref6.numberOfBinToConsiders,\n        numberOfBinToConsiders = _ref6$numberOfBinToCo === void 0 ? 1 : _ref6$numberOfBinToCo,\n        _ref6$numberOfBinsToS = _ref6.numberOfBinsToSkip,\n        numberOfBinsToSkip = _ref6$numberOfBinsToS === void 0 ? 1 : _ref6$numberOfBinsToS,\n        _ref6$numberOfCompone = _ref6.numberOfComponents,\n        numberOfComponents = _ref6$numberOfCompone === void 0 ? 1 : _ref6$numberOfCompone,\n        _ref6$component = _ref6.component,\n        component = _ref6$component === void 0 ? 0 : _ref6$component;\n\n    model.histogram = null;\n    model.histogramArray = array;\n    model.dataRange = arrayRange(array, component, numberOfComponents);\n\n    var _model$dataRange = _slicedToArray(model.dataRange, 2),\n        min = _model$dataRange[0],\n        max = _model$dataRange[1];\n\n    var maxNumberOfWorkers = 4;\n    var arrayStride = Math.floor(array.length / maxNumberOfWorkers) || 1;\n    arrayStride += arrayStride % numberOfComponents;\n    var arrayIndex = 0;\n    var workerChunks = [];\n    var workers = [];\n\n    while (arrayIndex < array.length) {\n      var worker = new WorkerFactory();\n      workers.push(worker);\n      var workerPromise = new WebworkerPromise(worker);\n      var arrayStart = arrayIndex;\n      var arrayEnd = Math.min(arrayIndex + arrayStride, array.length - 1);\n      var subArray = new array.constructor(array.slice(arrayStart, arrayEnd + 1));\n      workerChunks.push(workerPromise.postMessage({\n        array: subArray,\n        component: component,\n        numberOfComponents: numberOfComponents,\n        min: min,\n        max: max,\n        numberOfBins: model.numberOfBins\n      }, [subArray.buffer]));\n      arrayIndex += arrayStride;\n    }\n\n    Promise.all(workerChunks).then(function (subHistograms) {\n      workers.forEach(function (worker) {\n        return worker.terminate();\n      });\n      model.histogram = new Float32Array(model.numberOfBins);\n      model.histogram.fill(0);\n      subHistograms.forEach(function (subHistogram) {\n        for (var i = 0, len = subHistogram.length; i < len; ++i) {\n          model.histogram[i] += subHistogram[i];\n        }\n      }); // Smart Rescale Histogram\n\n      var sampleSize = Math.min(numberOfBinToConsiders, model.histogram.length - numberOfBinsToSkip);\n      var sortedArray = Array.from(model.histogram);\n      sortedArray.sort(function (a, b) {\n        return Number(a) - Number(b);\n      });\n\n      for (var i = 0; i < numberOfBinsToSkip; i++) {\n        sortedArray.pop();\n      }\n\n      while (sortedArray.length > sampleSize) {\n        sortedArray.shift();\n      }\n\n      var mean = sortedArray.reduce(function (a, b) {\n        return a + b;\n      }, 0) / sampleSize;\n\n      for (var _i = 0, len = model.histogram.length; _i < len; ++_i) {\n        model.histogram[_i] /= mean;\n      }\n\n      publicAPI.modified();\n      setTimeout(publicAPI.render, 0);\n    });\n    publicAPI.modified();\n  };\n\n  publicAPI.onClick = function (x, y) {\n    var _normalizeCoordinates = normalizeCoordinates(x, y, model.graphArea, model.enableRangeZoom ? model.rangeZoom : null),\n        _normalizeCoordinates2 = _slicedToArray(_normalizeCoordinates, 2),\n        xNormalized = _normalizeCoordinates2[0],\n        yNormalized = _normalizeCoordinates2[1];\n\n    if (xNormalized < 0 && model.style.iconSize > 1) {\n      // Control buttons\n      var delta = model.style.iconSize + model.style.padding;\n      var offset = delta;\n      var buttonIdx = 0;\n\n      while (y > offset) {\n        buttonIdx += 1;\n        offset += delta;\n      }\n\n      switch (buttonIdx) {\n        case 0:\n          {\n            var gaussianIdx = publicAPI.addGaussian(0, 1, 0.1, 0, 0);\n            var gaussian = model.gaussians[gaussianIdx];\n\n            var originalGaussian = _objectSpread({}, gaussian);\n\n            var action = ACTIONS.adjustPosition;\n            model.activeGaussian = gaussianIdx;\n            model.selectedGaussian = gaussianIdx; // Fake active action\n\n            macro.setImmediate(function () {\n              publicAPI.onDown(x, y);\n              model.dragAction = {\n                originalXY: [0, 0],\n                action: action,\n                gaussian: gaussian,\n                originalGaussian: originalGaussian\n              };\n            });\n            break;\n          }\n\n        case 1:\n          {\n            if (model.selectedGaussian !== -1) {\n              publicAPI.removeGaussian(model.selectedGaussian);\n            }\n\n            break;\n          }\n\n        default:\n          {\n            model.selectedGaussian = -1;\n            model.dragAction = null;\n          }\n      }\n    } else if (xNormalized < 0 || xNormalized > 1 || yNormalized < 0 || yNormalized > 1) {\n      model.selectedGaussian = -1;\n      model.dragAction = null;\n    } else {\n      var newSelected = findGaussian(xNormalized, model.gaussians);\n\n      if (newSelected !== model.selectedGaussian) {\n        model.selectedGaussian = newSelected;\n        publicAPI.modified();\n      }\n    }\n\n    return true;\n  };\n\n  publicAPI.onHover = function (x, y) {\n    // Determines the interaction region size for adjusting the Gaussian's\n    // height.\n    var tolerance = 20 / model.canvas.height;\n\n    var _normalizeCoordinates3 = normalizeCoordinates(x, y, model.graphArea, model.enableRangeZoom ? model.rangeZoom : null),\n        _normalizeCoordinates4 = _slicedToArray(_normalizeCoordinates3, 2),\n        xNormalized = _normalizeCoordinates4[0],\n        yNormalized = _normalizeCoordinates4[1];\n\n    var _normalizeCoordinates5 = normalizeCoordinates(x, y, model.graphArea),\n        _normalizeCoordinates6 = _slicedToArray(_normalizeCoordinates5, 1),\n        xNormalizedAbs = _normalizeCoordinates6[0];\n\n    var newActive = xNormalized < 0 ? model.selectedGaussian : findGaussian(xNormalized, model.gaussians);\n    model.canvas.style.cursor = 'default';\n    var gaussian = model.gaussians[newActive];\n\n    if (model.enableRangeZoom && xNormalizedAbs >= 0 && y < model.graphArea[1] - 6 // circle radius\n    ) {\n      var thirdDelta = (model.rangeZoom[1] - model.rangeZoom[0]) / 3;\n\n      if (xNormalizedAbs < model.rangeZoom[0] + thirdDelta || xNormalizedAbs > model.rangeZoom[1] - thirdDelta) {\n        model.canvas.style.cursor = ACTION_TO_CURSOR.adjustZoom;\n      } else {\n        model.canvas.style.cursor = ACTION_TO_CURSOR.adjustPosition;\n      }\n\n      model.dragAction = {\n        rangeZoom: model.rangeZoom,\n        action: ACTIONS.adjustZoom\n      };\n    } else if (gaussian && xNormalizedAbs >= 0) {\n      var invY = 1 - yNormalized;\n      var actionName = null;\n\n      if (invY > gaussian.height + tolerance) {\n        actionName = 'adjustPosition';\n      } else if (invY > gaussian.height - tolerance) {\n        if (Math.abs(xNormalized - gaussian.position) < tolerance) {\n          actionName = 'adjustHeight';\n        } else {\n          actionName = 'adjustPosition';\n        }\n      } else if (invY > gaussian.height * 0.5 + tolerance) {\n        actionName = 'adjustPosition';\n      } else if (invY > gaussian.height * 0.5 - tolerance) {\n        if (Math.abs(xNormalized - gaussian.position) < tolerance) {\n          actionName = 'adjustBias';\n        } else {\n          actionName = 'adjustPosition';\n        }\n      } else if (invY > tolerance) {\n        actionName = 'adjustPosition';\n      } else {\n        actionName = 'adjustWidth';\n      }\n\n      model.canvas.style.cursor = ACTION_TO_CURSOR[actionName];\n      var action = ACTIONS[actionName];\n\n      var originalGaussian = _objectSpread({}, gaussian);\n\n      model.dragAction = {\n        originalXY: [xNormalized, yNormalized],\n        action: action,\n        gaussian: gaussian,\n        originalGaussian: originalGaussian\n      };\n    }\n\n    if (newActive !== model.activeGaussian) {\n      model.activeGaussian = newActive;\n      publicAPI.modified();\n    }\n\n    return true;\n  };\n\n  publicAPI.onDown = function (x, y) {\n    if (!model.mouseIsDown) {\n      publicAPI.invokeAnimation(true);\n    }\n\n    model.mouseIsDown = true;\n    var xNormalized = normalizeCoordinates(x, y, model.graphArea, model.enableRangeZoom ? model.rangeZoom : null)[0];\n    var newSelected = findGaussian(xNormalized, model.gaussians);\n    model.gaussianSide = 0;\n    var gaussian = model.gaussians[newSelected];\n\n    if (gaussian) {\n      model.gaussianSide = gaussian.position - xNormalized;\n    }\n\n    if (newSelected !== model.selectedGaussian && xNormalized > 0) {\n      model.selectedGaussian = newSelected;\n      publicAPI.modified();\n    }\n\n    return true;\n  };\n\n  publicAPI.onDrag = function (x, y) {\n    if (model.dragAction) {\n      var _normalizeCoordinates7 = normalizeCoordinates(x, y, model.graphArea, model.enableRangeZoom ? model.rangeZoom : null),\n          _normalizeCoordinates8 = _slicedToArray(_normalizeCoordinates7, 2),\n          xNormalized = _normalizeCoordinates8[0],\n          yNormalized = _normalizeCoordinates8[1];\n\n      var action = model.dragAction.action;\n\n      if (action(xNormalized, yNormalized, _objectSpread({\n        gaussianSide: model.gaussianSide,\n        model: model,\n        publicAPI: publicAPI\n      }, model.dragAction))) {\n        model.opacities = computeOpacities(model.gaussians, model.piecewiseSize);\n        publicAPI.invokeOpacityChange(publicAPI, true);\n      }\n\n      publicAPI.modified();\n    }\n\n    return true;\n  };\n\n  publicAPI.onUp = function (x, y) {\n    if (model.mouseIsDown) {\n      publicAPI.invokeAnimation(false);\n    }\n\n    model.mouseIsDown = false;\n    return true;\n  };\n\n  publicAPI.onLeave = function (x, y) {\n    publicAPI.onUp(x, y);\n    model.canvas.style.cursor = 'default';\n    model.activeGaussian = -1;\n    publicAPI.modified();\n    return true;\n  };\n\n  publicAPI.onAddGaussian = function (x, y) {\n    var _normalizeCoordinates9 = normalizeCoordinates(x, y, model.graphArea, model.enableRangeZoom ? model.rangeZoom : null),\n        _normalizeCoordinates10 = _slicedToArray(_normalizeCoordinates9, 2),\n        xNormalized = _normalizeCoordinates10[0],\n        yNormalized = _normalizeCoordinates10[1];\n\n    if (xNormalized >= 0) {\n      publicAPI.addGaussian(xNormalized, 1 - yNormalized, 0.1, 0, 0);\n    }\n\n    return true;\n  };\n\n  publicAPI.onRemoveGaussian = function (x, y) {\n    var xNormalized = normalizeCoordinates(x, y, model.graphArea, model.enableRangeZoom ? model.rangeZoom : null)[0];\n    var newSelected = findGaussian(xNormalized, model.gaussians);\n\n    if (xNormalized >= 0 && newSelected !== -1) {\n      publicAPI.removeGaussian(newSelected);\n    }\n\n    return true;\n  };\n\n  publicAPI.bindMouseListeners = function () {\n    if (!model.listeners) {\n      var isDown = function isDown() {\n        return !!model.mouseIsDown;\n      };\n\n      var touchId = createTouchClickListener({\n        clicks: 1,\n        touches: 1,\n        action: publicAPI.onClick\n      }, {\n        clicks: 2,\n        touches: 1,\n        action: publicAPI.onAddGaussian\n      }, {\n        clicks: 2,\n        touches: 2,\n        action: publicAPI.onRemoveGaussian\n      });\n      model.listeners = {\n        mousemove: listenerSelector(isDown, createListener(publicAPI.onDrag), createListener(publicAPI.onHover)),\n        dblclick: createListener(publicAPI.onAddGaussian),\n        contextmenu: createListener(publicAPI.onRemoveGaussian),\n        click: createListener(publicAPI.onClick),\n        mouseup: createListener(publicAPI.onUp),\n        mousedown: createListener(publicAPI.onDown),\n        mouseout: createListener(publicAPI.onLeave),\n        touchstart: createTouchListener(touchId, macro.chain(publicAPI.onHover, publicAPI.onDown)),\n        touchmove: listenerSelector(isDown, createTouchListener(touchId, publicAPI.onDrag), createTouchListener(touchId, publicAPI.onHover)),\n        touchend: createTouchListener(touchId, publicAPI.onUp, 0) // touchend have 0 touch event...\n\n      };\n      Object.keys(model.listeners).forEach(function (eventType) {\n        model.canvas.addEventListener(eventType, model.listeners[eventType], false);\n      });\n    }\n  };\n\n  publicAPI.unbindMouseListeners = function () {\n    if (model.listeners) {\n      Object.keys(model.listeners).forEach(function (eventType) {\n        model.canvas.removeEventListener(eventType, model.listeners[eventType]);\n      });\n      delete model.listeners;\n    }\n  };\n\n  publicAPI.render = function () {\n    var ctx = model.canvas.getContext('2d');\n    ctx.imageSmoothingEnabled = true;\n\n    var _model$size = _slicedToArray(model.size, 2),\n        width = _model$size[0],\n        height = _model$size[1];\n\n    var offset = model.style.padding;\n    var graphArea = [Math.floor(model.style.iconSize + offset), Math.floor(offset), Math.ceil(width - 2 * offset - model.style.iconSize), Math.ceil(height - 2 * offset)];\n    var zoomControlHeight = model.style.zoomControlHeight;\n\n    if (model.enableRangeZoom) {\n      graphArea[1] += Math.floor(zoomControlHeight);\n      graphArea[3] -= Math.floor(zoomControlHeight);\n    }\n\n    model.graphArea = graphArea; // Clear canvas\n\n    ctx.clearRect(0, 0, width, height);\n    ctx.lineJoin = 'round';\n    ctx.fillStyle = model.style.backgroundColor;\n    ctx.fillRect.apply(ctx, graphArea);\n\n    if (model.style.iconSize > 1) {\n      // Draw icons\n      // +\n      var halfSize = Math.round(model.style.iconSize / 2 - model.style.strokeWidth);\n      var center = Math.round(halfSize + offset + model.style.strokeWidth);\n      ctx.beginPath();\n      ctx.lineWidth = model.style.buttonStrokeWidth;\n      ctx.strokeStyle = model.style.buttonStrokeColor;\n      ctx.arc(center - offset / 2, center, halfSize, 0, 2 * Math.PI, false);\n      ctx.fillStyle = model.style.buttonFillColor;\n      ctx.fill();\n      ctx.stroke();\n      ctx.moveTo(center - halfSize + model.style.strokeWidth + 2 - offset / 2, center);\n      ctx.lineTo(center + halfSize - model.style.strokeWidth - 2 - offset / 2, center);\n      ctx.stroke();\n      ctx.moveTo(center - offset / 2, center - halfSize + model.style.strokeWidth + 2);\n      ctx.lineTo(center - offset / 2, center + halfSize - model.style.strokeWidth - 2);\n      ctx.stroke(); // -\n\n      if (model.selectedGaussian === -1) {\n        ctx.fillStyle = model.style.buttonDisableFillColor;\n        ctx.lineWidth = model.style.buttonDisableStrokeWidth;\n        ctx.strokeStyle = model.style.buttonDisableStrokeColor;\n      } else {\n        ctx.fillStyle = model.style.buttonFillColor;\n        ctx.lineWidth = model.style.buttonStrokeWidth;\n        ctx.strokeStyle = model.style.buttonStrokeColor;\n      }\n\n      ctx.beginPath();\n      ctx.arc(center - offset / 2, center + offset / 2 + model.style.iconSize, halfSize, 0, 2 * Math.PI, false);\n      ctx.fill();\n      ctx.stroke();\n      ctx.moveTo(center - halfSize + model.style.strokeWidth + 2 - offset / 2, center + offset / 2 + model.style.iconSize);\n      ctx.lineTo(center + halfSize - model.style.strokeWidth - 2 - offset / 2, center + offset / 2 + model.style.iconSize);\n      ctx.stroke();\n    } // Draw histogram\n\n\n    if (model.histogram) {\n      drawChart(ctx, graphArea, rescaleArray(model.histogram, model.rangeZoom), {\n        lineWidth: 1,\n        strokeStyle: model.style.histogramColor,\n        fillStyle: model.style.histogramColor\n      });\n    } // Draw gaussians\n\n\n    drawChart(ctx, graphArea, rescaleArray(model.opacities, model.enableRangeZoom && model.rangeZoom), {\n      lineWidth: model.style.strokeWidth,\n      strokeStyle: model.style.strokeColor\n    }); // Draw color function if any\n\n    if (model.colorTransferFunction && model.colorTransferFunction.getSize()) {\n      var rangeToUse = model.dataRange || model.colorTransferFunction.getMappingRange();\n\n      if (!model.colorCanvas || model.colorCanvasMTime !== model.colorTransferFunction.getMTime()) {\n        model.colorCanvasMTime = model.colorTransferFunction.getMTime();\n        model.colorCanvas = updateColorCanvas(model.colorTransferFunction, graphArea[2], rangeToUse, model.colorCanvas);\n      }\n\n      ctx.save();\n      drawChart(ctx, graphArea, rescaleArray(model.opacities, model.enableRangeZoom && model.rangeZoom), {\n        lineWidth: 1,\n        strokeStyle: 'rgba(0,0,0,0)',\n        fillStyle: 'rgba(0,0,0,1)',\n        clip: true\n      }); // Draw the correct portion of the color BG image\n\n      if (model.enableRangeZoom) {\n        ctx.drawImage(model.colorCanvas, model.rangeZoom[0] * graphArea[2], 0, graphArea[2], graphArea[3], graphArea[0], graphArea[1], graphArea[2] / (model.rangeZoom[1] - model.rangeZoom[0]), graphArea[3]);\n      } else {\n        ctx.drawImage(model.colorCanvas, graphArea[0], graphArea[1]);\n      }\n\n      ctx.restore();\n    } else if (model.backgroundImage) {\n      model.colorCanvas = updateColorCanvasFromImage(model.backgroundImage, graphArea[2], model.colorCanvas);\n      ctx.save();\n      drawChart(ctx, graphArea, rescaleArray(model.opacities, model.enableRangeZoom && model.rangeZoom), {\n        lineWidth: 1,\n        strokeStyle: 'rgba(0,0,0,0)',\n        fillStyle: 'rgba(0,0,0,1)',\n        clip: true\n      });\n      ctx.drawImage(model.colorCanvas, graphArea[0], graphArea[1]);\n      ctx.restore();\n    } // Draw zoomed area\n\n\n    if (model.enableRangeZoom) {\n      ctx.fillStyle = model.style.zoomControlColor;\n      ctx.beginPath();\n      ctx.rect(graphArea[0] + model.rangeZoom[0] * graphArea[2], 0, (model.rangeZoom[1] - model.rangeZoom[0]) * graphArea[2], zoomControlHeight);\n      ctx.fill();\n    } // Draw active gaussian\n\n\n    var activeGaussian = model.gaussians[model.activeGaussian] || model.gaussians[model.selectedGaussian];\n\n    if (activeGaussian) {\n      var activeOpacities = computeOpacities([activeGaussian], graphArea[2]);\n      drawChart(ctx, graphArea, rescaleArray(activeOpacities, model.enableRangeZoom && model.rangeZoom), {\n        lineWidth: model.style.activeStrokeWidth,\n        strokeStyle: model.style.activeColor\n      }); // Draw controls\n\n      var xCenter = graphArea[0] + rescaleValue(activeGaussian.position, model.enableRangeZoom && model.rangeZoom) * graphArea[2];\n      var yTop = graphArea[1] + (1 - activeGaussian.height) * graphArea[3];\n      var yMiddle = graphArea[1] + (1 - 0.5 * activeGaussian.height) * graphArea[3];\n      var yBottom = graphArea[1] + graphArea[3];\n      var widthInPixel = activeGaussian.width * graphArea[2];\n\n      if (model.enableRangeZoom) {\n        widthInPixel /= model.rangeZoom[1] - model.rangeZoom[0];\n      }\n\n      ctx.lineWidth = model.style.handleWidth;\n      ctx.strokeStyle = model.style.handleColor;\n      ctx.fillStyle = model.style.backgroundColor;\n      ctx.beginPath();\n      ctx.moveTo(xCenter, graphArea[1] + (1 - activeGaussian.height) * graphArea[3]);\n      ctx.lineTo(xCenter, graphArea[1] + graphArea[3]);\n      ctx.stroke(); // Height\n\n      ctx.beginPath();\n      ctx.arc(xCenter, yTop, 6, 0, 2 * Math.PI);\n      ctx.fill();\n      ctx.stroke(); // Bias\n\n      var radius = Math.min(widthInPixel * 0.1, activeGaussian.height * graphArea[3] * 0.2);\n      ctx.beginPath();\n      ctx.rect(xCenter - radius, yMiddle - radius, radius * 2, radius * 2);\n      ctx.fill();\n      ctx.stroke();\n      ctx.beginPath(); // Width\n\n      var sliderWidth = widthInPixel * 0.8;\n      ctx.rect(xCenter - sliderWidth, yBottom - 5, 2 * sliderWidth, 10);\n      ctx.fill();\n      ctx.stroke();\n    }\n  };\n\n  publicAPI.getOpacityNodes = function (dataRange) {\n    var rangeToUse = dataRange || model.dataRange;\n    var delta = (rangeToUse[1] - rangeToUse[0]) / (model.opacities.length - 1);\n    var nodes = [];\n    var midpoint = 0.5;\n    var sharpness = 0;\n\n    for (var index = 0; index < model.opacities.length; index++) {\n      var x = rangeToUse[0] + delta * index;\n      var y = model.opacities[index];\n      nodes.push({\n        x: x,\n        y: y,\n        midpoint: midpoint,\n        sharpness: sharpness\n      });\n    }\n\n    return nodes;\n  };\n\n  publicAPI.applyOpacity = function (piecewiseFunction, dataRange) {\n    var nodes = publicAPI.getOpacityNodes(dataRange);\n    piecewiseFunction.setNodes(nodes);\n  };\n\n  publicAPI.getOpacityRange = function (dataRange) {\n    var rangeToUse = dataRange || model.dataRange;\n    var delta = (rangeToUse[1] - rangeToUse[0]) / (model.opacities.length - 1);\n    var minIndex = model.opacities.length - 1;\n    var maxIndex = 0;\n\n    for (var index = 0; index < model.opacities.length; index++) {\n      if (model.opacities[index] > 0) {\n        minIndex = Math.min(minIndex, index);\n      }\n\n      if (model.opacities[index] > 0) {\n        maxIndex = Math.max(maxIndex, index);\n      }\n    }\n\n    return [rangeToUse[0] + minIndex * delta, rangeToUse[0] + maxIndex * delta];\n  };\n\n  var enableZoom = publicAPI.setEnableRangeZoom;\n\n  publicAPI.setEnableRangeZoom = function (v) {\n    var change = enableZoom(v);\n\n    if (change) {\n      model.colorCanvasMTime = 0;\n      model.rangeZoom = [0, 1];\n    }\n\n    return change;\n  };\n\n  var rangeZoom = publicAPI.setRangeZoom;\n\n  publicAPI.setRangeZoom = function () {\n    var change = rangeZoom.apply(void 0, arguments);\n\n    if (change) {\n      model.colorCanvasMTime = 0;\n    }\n\n    return change;\n  }; // Trigger rendering for any modified event\n\n\n  publicAPI.onModified(function () {\n    return publicAPI.render();\n  });\n  publicAPI.setSize.apply(publicAPI, _toConsumableArray(model.size));\n} // ----------------------------------------------------------------------------\n// Object factory\n// ----------------------------------------------------------------------------\n\n\nvar DEFAULT_VALUES = {\n  histogram: [],\n  numberOfBins: 256,\n  histogramArray: null,\n  dataRange: [0, 1],\n  gaussians: [],\n  opacities: [],\n  size: [600, 300],\n  piecewiseSize: 256,\n  colorCanvasMTime: 0,\n  gaussianMinimumHeight: 0.05,\n  style: {\n    backgroundColor: 'rgba(255, 255, 255, 1)',\n    histogramColor: 'rgba(200, 200, 200, 0.5)',\n    strokeColor: 'rgb(0, 0, 0)',\n    activeColor: 'rgb(0, 0, 150)',\n    buttonDisableFillColor: 'rgba(255, 255, 255, 0.5)',\n    buttonDisableStrokeColor: 'rgba(0, 0, 0, 0.5)',\n    buttonStrokeColor: 'rgba(0, 0, 0, 1)',\n    buttonFillColor: 'rgba(255, 255, 255, 1)',\n    handleColor: 'rgb(0, 150, 0)',\n    strokeWidth: 2,\n    activeStrokeWidth: 3,\n    buttonStrokeWidth: 1.5,\n    handleWidth: 3,\n    iconSize: 20,\n    padding: 10,\n    zoomControlHeight: 10,\n    zoomControlColor: '#999'\n  },\n  activeGaussian: -1,\n  selectedGaussian: -1,\n  enableRangeZoom: true,\n  rangeZoom: [0, 1] // normalized value\n\n}; // ----------------------------------------------------------------------------\n\nfunction extend(publicAPI, model) {\n  var initialValues = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  Object.assign(model, DEFAULT_VALUES, initialValues); // Object methods\n\n  macro.obj(publicAPI, model);\n  macro.setGet(publicAPI, model, ['piecewiseSize', 'numberOfBins', 'colorTransferFunction', 'backgroundImage', 'enableRangeZoom', 'gaussianMinimumHeight']);\n  macro.setGetArray(publicAPI, model, ['rangeZoom'], 2);\n  macro.get(publicAPI, model, ['size', 'canvas', 'gaussians']);\n  macro.event(publicAPI, model, 'opacityChange');\n  macro.event(publicAPI, model, 'animation');\n  macro.event(publicAPI, model, 'zoomChange'); // Object specific methods\n\n  vtkPiecewiseGaussianWidget(publicAPI, model);\n} // ----------------------------------------------------------------------------\n\nvar newInstance = macro.newInstance(extend, 'vtkPiecewiseGaussianWidget'); // ----------------------------------------------------------------------------\n\nvar vtkPiecewiseGaussianWidget$1 = _objectSpread({\n  newInstance: newInstance,\n  extend: extend\n}, STATIC);\n\nexport { STATIC, vtkPiecewiseGaussianWidget$1 as default, extend, newInstance };\n"],"mappings":"AAAA,OAAOA,cAAc,MAAM,sCAAsC;AACjE,OAAOC,eAAe,MAAM,uCAAuC;AACnE,OAAOC,kBAAkB,MAAM,0CAA0C;AACzE,OAAOC,KAAK,MAAM,iBAAiB;AACnC,SAASC,CAAC,IAAIC,UAAU,QAAQ,iCAAiC;AACjE,OAAOC,gBAAgB,MAAM,mBAAmB;AAChD,SAASC,CAAC,IAAIC,aAAa,QAAQ,mIAAmI;AAEtK,SAASC,OAAOA,CAACC,MAAM,EAAEC,cAAc,EAAE;EAAE,IAAIC,IAAI,GAAGC,MAAM,CAACD,IAAI,CAACF,MAAM,CAAC;EAAE,IAAIG,MAAM,CAACC,qBAAqB,EAAE;IAAE,IAAIC,OAAO,GAAGF,MAAM,CAACC,qBAAqB,CAACJ,MAAM,CAAC;IAAEC,cAAc,KAAKI,OAAO,GAAGA,OAAO,CAACC,MAAM,CAAC,UAAUC,GAAG,EAAE;MAAE,OAAOJ,MAAM,CAACK,wBAAwB,CAACR,MAAM,EAAEO,GAAG,CAAC,CAACE,UAAU;IAAE,CAAC,CAAC,CAAC,EAAEP,IAAI,CAACQ,IAAI,CAACC,KAAK,CAACT,IAAI,EAAEG,OAAO,CAAC;EAAE;EAAE,OAAOH,IAAI;AAAE;AAEpV,SAASU,aAAaA,CAACC,MAAM,EAAE;EAAE,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGC,SAAS,CAACC,MAAM,EAAEF,CAAC,EAAE,EAAE;IAAE,IAAIG,MAAM,GAAG,IAAI,IAAIF,SAAS,CAACD,CAAC,CAAC,GAAGC,SAAS,CAACD,CAAC,CAAC,GAAG,CAAC,CAAC;IAAEA,CAAC,GAAG,CAAC,GAAGf,OAAO,CAACI,MAAM,CAACc,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC,CAACC,OAAO,CAAC,UAAUC,GAAG,EAAE;MAAE5B,eAAe,CAACsB,MAAM,EAAEM,GAAG,EAAEF,MAAM,CAACE,GAAG,CAAC,CAAC;IAAE,CAAC,CAAC,GAAGhB,MAAM,CAACiB,yBAAyB,GAAGjB,MAAM,CAACkB,gBAAgB,CAACR,MAAM,EAAEV,MAAM,CAACiB,yBAAyB,CAACH,MAAM,CAAC,CAAC,GAAGlB,OAAO,CAACI,MAAM,CAACc,MAAM,CAAC,CAAC,CAACC,OAAO,CAAC,UAAUC,GAAG,EAAE;MAAEhB,MAAM,CAACmB,cAAc,CAACT,MAAM,EAAEM,GAAG,EAAEhB,MAAM,CAACK,wBAAwB,CAACS,MAAM,EAAEE,GAAG,CAAC,CAAC;IAAE,CAAC,CAAC;EAAE;EAAE,OAAON,MAAM;AAAE;AACzf;AACA;AACA;AACA;;AAEA,IAAIU,kBAAkB,GAAG,KAAK;AAC9B,IAAIC,gBAAgB,GAAG;EACrBC,cAAc,EAAE,cAAc;EAC9BC,YAAY,EAAE,YAAY;EAC1BC,UAAU,EAAE,WAAW;EACvBC,WAAW,EAAE,YAAY;EACzBC,UAAU,EAAE;AACd,CAAC;AACD,IAAIC,WAAW,GAAG,EAAE,CAAC,CAAC;AACtB;AACA;;AAEA,IAAIC,OAAO,GAAG;EACZN,cAAc,EAAE,SAASA,cAAcA,CAACO,CAAC,EAAEC,CAAC,EAAEC,IAAI,EAAE;IAClD,IAAIC,UAAU,GAAGD,IAAI,CAACC,UAAU;MAC5BC,QAAQ,GAAGF,IAAI,CAACE,QAAQ;MACxBC,gBAAgB,GAAGH,IAAI,CAACG,gBAAgB;IAC5C,IAAIC,OAAO,GAAGD,gBAAgB,CAACE,QAAQ,GAAGJ,UAAU,CAAC,CAAC,CAAC;IACvDC,QAAQ,CAACG,QAAQ,GAAGP,CAAC,GAAGM,OAAO;IAC/B,OAAO,IAAI;EACb,CAAC;EACDZ,YAAY,EAAE,SAASA,YAAYA,CAACM,CAAC,EAAEC,CAAC,EAAEO,KAAK,EAAE;IAC/C,IAAIC,KAAK,GAAGD,KAAK,CAACC,KAAK;MACnBL,QAAQ,GAAGI,KAAK,CAACJ,QAAQ;IAC7BA,QAAQ,CAACM,MAAM,GAAG,CAAC,GAAGT,CAAC;IACvBG,QAAQ,CAACM,MAAM,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC,EAAED,IAAI,CAACE,GAAG,CAACJ,KAAK,CAACK,qBAAqB,EAAEV,QAAQ,CAACM,MAAM,CAAC,CAAC;IACrF,OAAO,IAAI;EACb,CAAC;EACDf,UAAU,EAAE,SAASA,UAAUA,CAACK,CAAC,EAAEC,CAAC,EAAEc,KAAK,EAAE;IAC3C,IAAIZ,UAAU,GAAGY,KAAK,CAACZ,UAAU;MAC7BC,QAAQ,GAAGW,KAAK,CAACX,QAAQ;MACzBC,gBAAgB,GAAGU,KAAK,CAACV,gBAAgB;IAC7CD,QAAQ,CAACY,KAAK,GAAGX,gBAAgB,CAACW,KAAK,GAAG,CAACb,UAAU,CAAC,CAAC,CAAC,GAAGH,CAAC,IAAII,QAAQ,CAACM,MAAM;IAC/EN,QAAQ,CAACa,KAAK,GAAGZ,gBAAgB,CAACY,KAAK,GAAG,CAAC,IAAId,UAAU,CAAC,CAAC,CAAC,GAAGF,CAAC,CAAC,GAAGG,QAAQ,CAACM,MAAM,CAAC,CAAC;;IAErFN,QAAQ,CAACY,KAAK,GAAGL,IAAI,CAACE,GAAG,CAAC,CAAC,CAAC,EAAEF,IAAI,CAACC,GAAG,CAAC,CAAC,EAAER,QAAQ,CAACY,KAAK,CAAC,CAAC;IAC1DZ,QAAQ,CAACa,KAAK,GAAGN,IAAI,CAACE,GAAG,CAAC,CAAC,EAAEF,IAAI,CAACC,GAAG,CAAC,CAAC,EAAER,QAAQ,CAACa,KAAK,CAAC,CAAC;IACzD,OAAO,IAAI;EACb,CAAC;EACDrB,WAAW,EAAE,SAASA,WAAWA,CAACI,CAAC,EAAEC,CAAC,EAAEiB,KAAK,EAAE;IAC7C,IAAIf,UAAU,GAAGe,KAAK,CAACf,UAAU;MAC7BC,QAAQ,GAAGc,KAAK,CAACd,QAAQ;MACzBC,gBAAgB,GAAGa,KAAK,CAACb,gBAAgB;MACzCc,YAAY,GAAGD,KAAK,CAACC,YAAY;IACrCf,QAAQ,CAACgB,KAAK,GAAGD,YAAY,GAAG,CAAC,GAAGd,gBAAgB,CAACe,KAAK,IAAIjB,UAAU,CAAC,CAAC,CAAC,GAAGH,CAAC,CAAC,GAAGK,gBAAgB,CAACe,KAAK,IAAIjB,UAAU,CAAC,CAAC,CAAC,GAAGH,CAAC,CAAC;IAE/H,IAAII,QAAQ,CAACgB,KAAK,GAAG7B,kBAAkB,EAAE;MACvCa,QAAQ,CAACgB,KAAK,GAAG7B,kBAAkB;IACrC;IAEA,OAAO,IAAI;EACb,CAAC;EACDM,UAAU,EAAE,SAASA,UAAUA,CAACG,CAAC,EAAEC,CAAC,EAAEoB,KAAK,EAAE;IAC3C,IAAIC,SAAS,GAAGD,KAAK,CAACC,SAAS;MAC3BC,SAAS,GAAGF,KAAK,CAACE,SAAS;IAC/B,IAAIC,KAAK,GAAGF,SAAS,CAAC,CAAC,CAAC,GAAGA,SAAS,CAAC,CAAC,CAAC;IACvC,IAAIG,QAAQ,GAAG,CAACzB,CAAC,GAAGsB,SAAS,CAAC,CAAC,CAAC,IAAIE,KAAK;IACzC,IAAIE,QAAQ,GAAGf,IAAI,CAACgB,GAAG,CAACF,QAAQ,GAAGH,SAAS,CAAC,CAAC,CAAC,CAAC;IAChD,IAAIM,QAAQ,GAAGjB,IAAI,CAACgB,GAAG,CAACF,QAAQ,GAAGH,SAAS,CAAC,CAAC,CAAC,CAAC;IAChD,IAAIO,SAAS,GAAGlB,IAAI,CAACgB,GAAG,CAACF,QAAQ,GAAG,GAAG,IAAIH,SAAS,CAAC,CAAC,CAAC,GAAGA,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;IAExE,IAAIO,SAAS,GAAGlB,IAAI,CAACC,GAAG,CAACc,QAAQ,EAAEE,QAAQ,CAAC,EAAE;MAC5C,IAAIE,SAAS,GAAGN,KAAK,GAAG,GAAG;MAC3BF,SAAS,CAAC,CAAC,CAAC,GAAGX,IAAI,CAACC,GAAG,CAACD,IAAI,CAACE,GAAG,CAACY,QAAQ,GAAGK,SAAS,EAAE,CAAC,CAAC,EAAER,SAAS,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC;MAC9EA,SAAS,CAAC,CAAC,CAAC,GAAGX,IAAI,CAACE,GAAG,CAACF,IAAI,CAACC,GAAG,CAACa,QAAQ,GAAGK,SAAS,EAAE,CAAC,CAAC,EAAER,SAAS,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC;IAChF,CAAC,MAAM,IAAII,QAAQ,GAAGE,QAAQ,EAAE;MAC9BN,SAAS,CAAC,CAAC,CAAC,GAAGX,IAAI,CAACC,GAAG,CAACD,IAAI,CAACE,GAAG,CAACY,QAAQ,EAAE,CAAC,CAAC,EAAEH,SAAS,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC;IACpE,CAAC,MAAM;MACLA,SAAS,CAAC,CAAC,CAAC,GAAGX,IAAI,CAACE,GAAG,CAACF,IAAI,CAACC,GAAG,CAACa,QAAQ,EAAE,CAAC,CAAC,EAAEH,SAAS,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC;IACpE;IAEAC,SAAS,CAACQ,gBAAgB,CAACT,SAAS,CAAC,CAAC,CAAC;;IAEvC,OAAO,KAAK;EACd;AACF,CAAC,CAAC,CAAC;;AAEH,SAASU,gBAAgBA,CAACC,SAAS,EAAE;EACnC,IAAIC,QAAQ,GAAGnD,SAAS,CAACC,MAAM,GAAG,CAAC,IAAID,SAAS,CAAC,CAAC,CAAC,KAAKoD,SAAS,GAAGpD,SAAS,CAAC,CAAC,CAAC,GAAG,GAAG;EACtF,IAAIqD,SAAS,GAAG,EAAE;EAElB,OAAOA,SAAS,CAACpD,MAAM,GAAGkD,QAAQ,EAAE;IAClCE,SAAS,CAAC1D,IAAI,CAAC,CAAC,CAAC;EACnB;EAEA,IAAI2D,KAAK,GAAGJ,SAAS,CAACjD,MAAM;EAE5B,OAAOqD,KAAK,EAAE,EAAE;IACd,IAAIC,gBAAgB,GAAGL,SAAS,CAACI,KAAK,CAAC;MACnC9B,QAAQ,GAAG+B,gBAAgB,CAAC/B,QAAQ;MACpCG,MAAM,GAAG4B,gBAAgB,CAAC5B,MAAM;MAChCU,KAAK,GAAGkB,gBAAgB,CAAClB,KAAK;MAC9BJ,KAAK,GAAGsB,gBAAgB,CAACtB,KAAK;MAC9BC,KAAK,GAAGqB,gBAAgB,CAACrB,KAAK;IAElC,KAAK,IAAInC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGoD,QAAQ,EAAEpD,CAAC,EAAE,EAAE;MACjC,IAAIkB,CAAC,GAAGlB,CAAC,IAAIoD,QAAQ,GAAG,CAAC,CAAC,CAAC,CAAC;;MAE5B,IAAIlC,CAAC,GAAGO,QAAQ,GAAGa,KAAK,IAAIpB,CAAC,GAAGO,QAAQ,GAAGa,KAAK,EAAE;QAChD,IAAIgB,SAAS,CAACtD,CAAC,CAAC,GAAG,GAAG,EAAE;UACtBsD,SAAS,CAACtD,CAAC,CAAC,GAAG,GAAG;QACpB;QAEA;MACF,CAAC,CAAC;;MAGF,IAAIyD,cAAc,GAAGnB,KAAK,GAAG7B,kBAAkB,GAAGA,kBAAkB,GAAG6B,KAAK,CAAC,CAAC;;MAE9E,IAAIoB,EAAE,GAAG,CAAC;MAEV,IAAIxB,KAAK,KAAK,CAAC,IAAIhB,CAAC,KAAKO,QAAQ,GAAGS,KAAK,EAAE;QACzCwB,EAAE,GAAGxC,CAAC;MACR,CAAC,MAAM,IAAIA,CAAC,GAAGO,QAAQ,GAAGS,KAAK,EAAE;QAC/B,IAAIuB,cAAc,KAAKvB,KAAK,EAAE;UAC5BwB,EAAE,GAAGjC,QAAQ;QACf,CAAC,MAAM;UACLiC,EAAE,GAAGjC,QAAQ,GAAG,CAACP,CAAC,GAAGO,QAAQ,GAAGS,KAAK,KAAKuB,cAAc,IAAIA,cAAc,GAAGvB,KAAK,CAAC,CAAC;QACtF;MACF,CAAC,MAAM,IAAI,CAACuB,cAAc,KAAKvB,KAAK,EAAE;QACpC;QACAwB,EAAE,GAAGjC,QAAQ;MACf,CAAC,MAAM;QACLiC,EAAE,GAAGjC,QAAQ,GAAG,CAACP,CAAC,GAAGO,QAAQ,GAAGS,KAAK,KAAKuB,cAAc,IAAIA,cAAc,GAAGvB,KAAK,CAAC,CAAC;MACtF,CAAC,CAAC;;MAGF,IAAIyB,EAAE,GAAG,CAACD,EAAE,GAAGjC,QAAQ,IAAIgC,cAAc,CAAC,CAAC;MAC3C;MACA;;MAEA,IAAIG,GAAG,GAAG/B,IAAI,CAACgC,GAAG,CAAC,EAAE,CAAC,GAAGF,EAAE,GAAGA,EAAE,CAAC,CAAC;MAClC,IAAIG,GAAG,GAAG,GAAG,GAAGH,EAAE,GAAGA,EAAE;MACvB,IAAII,GAAG,GAAG,GAAG;MACb,IAAIC,EAAE,GAAG,KAAK,CAAC;MAEf,IAAI7B,KAAK,GAAG,CAAC,EAAE;QACb6B,EAAE,GAAG7B,KAAK,GAAG2B,GAAG,GAAG,CAAC,CAAC,GAAG3B,KAAK,IAAIyB,GAAG;MACtC,CAAC,MAAM;QACLI,EAAE,GAAG,CAAC,CAAC,GAAG7B,KAAK,IAAI2B,GAAG,GAAG,CAAC3B,KAAK,GAAG,CAAC,IAAI4B,GAAG;MAC5C;MAEA,IAAIE,EAAE,GAAGrC,MAAM,GAAGoC,EAAE,CAAC,CAAC;;MAEtB,IAAIC,EAAE,GAAGX,SAAS,CAACtD,CAAC,CAAC,EAAE;QACrBsD,SAAS,CAACtD,CAAC,CAAC,GAAGiE,EAAE;MACnB;IACF;EACF;EAEA,OAAOX,SAAS;AAClB,CAAC,CAAC;;AAGF,SAASY,gCAAgCA,CAACf,SAAS,EAAEC,QAAQ,EAAEe,UAAU,EAAEC,iBAAiB,EAAE;EAC5F,IAAId,SAAS,GAAGJ,gBAAgB,CAACC,SAAS,EAAEC,QAAQ,CAAC;EACrD,IAAIiB,KAAK,GAAG,EAAE;EACd,IAAI3B,KAAK,GAAG,CAACyB,UAAU,CAAC,CAAC,CAAC,GAAGA,UAAU,CAAC,CAAC,CAAC,KAAKb,SAAS,CAACpD,MAAM,GAAG,CAAC,CAAC;EACpE,IAAIoE,QAAQ,GAAG,GAAG;EAClB,IAAIC,SAAS,GAAG,CAAC;EAEjB,KAAK,IAAIC,KAAK,GAAG,CAAC,EAAEA,KAAK,GAAGlB,SAAS,CAACpD,MAAM,EAAEsE,KAAK,EAAE,EAAE;IACrD,IAAItD,CAAC,GAAGiD,UAAU,CAAC,CAAC,CAAC,GAAGzB,KAAK,GAAG8B,KAAK;IACrC,IAAIrD,CAAC,GAAGmC,SAAS,CAACkB,KAAK,CAAC;IACxBH,KAAK,CAACzE,IAAI,CAAC;MACTsB,CAAC,EAAEA,CAAC;MACJC,CAAC,EAAEA,CAAC;MACJmD,QAAQ,EAAEA,QAAQ;MAClBC,SAAS,EAAEA;IACb,CAAC,CAAC;EACJ;EAEAH,iBAAiB,CAACK,QAAQ,CAACJ,KAAK,CAAC;AACnC,CAAC,CAAC;;AAGF,SAASK,SAASA,CAACC,GAAG,EAAEC,IAAI,EAAEC,MAAM,EAAE;EACpC,IAAIC,KAAK,GAAG7E,SAAS,CAACC,MAAM,GAAG,CAAC,IAAID,SAAS,CAAC,CAAC,CAAC,KAAKoD,SAAS,GAAGpD,SAAS,CAAC,CAAC,CAAC,GAAG;IAC9E8E,SAAS,EAAE,CAAC;IACZC,WAAW,EAAE;EACf,CAAC;EACD,IAAIC,aAAa,GAAGL,IAAI,CAAC,CAAC,CAAC;EAC3B,IAAIM,eAAe,GAAGN,IAAI,CAAC,CAAC,CAAC,IAAIC,MAAM,CAAC3E,MAAM,GAAG,CAAC,CAAC;EACnD,IAAIiF,IAAI,GAAG,CAAC,CAACL,KAAK,CAACM,SAAS;EAC5B,IAAIC,MAAM,GAAGJ,aAAa,GAAGL,IAAI,CAAC,CAAC,CAAC;EACpCD,GAAG,CAACI,SAAS,GAAGD,KAAK,CAACC,SAAS;EAC/BJ,GAAG,CAACK,WAAW,GAAGF,KAAK,CAACE,WAAW;EACnCL,GAAG,CAACW,SAAS,CAAC,CAAC;EACfX,GAAG,CAACY,MAAM,CAACX,IAAI,CAAC,CAAC,CAAC,EAAEA,IAAI,CAAC,CAAC,CAAC,GAAGA,IAAI,CAAC,CAAC,CAAC,CAAC;EAEtC,KAAK,IAAIJ,KAAK,GAAG,CAAC,EAAEA,KAAK,GAAGK,MAAM,CAAC3E,MAAM,EAAEsE,KAAK,EAAE,EAAE;IAClDG,GAAG,CAACa,MAAM,CAACZ,IAAI,CAAC,CAAC,CAAC,GAAGJ,KAAK,GAAGU,eAAe,EAAErD,IAAI,CAACE,GAAG,CAAC6C,IAAI,CAAC,CAAC,CAAC,EAAES,MAAM,GAAGR,MAAM,CAACL,KAAK,CAAC,GAAGS,aAAa,CAAC,CAAC;EAC1G;EAEA,IAAIE,IAAI,EAAE;IACRR,GAAG,CAACS,SAAS,GAAGN,KAAK,CAACM,SAAS;IAC/BT,GAAG,CAACa,MAAM,CAACZ,IAAI,CAAC,CAAC,CAAC,GAAGA,IAAI,CAAC,CAAC,CAAC,EAAEA,IAAI,CAAC,CAAC,CAAC,GAAGA,IAAI,CAAC,CAAC,CAAC,CAAC;IAEhD,IAAIE,KAAK,CAACW,IAAI,EAAE;MACdd,GAAG,CAACc,IAAI,CAAC,CAAC;MACV;IACF;IAEAd,GAAG,CAACQ,IAAI,CAAC,CAAC;EACZ;EAEAR,GAAG,CAACe,MAAM,CAAC,CAAC;AACd,CAAC,CAAC;;AAGF,SAASC,iBAAiBA,CAACC,qBAAqB,EAAEtD,KAAK,EAAE6B,UAAU,EAAE0B,MAAM,EAAE;EAC3E,IAAIC,UAAU,GAAGD,MAAM,IAAIE,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC;EAC3DF,UAAU,CAACG,YAAY,CAAC,OAAO,EAAE3D,KAAK,CAAC;EACvCwD,UAAU,CAACG,YAAY,CAAC,QAAQ,EAAE,GAAG,CAAC;EACtC,IAAItB,GAAG,GAAGmB,UAAU,CAACI,UAAU,CAAC,IAAI,CAAC;EACrC,IAAIC,IAAI,GAAGP,qBAAqB,CAACQ,aAAa,CAACjC,UAAU,CAAC,CAAC,CAAC,EAAEA,UAAU,CAAC,CAAC,CAAC,EAAE7B,KAAK,EAAE,CAAC,CAAC;EACtF,IAAI+D,UAAU,GAAG1B,GAAG,CAAC2B,YAAY,CAAC,CAAC,EAAE,CAAC,EAAEhE,KAAK,EAAE,GAAG,CAAC;EAEnD,KAAK,IAAIiE,OAAO,GAAG,CAAC,EAAEA,OAAO,GAAG,GAAG,EAAEA,OAAO,EAAE,EAAE;IAC9CF,UAAU,CAACG,IAAI,CAACC,GAAG,CAACN,IAAI,EAAEI,OAAO,GAAG,CAAC,GAAGjE,KAAK,CAAC;EAChD;EAEA,IAAIoE,QAAQ,GAAG,GAAG,GAAGpE,KAAK,GAAG,CAAC;EAC9B,IAAIqE,QAAQ,GAAGrE,KAAK,GAAG,CAAC;EAExB,KAAK,IAAItC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG0G,QAAQ,EAAE1G,CAAC,IAAI,CAAC,EAAE;IACpCqG,UAAU,CAACG,IAAI,CAACxG,CAAC,CAAC,GAAG,GAAG,GAAG6B,IAAI,CAAC+E,KAAK,CAAC5G,CAAC,GAAG2G,QAAQ,CAAC;EACrD;EAEAhC,GAAG,CAACkC,YAAY,CAACR,UAAU,EAAE,CAAC,EAAE,CAAC,CAAC;EAClC,OAAOP,UAAU;AACnB,CAAC,CAAC;;AAGF,SAASgB,0BAA0BA,CAACC,GAAG,EAAEzE,KAAK,EAAEuD,MAAM,EAAE;EACtD,IAAIC,UAAU,GAAGD,MAAM,IAAIE,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC;EAC3DF,UAAU,CAACG,YAAY,CAAC,OAAO,EAAE3D,KAAK,CAAC;EACvCwD,UAAU,CAACG,YAAY,CAAC,QAAQ,EAAE,GAAG,CAAC;EACtC,IAAItB,GAAG,GAAGmB,UAAU,CAACI,UAAU,CAAC,IAAI,CAAC;EACrCvB,GAAG,CAACqC,SAAS,CAACD,GAAG,EAAE,CAAC,EAAE,CAAC,EAAEA,GAAG,CAACzE,KAAK,EAAEyE,GAAG,CAACnF,MAAM,EAAE,CAAC,EAAE,CAAC,EAAEU,KAAK,EAAE,GAAG,CAAC;EACjE,OAAOwD,UAAU;AACnB,CAAC,CAAC;;AAGF,SAASmB,oBAAoBA,CAAC/F,CAAC,EAAEC,CAAC,EAAE+F,eAAe,EAAE;EACnD,IAAIC,SAAS,GAAGlH,SAAS,CAACC,MAAM,GAAG,CAAC,IAAID,SAAS,CAAC,CAAC,CAAC,KAAKoD,SAAS,GAAGpD,SAAS,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC;EAC1F,OAAO,CAACkH,SAAS,CAAC,CAAC,CAAC,GAAG,CAACjG,CAAC,GAAGgG,eAAe,CAAC,CAAC,CAAC,IAAIA,eAAe,CAAC,CAAC,CAAC,IAAIC,SAAS,CAAC,CAAC,CAAC,GAAGA,SAAS,CAAC,CAAC,CAAC,CAAC,EAAE,CAAChG,CAAC,GAAG+F,eAAe,CAAC,CAAC,CAAC,IAAIA,eAAe,CAAC,CAAC,CAAC,CAAC;AACtJ,CAAC,CAAC;;AAGF,SAASE,YAAYA,CAAClG,CAAC,EAAEiC,SAAS,EAAE;EAClC,IAAIkE,SAAS,GAAGlE,SAAS,CAACmE,GAAG,CAAC,UAAUC,CAAC,EAAE;IACzC,OAAO1F,IAAI,CAACgB,GAAG,CAAC0E,CAAC,CAAC9F,QAAQ,GAAGP,CAAC,CAAC;EACjC,CAAC,CAAC;EACF,IAAIY,GAAG,GAAGD,IAAI,CAACC,GAAG,CAACjC,KAAK,CAACgC,IAAI,EAAEnD,kBAAkB,CAAC2I,SAAS,CAAC,CAAC;EAC7D,OAAOA,SAAS,CAACG,OAAO,CAAC1F,GAAG,CAAC;AAC/B,CAAC,CAAC;;AAGF,SAAS2F,cAAcA,CAACC,QAAQ,EAAE;EAChC,IAAIC,cAAc,GAAG1H,SAAS,CAACC,MAAM,GAAG,CAAC,IAAID,SAAS,CAAC,CAAC,CAAC,KAAKoD,SAAS,GAAGpD,SAAS,CAAC,CAAC,CAAC,GAAG,IAAI;EAC7F,OAAO,UAAU2H,CAAC,EAAE;IAClB,IAAIC,OAAO,GAAGD,CAAC,CAACC,OAAO;MACnBC,OAAO,GAAGF,CAAC,CAACE,OAAO;IAEvB,IAAIH,cAAc,EAAE;MAClBC,CAAC,CAACD,cAAc,CAAC,CAAC;IACpB;IAEAD,QAAQ,CAACG,OAAO,EAAEC,OAAO,CAAC;EAC5B,CAAC;AACH,CAAC,CAAC;;AAGF,SAASC,wBAAwBA,CAAA,EAAG;EAClC,IAAIC,EAAE,GAAGhH,WAAW,CAACd,MAAM;EAE3B,KAAK,IAAI+H,IAAI,GAAGhI,SAAS,CAACC,MAAM,EAAEgI,SAAS,GAAG,IAAIC,KAAK,CAACF,IAAI,CAAC,EAAEG,IAAI,GAAG,CAAC,EAAEA,IAAI,GAAGH,IAAI,EAAEG,IAAI,EAAE,EAAE;IAC5FF,SAAS,CAACE,IAAI,CAAC,GAAGnI,SAAS,CAACmI,IAAI,CAAC;EACnC;EAEApH,WAAW,CAACpB,IAAI,CAAC;IACfsI,SAAS,EAAEA,SAAS;IACpBG,OAAO,EAAE,CAAC;IACVC,MAAM,EAAE,GAAG;IACX/E,KAAK,EAAE,CAAC;IACRgF,KAAK,EAAE;EACT,CAAC,CAAC;EACF,OAAOP,EAAE;AACX,CAAC,CAAC;;AAGF,SAASQ,kBAAkBA,CAAA,EAAG;EAC5BxH,WAAW,CAACxB,MAAM,CAAC,UAAUiJ,CAAC,EAAE;IAC9B,OAAOA,CAAC,CAACF,KAAK;EAChB,CAAC,CAAC,CAACnI,OAAO,CAAC,UAAUsI,WAAW,EAAE;IAChCA,WAAW,CAACR,SAAS,CAAC9H,OAAO,CAAC,UAAUsH,QAAQ,EAAE;MAChD,IAAIA,QAAQ,CAACiB,OAAO,KAAKD,WAAW,CAACC,OAAO,IAAIjB,QAAQ,CAACkB,MAAM,KAAKF,WAAW,CAACnF,KAAK,EAAE;QACrFmE,QAAQ,CAACmB,MAAM,CAAChJ,KAAK,CAAC6H,QAAQ,EAAEhJ,kBAAkB,CAACgK,WAAW,CAACI,YAAY,CAAC,CAAC;MAC/E;IACF,CAAC,CAAC,CAAC,CAAC;;IAEJJ,WAAW,CAACK,EAAE,GAAG,CAAC;IAClBL,WAAW,CAACnF,KAAK,GAAG,CAAC;IACrBmF,WAAW,CAACC,OAAO,GAAG,CAAC;IACvBD,WAAW,CAACH,KAAK,GAAG,KAAK;EAC3B,CAAC,CAAC;AACJ,CAAC,CAAC;;AAGF,SAASS,mBAAmBA,CAAChB,EAAE,EAAEN,QAAQ,EAAE;EACzC,IAAIuB,SAAS,GAAGhJ,SAAS,CAACC,MAAM,GAAG,CAAC,IAAID,SAAS,CAAC,CAAC,CAAC,KAAKoD,SAAS,GAAGpD,SAAS,CAAC,CAAC,CAAC,GAAG,CAAC;EACrF,IAAI0H,cAAc,GAAG1H,SAAS,CAACC,MAAM,GAAG,CAAC,IAAID,SAAS,CAAC,CAAC,CAAC,KAAKoD,SAAS,GAAGpD,SAAS,CAAC,CAAC,CAAC,GAAG,IAAI;EAC7F,OAAO,UAAU2H,CAAC,EAAE;IAClB,IAAIsB,YAAY,GAAGtB,CAAC,CAAC7H,MAAM,CAACoJ,qBAAqB,CAAC,CAAC;IACnD,IAAIC,eAAe,GAAGjB,KAAK,CAACkB,SAAS,CAAC/B,GAAG,CAACgC,IAAI,CAAC1B,CAAC,CAACe,OAAO,EAAE,UAAUF,CAAC,EAAE;MACrE,OAAO,CAACA,CAAC,CAACc,KAAK,GAAGL,YAAY,CAACM,IAAI,EAAEf,CAAC,CAACgB,KAAK,GAAGP,YAAY,CAACQ,GAAG,CAAC;IAClE,CAAC,CAAC;IACF,IAAIZ,YAAY,GAAGM,eAAe,CAACO,MAAM,CAAC,UAAUC,CAAC,EAAEC,CAAC,EAAE;MACxD,OAAO,CAACD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,EAAED,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,CAAC;IACnC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAACvC,GAAG,CAAC,UAAUwC,CAAC,EAAE;MAC1B,OAAOA,CAAC,GAAGlC,CAAC,CAACe,OAAO,CAACzI,MAAM;IAC7B,CAAC,CAAC;IAEF,IAAI0H,CAAC,CAACmC,IAAI,KAAK,YAAY,EAAE;MAC3BC,YAAY,CAAChJ,WAAW,CAACgH,EAAE,CAAC,CAACK,OAAO,CAAC;MACrCrH,WAAW,CAACgH,EAAE,CAAC,CAACe,EAAE,GAAGnB,CAAC,CAACqC,SAAS;MAChCjJ,WAAW,CAACgH,EAAE,CAAC,CAACc,YAAY,GAAGA,YAAY;MAC3C9H,WAAW,CAACgH,EAAE,CAAC,CAACW,OAAO,GAAGf,CAAC,CAACe,OAAO,CAACzI,MAAM;IAC5C,CAAC,MAAM,IAAI0H,CAAC,CAACmC,IAAI,KAAK,WAAW,EAAE;MACjC/I,WAAW,CAACgH,EAAE,CAAC,CAACe,EAAE,GAAG,CAAC;MACtB/H,WAAW,CAACgH,EAAE,CAAC,CAACzE,KAAK,GAAG,CAAC;MACzBvC,WAAW,CAACgH,EAAE,CAAC,CAACO,KAAK,GAAG,KAAK;IAC/B,CAAC,MAAM,IAAIX,CAAC,CAACmC,IAAI,KAAK,UAAU,EAAE;MAChC,IAAInC,CAAC,CAACqC,SAAS,GAAGjJ,WAAW,CAACgH,EAAE,CAAC,CAACe,EAAE,GAAG/H,WAAW,CAACgH,EAAE,CAAC,CAACM,MAAM,EAAE;QAC7DtH,WAAW,CAACgH,EAAE,CAAC,CAACzE,KAAK,IAAI,CAAC;QAC1BvC,WAAW,CAACgH,EAAE,CAAC,CAACO,KAAK,GAAG,IAAI;QAE5B,IAAIZ,cAAc,EAAE;UAClBC,CAAC,CAACD,cAAc,CAAC,CAAC;QACpB;QAEA3G,WAAW,CAACgH,EAAE,CAAC,CAACK,OAAO,GAAG6B,UAAU,CAAC1B,kBAAkB,EAAExH,WAAW,CAACgH,EAAE,CAAC,CAACM,MAAM,CAAC;MAClF,CAAC,MAAM;QACLtH,WAAW,CAACgH,EAAE,CAAC,CAACO,KAAK,GAAG,KAAK;MAC/B;IACF;IAEA,IAAIX,CAAC,CAACe,OAAO,CAACzI,MAAM,KAAK+I,SAAS,EAAE;MAClCvB,QAAQ,CAAC7H,KAAK,CAAC,KAAK,CAAC,EAAEnB,kBAAkB,CAACoK,YAAY,CAAC,CAAC;MAExD,IAAInB,cAAc,EAAE;QAClBC,CAAC,CAACD,cAAc,CAAC,CAAC;MACpB;IACF;EACF,CAAC;AACH,CAAC,CAAC;;AAGF,SAASwC,gBAAgBA,CAACC,SAAS,EAAEC,EAAE,EAAEC,EAAE,EAAE;EAC3C,OAAO,UAAU1C,CAAC,EAAE;IAClB,OAAOwC,SAAS,CAAC,CAAC,GAAGC,EAAE,CAACzC,CAAC,CAAC,GAAG0C,EAAE,CAAC1C,CAAC,CAAC;EACpC,CAAC;AACH,CAAC,CAAC;;AAGF,SAAS2C,YAAYA,CAACC,KAAK,EAAEC,SAAS,EAAE;EACtC,IAAI,CAACA,SAAS,EAAE;IACd,OAAOD,KAAK;EACd;EAEA,IAAIE,MAAM,GAAGF,KAAK,CAACtK,MAAM,GAAG,CAAC;EAC7B,IAAIyK,QAAQ,GAAGF,SAAS,CAACnD,GAAG,CAAC,UAAUwC,CAAC,EAAE;IACxC,OAAOjI,IAAI,CAAC+I,KAAK,CAACd,CAAC,GAAGY,MAAM,CAAC;EAC/B,CAAC,CAAC;EACF,OAAOF,KAAK,CAACK,KAAK,CAACF,QAAQ,CAAC,CAAC,CAAC,EAAEA,QAAQ,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;AAClD,CAAC,CAAC;;AAGF,SAASG,YAAYA,CAACC,KAAK,EAAEN,SAAS,EAAE;EACtC,IAAI,CAACA,SAAS,EAAE;IACd,OAAOM,KAAK;EACd;EAEA,OAAO,CAACA,KAAK,GAAGN,SAAS,CAAC,CAAC,CAAC,KAAKA,SAAS,CAAC,CAAC,CAAC,GAAGA,SAAS,CAAC,CAAC,CAAC,CAAC;AAC/D,CAAC,CAAC;AACF;AACA;;AAGA,IAAIO,MAAM,GAAG;EACX9G,gCAAgC,EAAEA,gCAAgC;EAClEhB,gBAAgB,EAAEA,gBAAgB;EAClCuE,cAAc,EAAEA,cAAc;EAC9B/C,SAAS,EAAEA,SAAS;EACpB0C,YAAY,EAAEA,YAAY;EAC1B+C,gBAAgB,EAAEA,gBAAgB;EAClClD,oBAAoB,EAAEA;AACxB,CAAC,CAAC,CAAC;AACH;AACA;;AAEA,SAASgE,0BAA0BA,CAACxI,SAAS,EAAEd,KAAK,EAAE;EACpD;EACAA,KAAK,CAACuJ,cAAc,CAACtL,IAAI,CAAC,4BAA4B,CAAC;EAEvD,IAAI,CAAC+B,KAAK,CAACkE,MAAM,EAAE;IACjBlE,KAAK,CAACkE,MAAM,GAAGE,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC;EACjD;EAEAvD,SAAS,CAAC0I,YAAY,GAAG,UAAUC,EAAE,EAAE;IACrC,IAAIzJ,KAAK,CAAC0J,SAAS,IAAI1J,KAAK,CAAC0J,SAAS,KAAKD,EAAE,EAAE;MAC7CzJ,KAAK,CAAC0J,SAAS,CAACC,WAAW,CAAC3J,KAAK,CAACkE,MAAM,CAAC;IAC3C;IAEA,IAAIlE,KAAK,CAAC0J,SAAS,KAAKD,EAAE,EAAE;MAC1BzJ,KAAK,CAAC0J,SAAS,GAAGD,EAAE;MAEpB,IAAIzJ,KAAK,CAAC0J,SAAS,EAAE;QACnB1J,KAAK,CAAC0J,SAAS,CAACE,WAAW,CAAC5J,KAAK,CAACkE,MAAM,CAAC;MAC3C;MAEApD,SAAS,CAAC+I,QAAQ,CAAC,CAAC;IACtB;EACF,CAAC;EAED/I,SAAS,CAACgJ,YAAY,GAAG,UAAUtI,SAAS,EAAE;IAC5C,IAAIxB,KAAK,CAACwB,SAAS,KAAKA,SAAS,EAAE;MACjC;IACF;IAEAxB,KAAK,CAACwB,SAAS,GAAGA,SAAS;IAC3BxB,KAAK,CAAC2B,SAAS,GAAGJ,gBAAgB,CAACvB,KAAK,CAACwB,SAAS,EAAExB,KAAK,CAAC+J,aAAa,CAAC;IACxEjJ,SAAS,CAACkJ,mBAAmB,CAAClJ,SAAS,CAAC;IACxCA,SAAS,CAAC+I,QAAQ,CAAC,CAAC;EACtB,CAAC;EAED/I,SAAS,CAACmJ,WAAW,GAAG,UAAUnK,QAAQ,EAAEG,MAAM,EAAEU,KAAK,EAAEJ,KAAK,EAAEC,KAAK,EAAE;IACvE,IAAI0J,SAAS,GAAGlK,KAAK,CAACwB,SAAS,CAACjD,MAAM;IACtCyB,KAAK,CAACwB,SAAS,CAACvD,IAAI,CAAC;MACnB6B,QAAQ,EAAEA,QAAQ;MAClBG,MAAM,EAAEA,MAAM;MACdU,KAAK,EAAEA,KAAK;MACZJ,KAAK,EAAEA,KAAK;MACZC,KAAK,EAAEA;IACT,CAAC,CAAC;IACFR,KAAK,CAAC2B,SAAS,GAAGJ,gBAAgB,CAACvB,KAAK,CAACwB,SAAS,EAAExB,KAAK,CAAC+J,aAAa,CAAC;IACxEjJ,SAAS,CAACkJ,mBAAmB,CAAClJ,SAAS,CAAC;IACxCA,SAAS,CAAC+I,QAAQ,CAAC,CAAC;IACpB,OAAOK,SAAS;EAClB,CAAC;EAEDpJ,SAAS,CAACqJ,cAAc,GAAG,UAAUtH,KAAK,EAAE;IAC1C7C,KAAK,CAACwB,SAAS,CAAC4I,MAAM,CAACvH,KAAK,EAAE,CAAC,CAAC;IAChC7C,KAAK,CAAC2B,SAAS,GAAGJ,gBAAgB,CAACvB,KAAK,CAACwB,SAAS,EAAExB,KAAK,CAAC+J,aAAa,CAAC;IACxEjJ,SAAS,CAACkJ,mBAAmB,CAAClJ,SAAS,CAAC;IACxCA,SAAS,CAAC+I,QAAQ,CAAC,CAAC;EACtB,CAAC;EAED/I,SAAS,CAACuJ,OAAO,GAAG,UAAU1J,KAAK,EAAEV,MAAM,EAAE;IAC3CD,KAAK,CAACkE,MAAM,CAACI,YAAY,CAAC,OAAO,EAAE3D,KAAK,CAAC;IACzCX,KAAK,CAACkE,MAAM,CAACI,YAAY,CAAC,QAAQ,EAAErE,MAAM,CAAC;IAE3C,IAAID,KAAK,CAACsK,IAAI,CAAC,CAAC,CAAC,KAAK3J,KAAK,IAAIX,KAAK,CAACsK,IAAI,CAAC,CAAC,CAAC,KAAKrK,MAAM,EAAE;MACvDD,KAAK,CAACsK,IAAI,GAAG,CAAC3J,KAAK,EAAEV,MAAM,CAAC;MAC5BD,KAAK,CAACuK,gBAAgB,GAAG,CAAC;MAC1BzJ,SAAS,CAAC+I,QAAQ,CAAC,CAAC;IACtB;EACF,CAAC;EAED/I,SAAS,CAAC0J,WAAW,GAAG,UAAUrH,KAAK,EAAE;IACvCnD,KAAK,CAACmD,KAAK,GAAGhF,aAAa,CAACA,aAAa,CAAC,CAAC,CAAC,EAAE6B,KAAK,CAACmD,KAAK,CAAC,EAAEA,KAAK,CAAC;IAClErC,SAAS,CAAC+I,QAAQ,CAAC,CAAC;EACtB,CAAC,CAAC,CAAC;EACH;EACA;EACA;;EAGA/I,SAAS,CAAC2J,YAAY,GAAG,UAAU5B,KAAK,EAAE;IACxC,IAAI6B,KAAK,GAAGpM,SAAS,CAACC,MAAM,GAAG,CAAC,IAAID,SAAS,CAAC,CAAC,CAAC,KAAKoD,SAAS,GAAGpD,SAAS,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;MAC9EqM,qBAAqB,GAAGD,KAAK,CAACE,sBAAsB;MACpDA,sBAAsB,GAAGD,qBAAqB,KAAK,KAAK,CAAC,GAAG,CAAC,GAAGA,qBAAqB;MACrFE,qBAAqB,GAAGH,KAAK,CAACI,kBAAkB;MAChDA,kBAAkB,GAAGD,qBAAqB,KAAK,KAAK,CAAC,GAAG,CAAC,GAAGA,qBAAqB;MACjFE,qBAAqB,GAAGL,KAAK,CAACM,kBAAkB;MAChDA,kBAAkB,GAAGD,qBAAqB,KAAK,KAAK,CAAC,GAAG,CAAC,GAAGA,qBAAqB;MACjFE,eAAe,GAAGP,KAAK,CAACQ,SAAS;MACjCA,SAAS,GAAGD,eAAe,KAAK,KAAK,CAAC,GAAG,CAAC,GAAGA,eAAe;IAEhEjL,KAAK,CAACmL,SAAS,GAAG,IAAI;IACtBnL,KAAK,CAACoL,cAAc,GAAGvC,KAAK;IAC5B7I,KAAK,CAACqL,SAAS,GAAGnO,UAAU,CAAC2L,KAAK,EAAEqC,SAAS,EAAEF,kBAAkB,CAAC;IAElE,IAAIM,gBAAgB,GAAGzO,cAAc,CAACmD,KAAK,CAACqL,SAAS,EAAE,CAAC,CAAC;MACrDlL,GAAG,GAAGmL,gBAAgB,CAAC,CAAC,CAAC;MACzBlL,GAAG,GAAGkL,gBAAgB,CAAC,CAAC,CAAC;IAE7B,IAAIC,kBAAkB,GAAG,CAAC;IAC1B,IAAIC,WAAW,GAAGtL,IAAI,CAAC+E,KAAK,CAAC4D,KAAK,CAACtK,MAAM,GAAGgN,kBAAkB,CAAC,IAAI,CAAC;IACpEC,WAAW,IAAIA,WAAW,GAAGR,kBAAkB;IAC/C,IAAIS,UAAU,GAAG,CAAC;IAClB,IAAIC,YAAY,GAAG,EAAE;IACrB,IAAIC,OAAO,GAAG,EAAE;IAEhB,OAAOF,UAAU,GAAG5C,KAAK,CAACtK,MAAM,EAAE;MAChC,IAAIqN,MAAM,GAAG,IAAIvO,aAAa,CAAC,CAAC;MAChCsO,OAAO,CAAC1N,IAAI,CAAC2N,MAAM,CAAC;MACpB,IAAIC,aAAa,GAAG,IAAI1O,gBAAgB,CAACyO,MAAM,CAAC;MAChD,IAAIE,UAAU,GAAGL,UAAU;MAC3B,IAAIM,QAAQ,GAAG7L,IAAI,CAACC,GAAG,CAACsL,UAAU,GAAGD,WAAW,EAAE3C,KAAK,CAACtK,MAAM,GAAG,CAAC,CAAC;MACnE,IAAIyN,QAAQ,GAAG,IAAInD,KAAK,CAACoD,WAAW,CAACpD,KAAK,CAACK,KAAK,CAAC4C,UAAU,EAAEC,QAAQ,GAAG,CAAC,CAAC,CAAC;MAC3EL,YAAY,CAACzN,IAAI,CAAC4N,aAAa,CAACK,WAAW,CAAC;QAC1CrD,KAAK,EAAEmD,QAAQ;QACfd,SAAS,EAAEA,SAAS;QACpBF,kBAAkB,EAAEA,kBAAkB;QACtC7K,GAAG,EAAEA,GAAG;QACRC,GAAG,EAAEA,GAAG;QACR+L,YAAY,EAAEnM,KAAK,CAACmM;MACtB,CAAC,EAAE,CAACH,QAAQ,CAACI,MAAM,CAAC,CAAC,CAAC;MACtBX,UAAU,IAAID,WAAW;IAC3B;IAEAa,OAAO,CAACC,GAAG,CAACZ,YAAY,CAAC,CAACa,IAAI,CAAC,UAAUC,aAAa,EAAE;MACtDb,OAAO,CAAClN,OAAO,CAAC,UAAUmN,MAAM,EAAE;QAChC,OAAOA,MAAM,CAACa,SAAS,CAAC,CAAC;MAC3B,CAAC,CAAC;MACFzM,KAAK,CAACmL,SAAS,GAAG,IAAIuB,YAAY,CAAC1M,KAAK,CAACmM,YAAY,CAAC;MACtDnM,KAAK,CAACmL,SAAS,CAAC3H,IAAI,CAAC,CAAC,CAAC;MACvBgJ,aAAa,CAAC/N,OAAO,CAAC,UAAUkO,YAAY,EAAE;QAC5C,KAAK,IAAItO,CAAC,GAAG,CAAC,EAAEuO,GAAG,GAAGD,YAAY,CAACpO,MAAM,EAAEF,CAAC,GAAGuO,GAAG,EAAE,EAAEvO,CAAC,EAAE;UACvD2B,KAAK,CAACmL,SAAS,CAAC9M,CAAC,CAAC,IAAIsO,YAAY,CAACtO,CAAC,CAAC;QACvC;MACF,CAAC,CAAC,CAAC,CAAC;;MAEJ,IAAIwO,UAAU,GAAG3M,IAAI,CAACC,GAAG,CAACyK,sBAAsB,EAAE5K,KAAK,CAACmL,SAAS,CAAC5M,MAAM,GAAGuM,kBAAkB,CAAC;MAC9F,IAAIgC,WAAW,GAAGtG,KAAK,CAACuG,IAAI,CAAC/M,KAAK,CAACmL,SAAS,CAAC;MAC7C2B,WAAW,CAACE,IAAI,CAAC,UAAU/E,CAAC,EAAEC,CAAC,EAAE;QAC/B,OAAO+E,MAAM,CAAChF,CAAC,CAAC,GAAGgF,MAAM,CAAC/E,CAAC,CAAC;MAC9B,CAAC,CAAC;MAEF,KAAK,IAAI7J,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGyM,kBAAkB,EAAEzM,CAAC,EAAE,EAAE;QAC3CyO,WAAW,CAACI,GAAG,CAAC,CAAC;MACnB;MAEA,OAAOJ,WAAW,CAACvO,MAAM,GAAGsO,UAAU,EAAE;QACtCC,WAAW,CAACK,KAAK,CAAC,CAAC;MACrB;MAEA,IAAIC,IAAI,GAAGN,WAAW,CAAC9E,MAAM,CAAC,UAAUC,CAAC,EAAEC,CAAC,EAAE;QAC5C,OAAOD,CAAC,GAAGC,CAAC;MACd,CAAC,EAAE,CAAC,CAAC,GAAG2E,UAAU;MAElB,KAAK,IAAIQ,EAAE,GAAG,CAAC,EAAET,GAAG,GAAG5M,KAAK,CAACmL,SAAS,CAAC5M,MAAM,EAAE8O,EAAE,GAAGT,GAAG,EAAE,EAAES,EAAE,EAAE;QAC7DrN,KAAK,CAACmL,SAAS,CAACkC,EAAE,CAAC,IAAID,IAAI;MAC7B;MAEAtM,SAAS,CAAC+I,QAAQ,CAAC,CAAC;MACpBtB,UAAU,CAACzH,SAAS,CAACwM,MAAM,EAAE,CAAC,CAAC;IACjC,CAAC,CAAC;IACFxM,SAAS,CAAC+I,QAAQ,CAAC,CAAC;EACtB,CAAC;EAED/I,SAAS,CAACyM,OAAO,GAAG,UAAUhO,CAAC,EAAEC,CAAC,EAAE;IAClC,IAAIgO,qBAAqB,GAAGlI,oBAAoB,CAAC/F,CAAC,EAAEC,CAAC,EAAEQ,KAAK,CAACyN,SAAS,EAAEzN,KAAK,CAAC0N,eAAe,GAAG1N,KAAK,CAACa,SAAS,GAAG,IAAI,CAAC;MACnH8M,sBAAsB,GAAG9Q,cAAc,CAAC2Q,qBAAqB,EAAE,CAAC,CAAC;MACjEI,WAAW,GAAGD,sBAAsB,CAAC,CAAC,CAAC;MACvCE,WAAW,GAAGF,sBAAsB,CAAC,CAAC,CAAC;IAE3C,IAAIC,WAAW,GAAG,CAAC,IAAI5N,KAAK,CAACmD,KAAK,CAAC2K,QAAQ,GAAG,CAAC,EAAE;MAC/C;MACA,IAAI/M,KAAK,GAAGf,KAAK,CAACmD,KAAK,CAAC2K,QAAQ,GAAG9N,KAAK,CAACmD,KAAK,CAAC4K,OAAO;MACtD,IAAIrK,MAAM,GAAG3C,KAAK;MAClB,IAAIiN,SAAS,GAAG,CAAC;MAEjB,OAAOxO,CAAC,GAAGkE,MAAM,EAAE;QACjBsK,SAAS,IAAI,CAAC;QACdtK,MAAM,IAAI3C,KAAK;MACjB;MAEA,QAAQiN,SAAS;QACf,KAAK,CAAC;UACJ;YACE,IAAIC,WAAW,GAAGnN,SAAS,CAACmJ,WAAW,CAAC,CAAC,EAAE,CAAC,EAAE,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC;YACxD,IAAItK,QAAQ,GAAGK,KAAK,CAACwB,SAAS,CAACyM,WAAW,CAAC;YAE3C,IAAIrO,gBAAgB,GAAGzB,aAAa,CAAC,CAAC,CAAC,EAAEwB,QAAQ,CAAC;YAElD,IAAIuH,MAAM,GAAG5H,OAAO,CAACN,cAAc;YACnCgB,KAAK,CAACkO,cAAc,GAAGD,WAAW;YAClCjO,KAAK,CAACmO,gBAAgB,GAAGF,WAAW,CAAC,CAAC;;YAEtCjR,KAAK,CAACoR,YAAY,CAAC,YAAY;cAC7BtN,SAAS,CAACuN,MAAM,CAAC9O,CAAC,EAAEC,CAAC,CAAC;cACtBQ,KAAK,CAACsO,UAAU,GAAG;gBACjB5O,UAAU,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;gBAClBwH,MAAM,EAAEA,MAAM;gBACdvH,QAAQ,EAAEA,QAAQ;gBAClBC,gBAAgB,EAAEA;cACpB,CAAC;YACH,CAAC,CAAC;YACF;UACF;QAEF,KAAK,CAAC;UACJ;YACE,IAAII,KAAK,CAACmO,gBAAgB,KAAK,CAAC,CAAC,EAAE;cACjCrN,SAAS,CAACqJ,cAAc,CAACnK,KAAK,CAACmO,gBAAgB,CAAC;YAClD;YAEA;UACF;QAEF;UACE;YACEnO,KAAK,CAACmO,gBAAgB,GAAG,CAAC,CAAC;YAC3BnO,KAAK,CAACsO,UAAU,GAAG,IAAI;UACzB;MACJ;IACF,CAAC,MAAM,IAAIV,WAAW,GAAG,CAAC,IAAIA,WAAW,GAAG,CAAC,IAAIC,WAAW,GAAG,CAAC,IAAIA,WAAW,GAAG,CAAC,EAAE;MACnF7N,KAAK,CAACmO,gBAAgB,GAAG,CAAC,CAAC;MAC3BnO,KAAK,CAACsO,UAAU,GAAG,IAAI;IACzB,CAAC,MAAM;MACL,IAAIC,WAAW,GAAG9I,YAAY,CAACmI,WAAW,EAAE5N,KAAK,CAACwB,SAAS,CAAC;MAE5D,IAAI+M,WAAW,KAAKvO,KAAK,CAACmO,gBAAgB,EAAE;QAC1CnO,KAAK,CAACmO,gBAAgB,GAAGI,WAAW;QACpCzN,SAAS,CAAC+I,QAAQ,CAAC,CAAC;MACtB;IACF;IAEA,OAAO,IAAI;EACb,CAAC;EAED/I,SAAS,CAAC0N,OAAO,GAAG,UAAUjP,CAAC,EAAEC,CAAC,EAAE;IAClC;IACA;IACA,IAAIiP,SAAS,GAAG,EAAE,GAAGzO,KAAK,CAACkE,MAAM,CAACjE,MAAM;IAExC,IAAIyO,sBAAsB,GAAGpJ,oBAAoB,CAAC/F,CAAC,EAAEC,CAAC,EAAEQ,KAAK,CAACyN,SAAS,EAAEzN,KAAK,CAAC0N,eAAe,GAAG1N,KAAK,CAACa,SAAS,GAAG,IAAI,CAAC;MACpH8N,sBAAsB,GAAG9R,cAAc,CAAC6R,sBAAsB,EAAE,CAAC,CAAC;MAClEd,WAAW,GAAGe,sBAAsB,CAAC,CAAC,CAAC;MACvCd,WAAW,GAAGc,sBAAsB,CAAC,CAAC,CAAC;IAE3C,IAAIC,sBAAsB,GAAGtJ,oBAAoB,CAAC/F,CAAC,EAAEC,CAAC,EAAEQ,KAAK,CAACyN,SAAS,CAAC;MACpEoB,sBAAsB,GAAGhS,cAAc,CAAC+R,sBAAsB,EAAE,CAAC,CAAC;MAClEE,cAAc,GAAGD,sBAAsB,CAAC,CAAC,CAAC;IAE9C,IAAIE,SAAS,GAAGnB,WAAW,GAAG,CAAC,GAAG5N,KAAK,CAACmO,gBAAgB,GAAG1I,YAAY,CAACmI,WAAW,EAAE5N,KAAK,CAACwB,SAAS,CAAC;IACrGxB,KAAK,CAACkE,MAAM,CAACf,KAAK,CAAC6L,MAAM,GAAG,SAAS;IACrC,IAAIrP,QAAQ,GAAGK,KAAK,CAACwB,SAAS,CAACuN,SAAS,CAAC;IAEzC,IAAI/O,KAAK,CAAC0N,eAAe,IAAIoB,cAAc,IAAI,CAAC,IAAItP,CAAC,GAAGQ,KAAK,CAACyN,SAAS,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;IAAA,EAC7E;MACA,IAAIwB,UAAU,GAAG,CAACjP,KAAK,CAACa,SAAS,CAAC,CAAC,CAAC,GAAGb,KAAK,CAACa,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC;MAE9D,IAAIiO,cAAc,GAAG9O,KAAK,CAACa,SAAS,CAAC,CAAC,CAAC,GAAGoO,UAAU,IAAIH,cAAc,GAAG9O,KAAK,CAACa,SAAS,CAAC,CAAC,CAAC,GAAGoO,UAAU,EAAE;QACxGjP,KAAK,CAACkE,MAAM,CAACf,KAAK,CAAC6L,MAAM,GAAGjQ,gBAAgB,CAACK,UAAU;MACzD,CAAC,MAAM;QACLY,KAAK,CAACkE,MAAM,CAACf,KAAK,CAAC6L,MAAM,GAAGjQ,gBAAgB,CAACC,cAAc;MAC7D;MAEAgB,KAAK,CAACsO,UAAU,GAAG;QACjBzN,SAAS,EAAEb,KAAK,CAACa,SAAS;QAC1BqG,MAAM,EAAE5H,OAAO,CAACF;MAClB,CAAC;IACH,CAAC,MAAM,IAAIO,QAAQ,IAAImP,cAAc,IAAI,CAAC,EAAE;MAC1C,IAAII,IAAI,GAAG,CAAC,GAAGrB,WAAW;MAC1B,IAAIsB,UAAU,GAAG,IAAI;MAErB,IAAID,IAAI,GAAGvP,QAAQ,CAACM,MAAM,GAAGwO,SAAS,EAAE;QACtCU,UAAU,GAAG,gBAAgB;MAC/B,CAAC,MAAM,IAAID,IAAI,GAAGvP,QAAQ,CAACM,MAAM,GAAGwO,SAAS,EAAE;QAC7C,IAAIvO,IAAI,CAACgB,GAAG,CAAC0M,WAAW,GAAGjO,QAAQ,CAACG,QAAQ,CAAC,GAAG2O,SAAS,EAAE;UACzDU,UAAU,GAAG,cAAc;QAC7B,CAAC,MAAM;UACLA,UAAU,GAAG,gBAAgB;QAC/B;MACF,CAAC,MAAM,IAAID,IAAI,GAAGvP,QAAQ,CAACM,MAAM,GAAG,GAAG,GAAGwO,SAAS,EAAE;QACnDU,UAAU,GAAG,gBAAgB;MAC/B,CAAC,MAAM,IAAID,IAAI,GAAGvP,QAAQ,CAACM,MAAM,GAAG,GAAG,GAAGwO,SAAS,EAAE;QACnD,IAAIvO,IAAI,CAACgB,GAAG,CAAC0M,WAAW,GAAGjO,QAAQ,CAACG,QAAQ,CAAC,GAAG2O,SAAS,EAAE;UACzDU,UAAU,GAAG,YAAY;QAC3B,CAAC,MAAM;UACLA,UAAU,GAAG,gBAAgB;QAC/B;MACF,CAAC,MAAM,IAAID,IAAI,GAAGT,SAAS,EAAE;QAC3BU,UAAU,GAAG,gBAAgB;MAC/B,CAAC,MAAM;QACLA,UAAU,GAAG,aAAa;MAC5B;MAEAnP,KAAK,CAACkE,MAAM,CAACf,KAAK,CAAC6L,MAAM,GAAGjQ,gBAAgB,CAACoQ,UAAU,CAAC;MACxD,IAAIjI,MAAM,GAAG5H,OAAO,CAAC6P,UAAU,CAAC;MAEhC,IAAIvP,gBAAgB,GAAGzB,aAAa,CAAC,CAAC,CAAC,EAAEwB,QAAQ,CAAC;MAElDK,KAAK,CAACsO,UAAU,GAAG;QACjB5O,UAAU,EAAE,CAACkO,WAAW,EAAEC,WAAW,CAAC;QACtC3G,MAAM,EAAEA,MAAM;QACdvH,QAAQ,EAAEA,QAAQ;QAClBC,gBAAgB,EAAEA;MACpB,CAAC;IACH;IAEA,IAAImP,SAAS,KAAK/O,KAAK,CAACkO,cAAc,EAAE;MACtClO,KAAK,CAACkO,cAAc,GAAGa,SAAS;MAChCjO,SAAS,CAAC+I,QAAQ,CAAC,CAAC;IACtB;IAEA,OAAO,IAAI;EACb,CAAC;EAED/I,SAAS,CAACuN,MAAM,GAAG,UAAU9O,CAAC,EAAEC,CAAC,EAAE;IACjC,IAAI,CAACQ,KAAK,CAACoP,WAAW,EAAE;MACtBtO,SAAS,CAACuO,eAAe,CAAC,IAAI,CAAC;IACjC;IAEArP,KAAK,CAACoP,WAAW,GAAG,IAAI;IACxB,IAAIxB,WAAW,GAAGtI,oBAAoB,CAAC/F,CAAC,EAAEC,CAAC,EAAEQ,KAAK,CAACyN,SAAS,EAAEzN,KAAK,CAAC0N,eAAe,GAAG1N,KAAK,CAACa,SAAS,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;IAChH,IAAI0N,WAAW,GAAG9I,YAAY,CAACmI,WAAW,EAAE5N,KAAK,CAACwB,SAAS,CAAC;IAC5DxB,KAAK,CAACU,YAAY,GAAG,CAAC;IACtB,IAAIf,QAAQ,GAAGK,KAAK,CAACwB,SAAS,CAAC+M,WAAW,CAAC;IAE3C,IAAI5O,QAAQ,EAAE;MACZK,KAAK,CAACU,YAAY,GAAGf,QAAQ,CAACG,QAAQ,GAAG8N,WAAW;IACtD;IAEA,IAAIW,WAAW,KAAKvO,KAAK,CAACmO,gBAAgB,IAAIP,WAAW,GAAG,CAAC,EAAE;MAC7D5N,KAAK,CAACmO,gBAAgB,GAAGI,WAAW;MACpCzN,SAAS,CAAC+I,QAAQ,CAAC,CAAC;IACtB;IAEA,OAAO,IAAI;EACb,CAAC;EAED/I,SAAS,CAACwO,MAAM,GAAG,UAAU/P,CAAC,EAAEC,CAAC,EAAE;IACjC,IAAIQ,KAAK,CAACsO,UAAU,EAAE;MACpB,IAAIiB,sBAAsB,GAAGjK,oBAAoB,CAAC/F,CAAC,EAAEC,CAAC,EAAEQ,KAAK,CAACyN,SAAS,EAAEzN,KAAK,CAAC0N,eAAe,GAAG1N,KAAK,CAACa,SAAS,GAAG,IAAI,CAAC;QACpH2O,sBAAsB,GAAG3S,cAAc,CAAC0S,sBAAsB,EAAE,CAAC,CAAC;QAClE3B,WAAW,GAAG4B,sBAAsB,CAAC,CAAC,CAAC;QACvC3B,WAAW,GAAG2B,sBAAsB,CAAC,CAAC,CAAC;MAE3C,IAAItI,MAAM,GAAGlH,KAAK,CAACsO,UAAU,CAACpH,MAAM;MAEpC,IAAIA,MAAM,CAAC0G,WAAW,EAAEC,WAAW,EAAE1P,aAAa,CAAC;QACjDuC,YAAY,EAAEV,KAAK,CAACU,YAAY;QAChCV,KAAK,EAAEA,KAAK;QACZc,SAAS,EAAEA;MACb,CAAC,EAAEd,KAAK,CAACsO,UAAU,CAAC,CAAC,EAAE;QACrBtO,KAAK,CAAC2B,SAAS,GAAGJ,gBAAgB,CAACvB,KAAK,CAACwB,SAAS,EAAExB,KAAK,CAAC+J,aAAa,CAAC;QACxEjJ,SAAS,CAACkJ,mBAAmB,CAAClJ,SAAS,EAAE,IAAI,CAAC;MAChD;MAEAA,SAAS,CAAC+I,QAAQ,CAAC,CAAC;IACtB;IAEA,OAAO,IAAI;EACb,CAAC;EAED/I,SAAS,CAAC2O,IAAI,GAAG,UAAUlQ,CAAC,EAAEC,CAAC,EAAE;IAC/B,IAAIQ,KAAK,CAACoP,WAAW,EAAE;MACrBtO,SAAS,CAACuO,eAAe,CAAC,KAAK,CAAC;IAClC;IAEArP,KAAK,CAACoP,WAAW,GAAG,KAAK;IACzB,OAAO,IAAI;EACb,CAAC;EAEDtO,SAAS,CAAC4O,OAAO,GAAG,UAAUnQ,CAAC,EAAEC,CAAC,EAAE;IAClCsB,SAAS,CAAC2O,IAAI,CAAClQ,CAAC,EAAEC,CAAC,CAAC;IACpBQ,KAAK,CAACkE,MAAM,CAACf,KAAK,CAAC6L,MAAM,GAAG,SAAS;IACrChP,KAAK,CAACkO,cAAc,GAAG,CAAC,CAAC;IACzBpN,SAAS,CAAC+I,QAAQ,CAAC,CAAC;IACpB,OAAO,IAAI;EACb,CAAC;EAED/I,SAAS,CAAC6O,aAAa,GAAG,UAAUpQ,CAAC,EAAEC,CAAC,EAAE;IACxC,IAAIoQ,sBAAsB,GAAGtK,oBAAoB,CAAC/F,CAAC,EAAEC,CAAC,EAAEQ,KAAK,CAACyN,SAAS,EAAEzN,KAAK,CAAC0N,eAAe,GAAG1N,KAAK,CAACa,SAAS,GAAG,IAAI,CAAC;MACpHgP,uBAAuB,GAAGhT,cAAc,CAAC+S,sBAAsB,EAAE,CAAC,CAAC;MACnEhC,WAAW,GAAGiC,uBAAuB,CAAC,CAAC,CAAC;MACxChC,WAAW,GAAGgC,uBAAuB,CAAC,CAAC,CAAC;IAE5C,IAAIjC,WAAW,IAAI,CAAC,EAAE;MACpB9M,SAAS,CAACmJ,WAAW,CAAC2D,WAAW,EAAE,CAAC,GAAGC,WAAW,EAAE,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC;IAChE;IAEA,OAAO,IAAI;EACb,CAAC;EAED/M,SAAS,CAACgP,gBAAgB,GAAG,UAAUvQ,CAAC,EAAEC,CAAC,EAAE;IAC3C,IAAIoO,WAAW,GAAGtI,oBAAoB,CAAC/F,CAAC,EAAEC,CAAC,EAAEQ,KAAK,CAACyN,SAAS,EAAEzN,KAAK,CAAC0N,eAAe,GAAG1N,KAAK,CAACa,SAAS,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;IAChH,IAAI0N,WAAW,GAAG9I,YAAY,CAACmI,WAAW,EAAE5N,KAAK,CAACwB,SAAS,CAAC;IAE5D,IAAIoM,WAAW,IAAI,CAAC,IAAIW,WAAW,KAAK,CAAC,CAAC,EAAE;MAC1CzN,SAAS,CAACqJ,cAAc,CAACoE,WAAW,CAAC;IACvC;IAEA,OAAO,IAAI;EACb,CAAC;EAEDzN,SAAS,CAACiP,kBAAkB,GAAG,YAAY;IACzC,IAAI,CAAC/P,KAAK,CAACgQ,SAAS,EAAE;MACpB,IAAIC,MAAM,GAAG,SAASA,MAAMA,CAAA,EAAG;QAC7B,OAAO,CAAC,CAACjQ,KAAK,CAACoP,WAAW;MAC5B,CAAC;MAED,IAAIc,OAAO,GAAG9J,wBAAwB,CAAC;QACrCa,MAAM,EAAE,CAAC;QACTD,OAAO,EAAE,CAAC;QACVE,MAAM,EAAEpG,SAAS,CAACyM;MACpB,CAAC,EAAE;QACDtG,MAAM,EAAE,CAAC;QACTD,OAAO,EAAE,CAAC;QACVE,MAAM,EAAEpG,SAAS,CAAC6O;MACpB,CAAC,EAAE;QACD1I,MAAM,EAAE,CAAC;QACTD,OAAO,EAAE,CAAC;QACVE,MAAM,EAAEpG,SAAS,CAACgP;MACpB,CAAC,CAAC;MACF9P,KAAK,CAACgQ,SAAS,GAAG;QAChBG,SAAS,EAAE3H,gBAAgB,CAACyH,MAAM,EAAEnK,cAAc,CAAChF,SAAS,CAACwO,MAAM,CAAC,EAAExJ,cAAc,CAAChF,SAAS,CAAC0N,OAAO,CAAC,CAAC;QACxG4B,QAAQ,EAAEtK,cAAc,CAAChF,SAAS,CAAC6O,aAAa,CAAC;QACjDU,WAAW,EAAEvK,cAAc,CAAChF,SAAS,CAACgP,gBAAgB,CAAC;QACvDQ,KAAK,EAAExK,cAAc,CAAChF,SAAS,CAACyM,OAAO,CAAC;QACxCgD,OAAO,EAAEzK,cAAc,CAAChF,SAAS,CAAC2O,IAAI,CAAC;QACvCe,SAAS,EAAE1K,cAAc,CAAChF,SAAS,CAACuN,MAAM,CAAC;QAC3CoC,QAAQ,EAAE3K,cAAc,CAAChF,SAAS,CAAC4O,OAAO,CAAC;QAC3CgB,UAAU,EAAErJ,mBAAmB,CAAC6I,OAAO,EAAElT,KAAK,CAAC2T,KAAK,CAAC7P,SAAS,CAAC0N,OAAO,EAAE1N,SAAS,CAACuN,MAAM,CAAC,CAAC;QAC1FuC,SAAS,EAAEpI,gBAAgB,CAACyH,MAAM,EAAE5I,mBAAmB,CAAC6I,OAAO,EAAEpP,SAAS,CAACwO,MAAM,CAAC,EAAEjI,mBAAmB,CAAC6I,OAAO,EAAEpP,SAAS,CAAC0N,OAAO,CAAC,CAAC;QACpIqC,QAAQ,EAAExJ,mBAAmB,CAAC6I,OAAO,EAAEpP,SAAS,CAAC2O,IAAI,EAAE,CAAC,CAAC,CAAC;MAE5D,CAAC;;MACD/R,MAAM,CAACD,IAAI,CAACuC,KAAK,CAACgQ,SAAS,CAAC,CAACvR,OAAO,CAAC,UAAUqS,SAAS,EAAE;QACxD9Q,KAAK,CAACkE,MAAM,CAAC6M,gBAAgB,CAACD,SAAS,EAAE9Q,KAAK,CAACgQ,SAAS,CAACc,SAAS,CAAC,EAAE,KAAK,CAAC;MAC7E,CAAC,CAAC;IACJ;EACF,CAAC;EAEDhQ,SAAS,CAACkQ,oBAAoB,GAAG,YAAY;IAC3C,IAAIhR,KAAK,CAACgQ,SAAS,EAAE;MACnBtS,MAAM,CAACD,IAAI,CAACuC,KAAK,CAACgQ,SAAS,CAAC,CAACvR,OAAO,CAAC,UAAUqS,SAAS,EAAE;QACxD9Q,KAAK,CAACkE,MAAM,CAAC+M,mBAAmB,CAACH,SAAS,EAAE9Q,KAAK,CAACgQ,SAAS,CAACc,SAAS,CAAC,CAAC;MACzE,CAAC,CAAC;MACF,OAAO9Q,KAAK,CAACgQ,SAAS;IACxB;EACF,CAAC;EAEDlP,SAAS,CAACwM,MAAM,GAAG,YAAY;IAC7B,IAAItK,GAAG,GAAGhD,KAAK,CAACkE,MAAM,CAACK,UAAU,CAAC,IAAI,CAAC;IACvCvB,GAAG,CAACkO,qBAAqB,GAAG,IAAI;IAEhC,IAAIC,WAAW,GAAGtU,cAAc,CAACmD,KAAK,CAACsK,IAAI,EAAE,CAAC,CAAC;MAC3C3J,KAAK,GAAGwQ,WAAW,CAAC,CAAC,CAAC;MACtBlR,MAAM,GAAGkR,WAAW,CAAC,CAAC,CAAC;IAE3B,IAAIzN,MAAM,GAAG1D,KAAK,CAACmD,KAAK,CAAC4K,OAAO;IAChC,IAAIN,SAAS,GAAG,CAACvN,IAAI,CAAC+E,KAAK,CAACjF,KAAK,CAACmD,KAAK,CAAC2K,QAAQ,GAAGpK,MAAM,CAAC,EAAExD,IAAI,CAAC+E,KAAK,CAACvB,MAAM,CAAC,EAAExD,IAAI,CAACkR,IAAI,CAACzQ,KAAK,GAAG,CAAC,GAAG+C,MAAM,GAAG1D,KAAK,CAACmD,KAAK,CAAC2K,QAAQ,CAAC,EAAE5N,IAAI,CAACkR,IAAI,CAACnR,MAAM,GAAG,CAAC,GAAGyD,MAAM,CAAC,CAAC;IACrK,IAAI2N,iBAAiB,GAAGrR,KAAK,CAACmD,KAAK,CAACkO,iBAAiB;IAErD,IAAIrR,KAAK,CAAC0N,eAAe,EAAE;MACzBD,SAAS,CAAC,CAAC,CAAC,IAAIvN,IAAI,CAAC+E,KAAK,CAACoM,iBAAiB,CAAC;MAC7C5D,SAAS,CAAC,CAAC,CAAC,IAAIvN,IAAI,CAAC+E,KAAK,CAACoM,iBAAiB,CAAC;IAC/C;IAEArR,KAAK,CAACyN,SAAS,GAAGA,SAAS,CAAC,CAAC;;IAE7BzK,GAAG,CAACsO,SAAS,CAAC,CAAC,EAAE,CAAC,EAAE3Q,KAAK,EAAEV,MAAM,CAAC;IAClC+C,GAAG,CAACuO,QAAQ,GAAG,OAAO;IACtBvO,GAAG,CAACS,SAAS,GAAGzD,KAAK,CAACmD,KAAK,CAACqO,eAAe;IAC3CxO,GAAG,CAACyO,QAAQ,CAACvT,KAAK,CAAC8E,GAAG,EAAEyK,SAAS,CAAC;IAElC,IAAIzN,KAAK,CAACmD,KAAK,CAAC2K,QAAQ,GAAG,CAAC,EAAE;MAC5B;MACA;MACA,IAAI4D,QAAQ,GAAGxR,IAAI,CAAC+I,KAAK,CAACjJ,KAAK,CAACmD,KAAK,CAAC2K,QAAQ,GAAG,CAAC,GAAG9N,KAAK,CAACmD,KAAK,CAACwO,WAAW,CAAC;MAC7E,IAAIC,MAAM,GAAG1R,IAAI,CAAC+I,KAAK,CAACyI,QAAQ,GAAGhO,MAAM,GAAG1D,KAAK,CAACmD,KAAK,CAACwO,WAAW,CAAC;MACpE3O,GAAG,CAACW,SAAS,CAAC,CAAC;MACfX,GAAG,CAACI,SAAS,GAAGpD,KAAK,CAACmD,KAAK,CAAC0O,iBAAiB;MAC7C7O,GAAG,CAACK,WAAW,GAAGrD,KAAK,CAACmD,KAAK,CAAC2O,iBAAiB;MAC/C9O,GAAG,CAAC+O,GAAG,CAACH,MAAM,GAAGlO,MAAM,GAAG,CAAC,EAAEkO,MAAM,EAAEF,QAAQ,EAAE,CAAC,EAAE,CAAC,GAAGxR,IAAI,CAAC8R,EAAE,EAAE,KAAK,CAAC;MACrEhP,GAAG,CAACS,SAAS,GAAGzD,KAAK,CAACmD,KAAK,CAAC8O,eAAe;MAC3CjP,GAAG,CAACQ,IAAI,CAAC,CAAC;MACVR,GAAG,CAACe,MAAM,CAAC,CAAC;MACZf,GAAG,CAACY,MAAM,CAACgO,MAAM,GAAGF,QAAQ,GAAG1R,KAAK,CAACmD,KAAK,CAACwO,WAAW,GAAG,CAAC,GAAGjO,MAAM,GAAG,CAAC,EAAEkO,MAAM,CAAC;MAChF5O,GAAG,CAACa,MAAM,CAAC+N,MAAM,GAAGF,QAAQ,GAAG1R,KAAK,CAACmD,KAAK,CAACwO,WAAW,GAAG,CAAC,GAAGjO,MAAM,GAAG,CAAC,EAAEkO,MAAM,CAAC;MAChF5O,GAAG,CAACe,MAAM,CAAC,CAAC;MACZf,GAAG,CAACY,MAAM,CAACgO,MAAM,GAAGlO,MAAM,GAAG,CAAC,EAAEkO,MAAM,GAAGF,QAAQ,GAAG1R,KAAK,CAACmD,KAAK,CAACwO,WAAW,GAAG,CAAC,CAAC;MAChF3O,GAAG,CAACa,MAAM,CAAC+N,MAAM,GAAGlO,MAAM,GAAG,CAAC,EAAEkO,MAAM,GAAGF,QAAQ,GAAG1R,KAAK,CAACmD,KAAK,CAACwO,WAAW,GAAG,CAAC,CAAC;MAChF3O,GAAG,CAACe,MAAM,CAAC,CAAC,CAAC,CAAC;;MAEd,IAAI/D,KAAK,CAACmO,gBAAgB,KAAK,CAAC,CAAC,EAAE;QACjCnL,GAAG,CAACS,SAAS,GAAGzD,KAAK,CAACmD,KAAK,CAAC+O,sBAAsB;QAClDlP,GAAG,CAACI,SAAS,GAAGpD,KAAK,CAACmD,KAAK,CAACgP,wBAAwB;QACpDnP,GAAG,CAACK,WAAW,GAAGrD,KAAK,CAACmD,KAAK,CAACiP,wBAAwB;MACxD,CAAC,MAAM;QACLpP,GAAG,CAACS,SAAS,GAAGzD,KAAK,CAACmD,KAAK,CAAC8O,eAAe;QAC3CjP,GAAG,CAACI,SAAS,GAAGpD,KAAK,CAACmD,KAAK,CAAC0O,iBAAiB;QAC7C7O,GAAG,CAACK,WAAW,GAAGrD,KAAK,CAACmD,KAAK,CAAC2O,iBAAiB;MACjD;MAEA9O,GAAG,CAACW,SAAS,CAAC,CAAC;MACfX,GAAG,CAAC+O,GAAG,CAACH,MAAM,GAAGlO,MAAM,GAAG,CAAC,EAAEkO,MAAM,GAAGlO,MAAM,GAAG,CAAC,GAAG1D,KAAK,CAACmD,KAAK,CAAC2K,QAAQ,EAAE4D,QAAQ,EAAE,CAAC,EAAE,CAAC,GAAGxR,IAAI,CAAC8R,EAAE,EAAE,KAAK,CAAC;MACzGhP,GAAG,CAACQ,IAAI,CAAC,CAAC;MACVR,GAAG,CAACe,MAAM,CAAC,CAAC;MACZf,GAAG,CAACY,MAAM,CAACgO,MAAM,GAAGF,QAAQ,GAAG1R,KAAK,CAACmD,KAAK,CAACwO,WAAW,GAAG,CAAC,GAAGjO,MAAM,GAAG,CAAC,EAAEkO,MAAM,GAAGlO,MAAM,GAAG,CAAC,GAAG1D,KAAK,CAACmD,KAAK,CAAC2K,QAAQ,CAAC;MACpH9K,GAAG,CAACa,MAAM,CAAC+N,MAAM,GAAGF,QAAQ,GAAG1R,KAAK,CAACmD,KAAK,CAACwO,WAAW,GAAG,CAAC,GAAGjO,MAAM,GAAG,CAAC,EAAEkO,MAAM,GAAGlO,MAAM,GAAG,CAAC,GAAG1D,KAAK,CAACmD,KAAK,CAAC2K,QAAQ,CAAC;MACpH9K,GAAG,CAACe,MAAM,CAAC,CAAC;IACd,CAAC,CAAC;;IAGF,IAAI/D,KAAK,CAACmL,SAAS,EAAE;MACnBpI,SAAS,CAACC,GAAG,EAAEyK,SAAS,EAAE7E,YAAY,CAAC5I,KAAK,CAACmL,SAAS,EAAEnL,KAAK,CAACa,SAAS,CAAC,EAAE;QACxEuC,SAAS,EAAE,CAAC;QACZC,WAAW,EAAErD,KAAK,CAACmD,KAAK,CAACkP,cAAc;QACvC5O,SAAS,EAAEzD,KAAK,CAACmD,KAAK,CAACkP;MACzB,CAAC,CAAC;IACJ,CAAC,CAAC;;IAGFtP,SAAS,CAACC,GAAG,EAAEyK,SAAS,EAAE7E,YAAY,CAAC5I,KAAK,CAAC2B,SAAS,EAAE3B,KAAK,CAAC0N,eAAe,IAAI1N,KAAK,CAACa,SAAS,CAAC,EAAE;MACjGuC,SAAS,EAAEpD,KAAK,CAACmD,KAAK,CAACwO,WAAW;MAClCtO,WAAW,EAAErD,KAAK,CAACmD,KAAK,CAACmP;IAC3B,CAAC,CAAC,CAAC,CAAC;;IAEJ,IAAItS,KAAK,CAACiE,qBAAqB,IAAIjE,KAAK,CAACiE,qBAAqB,CAACsO,OAAO,CAAC,CAAC,EAAE;MACxE,IAAI/P,UAAU,GAAGxC,KAAK,CAACqL,SAAS,IAAIrL,KAAK,CAACiE,qBAAqB,CAACuO,eAAe,CAAC,CAAC;MAEjF,IAAI,CAACxS,KAAK,CAACyS,WAAW,IAAIzS,KAAK,CAACuK,gBAAgB,KAAKvK,KAAK,CAACiE,qBAAqB,CAACyO,QAAQ,CAAC,CAAC,EAAE;QAC3F1S,KAAK,CAACuK,gBAAgB,GAAGvK,KAAK,CAACiE,qBAAqB,CAACyO,QAAQ,CAAC,CAAC;QAC/D1S,KAAK,CAACyS,WAAW,GAAGzO,iBAAiB,CAAChE,KAAK,CAACiE,qBAAqB,EAAEwJ,SAAS,CAAC,CAAC,CAAC,EAAEjL,UAAU,EAAExC,KAAK,CAACyS,WAAW,CAAC;MACjH;MAEAzP,GAAG,CAAC2P,IAAI,CAAC,CAAC;MACV5P,SAAS,CAACC,GAAG,EAAEyK,SAAS,EAAE7E,YAAY,CAAC5I,KAAK,CAAC2B,SAAS,EAAE3B,KAAK,CAAC0N,eAAe,IAAI1N,KAAK,CAACa,SAAS,CAAC,EAAE;QACjGuC,SAAS,EAAE,CAAC;QACZC,WAAW,EAAE,eAAe;QAC5BI,SAAS,EAAE,eAAe;QAC1BK,IAAI,EAAE;MACR,CAAC,CAAC,CAAC,CAAC;;MAEJ,IAAI9D,KAAK,CAAC0N,eAAe,EAAE;QACzB1K,GAAG,CAACqC,SAAS,CAACrF,KAAK,CAACyS,WAAW,EAAEzS,KAAK,CAACa,SAAS,CAAC,CAAC,CAAC,GAAG4M,SAAS,CAAC,CAAC,CAAC,EAAE,CAAC,EAAEA,SAAS,CAAC,CAAC,CAAC,EAAEA,SAAS,CAAC,CAAC,CAAC,EAAEA,SAAS,CAAC,CAAC,CAAC,EAAEA,SAAS,CAAC,CAAC,CAAC,EAAEA,SAAS,CAAC,CAAC,CAAC,IAAIzN,KAAK,CAACa,SAAS,CAAC,CAAC,CAAC,GAAGb,KAAK,CAACa,SAAS,CAAC,CAAC,CAAC,CAAC,EAAE4M,SAAS,CAAC,CAAC,CAAC,CAAC;MACxM,CAAC,MAAM;QACLzK,GAAG,CAACqC,SAAS,CAACrF,KAAK,CAACyS,WAAW,EAAEhF,SAAS,CAAC,CAAC,CAAC,EAAEA,SAAS,CAAC,CAAC,CAAC,CAAC;MAC9D;MAEAzK,GAAG,CAAC4P,OAAO,CAAC,CAAC;IACf,CAAC,MAAM,IAAI5S,KAAK,CAAC6S,eAAe,EAAE;MAChC7S,KAAK,CAACyS,WAAW,GAAGtN,0BAA0B,CAACnF,KAAK,CAAC6S,eAAe,EAAEpF,SAAS,CAAC,CAAC,CAAC,EAAEzN,KAAK,CAACyS,WAAW,CAAC;MACtGzP,GAAG,CAAC2P,IAAI,CAAC,CAAC;MACV5P,SAAS,CAACC,GAAG,EAAEyK,SAAS,EAAE7E,YAAY,CAAC5I,KAAK,CAAC2B,SAAS,EAAE3B,KAAK,CAAC0N,eAAe,IAAI1N,KAAK,CAACa,SAAS,CAAC,EAAE;QACjGuC,SAAS,EAAE,CAAC;QACZC,WAAW,EAAE,eAAe;QAC5BI,SAAS,EAAE,eAAe;QAC1BK,IAAI,EAAE;MACR,CAAC,CAAC;MACFd,GAAG,CAACqC,SAAS,CAACrF,KAAK,CAACyS,WAAW,EAAEhF,SAAS,CAAC,CAAC,CAAC,EAAEA,SAAS,CAAC,CAAC,CAAC,CAAC;MAC5DzK,GAAG,CAAC4P,OAAO,CAAC,CAAC;IACf,CAAC,CAAC;;IAGF,IAAI5S,KAAK,CAAC0N,eAAe,EAAE;MACzB1K,GAAG,CAACS,SAAS,GAAGzD,KAAK,CAACmD,KAAK,CAAC2P,gBAAgB;MAC5C9P,GAAG,CAACW,SAAS,CAAC,CAAC;MACfX,GAAG,CAAC+P,IAAI,CAACtF,SAAS,CAAC,CAAC,CAAC,GAAGzN,KAAK,CAACa,SAAS,CAAC,CAAC,CAAC,GAAG4M,SAAS,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAACzN,KAAK,CAACa,SAAS,CAAC,CAAC,CAAC,GAAGb,KAAK,CAACa,SAAS,CAAC,CAAC,CAAC,IAAI4M,SAAS,CAAC,CAAC,CAAC,EAAE4D,iBAAiB,CAAC;MAC1IrO,GAAG,CAACQ,IAAI,CAAC,CAAC;IACZ,CAAC,CAAC;;IAGF,IAAI0K,cAAc,GAAGlO,KAAK,CAACwB,SAAS,CAACxB,KAAK,CAACkO,cAAc,CAAC,IAAIlO,KAAK,CAACwB,SAAS,CAACxB,KAAK,CAACmO,gBAAgB,CAAC;IAErG,IAAID,cAAc,EAAE;MAClB,IAAI8E,eAAe,GAAGzR,gBAAgB,CAAC,CAAC2M,cAAc,CAAC,EAAET,SAAS,CAAC,CAAC,CAAC,CAAC;MACtE1K,SAAS,CAACC,GAAG,EAAEyK,SAAS,EAAE7E,YAAY,CAACoK,eAAe,EAAEhT,KAAK,CAAC0N,eAAe,IAAI1N,KAAK,CAACa,SAAS,CAAC,EAAE;QACjGuC,SAAS,EAAEpD,KAAK,CAACmD,KAAK,CAAC8P,iBAAiB;QACxC5P,WAAW,EAAErD,KAAK,CAACmD,KAAK,CAAC+P;MAC3B,CAAC,CAAC,CAAC,CAAC;;MAEJ,IAAIC,OAAO,GAAG1F,SAAS,CAAC,CAAC,CAAC,GAAGtE,YAAY,CAAC+E,cAAc,CAACpO,QAAQ,EAAEE,KAAK,CAAC0N,eAAe,IAAI1N,KAAK,CAACa,SAAS,CAAC,GAAG4M,SAAS,CAAC,CAAC,CAAC;MAC3H,IAAI2F,IAAI,GAAG3F,SAAS,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,GAAGS,cAAc,CAACjO,MAAM,IAAIwN,SAAS,CAAC,CAAC,CAAC;MACpE,IAAI4F,OAAO,GAAG5F,SAAS,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,GAAGS,cAAc,CAACjO,MAAM,IAAIwN,SAAS,CAAC,CAAC,CAAC;MAC7E,IAAI6F,OAAO,GAAG7F,SAAS,CAAC,CAAC,CAAC,GAAGA,SAAS,CAAC,CAAC,CAAC;MACzC,IAAI8F,YAAY,GAAGrF,cAAc,CAACvN,KAAK,GAAG8M,SAAS,CAAC,CAAC,CAAC;MAEtD,IAAIzN,KAAK,CAAC0N,eAAe,EAAE;QACzB6F,YAAY,IAAIvT,KAAK,CAACa,SAAS,CAAC,CAAC,CAAC,GAAGb,KAAK,CAACa,SAAS,CAAC,CAAC,CAAC;MACzD;MAEAmC,GAAG,CAACI,SAAS,GAAGpD,KAAK,CAACmD,KAAK,CAACqQ,WAAW;MACvCxQ,GAAG,CAACK,WAAW,GAAGrD,KAAK,CAACmD,KAAK,CAACsQ,WAAW;MACzCzQ,GAAG,CAACS,SAAS,GAAGzD,KAAK,CAACmD,KAAK,CAACqO,eAAe;MAC3CxO,GAAG,CAACW,SAAS,CAAC,CAAC;MACfX,GAAG,CAACY,MAAM,CAACuP,OAAO,EAAE1F,SAAS,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,GAAGS,cAAc,CAACjO,MAAM,IAAIwN,SAAS,CAAC,CAAC,CAAC,CAAC;MAC9EzK,GAAG,CAACa,MAAM,CAACsP,OAAO,EAAE1F,SAAS,CAAC,CAAC,CAAC,GAAGA,SAAS,CAAC,CAAC,CAAC,CAAC;MAChDzK,GAAG,CAACe,MAAM,CAAC,CAAC,CAAC,CAAC;;MAEdf,GAAG,CAACW,SAAS,CAAC,CAAC;MACfX,GAAG,CAAC+O,GAAG,CAACoB,OAAO,EAAEC,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,GAAGlT,IAAI,CAAC8R,EAAE,CAAC;MACzChP,GAAG,CAACQ,IAAI,CAAC,CAAC;MACVR,GAAG,CAACe,MAAM,CAAC,CAAC,CAAC,CAAC;;MAEd,IAAI2P,MAAM,GAAGxT,IAAI,CAACC,GAAG,CAACoT,YAAY,GAAG,GAAG,EAAErF,cAAc,CAACjO,MAAM,GAAGwN,SAAS,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC;MACrFzK,GAAG,CAACW,SAAS,CAAC,CAAC;MACfX,GAAG,CAAC+P,IAAI,CAACI,OAAO,GAAGO,MAAM,EAAEL,OAAO,GAAGK,MAAM,EAAEA,MAAM,GAAG,CAAC,EAAEA,MAAM,GAAG,CAAC,CAAC;MACpE1Q,GAAG,CAACQ,IAAI,CAAC,CAAC;MACVR,GAAG,CAACe,MAAM,CAAC,CAAC;MACZf,GAAG,CAACW,SAAS,CAAC,CAAC,CAAC,CAAC;;MAEjB,IAAIgQ,WAAW,GAAGJ,YAAY,GAAG,GAAG;MACpCvQ,GAAG,CAAC+P,IAAI,CAACI,OAAO,GAAGQ,WAAW,EAAEL,OAAO,GAAG,CAAC,EAAE,CAAC,GAAGK,WAAW,EAAE,EAAE,CAAC;MACjE3Q,GAAG,CAACQ,IAAI,CAAC,CAAC;MACVR,GAAG,CAACe,MAAM,CAAC,CAAC;IACd;EACF,CAAC;EAEDjD,SAAS,CAAC8S,eAAe,GAAG,UAAUvI,SAAS,EAAE;IAC/C,IAAI7I,UAAU,GAAG6I,SAAS,IAAIrL,KAAK,CAACqL,SAAS;IAC7C,IAAItK,KAAK,GAAG,CAACyB,UAAU,CAAC,CAAC,CAAC,GAAGA,UAAU,CAAC,CAAC,CAAC,KAAKxC,KAAK,CAAC2B,SAAS,CAACpD,MAAM,GAAG,CAAC,CAAC;IAC1E,IAAImE,KAAK,GAAG,EAAE;IACd,IAAIC,QAAQ,GAAG,GAAG;IAClB,IAAIC,SAAS,GAAG,CAAC;IAEjB,KAAK,IAAIC,KAAK,GAAG,CAAC,EAAEA,KAAK,GAAG7C,KAAK,CAAC2B,SAAS,CAACpD,MAAM,EAAEsE,KAAK,EAAE,EAAE;MAC3D,IAAItD,CAAC,GAAGiD,UAAU,CAAC,CAAC,CAAC,GAAGzB,KAAK,GAAG8B,KAAK;MACrC,IAAIrD,CAAC,GAAGQ,KAAK,CAAC2B,SAAS,CAACkB,KAAK,CAAC;MAC9BH,KAAK,CAACzE,IAAI,CAAC;QACTsB,CAAC,EAAEA,CAAC;QACJC,CAAC,EAAEA,CAAC;QACJmD,QAAQ,EAAEA,QAAQ;QAClBC,SAAS,EAAEA;MACb,CAAC,CAAC;IACJ;IAEA,OAAOF,KAAK;EACd,CAAC;EAED5B,SAAS,CAAC+S,YAAY,GAAG,UAAUpR,iBAAiB,EAAE4I,SAAS,EAAE;IAC/D,IAAI3I,KAAK,GAAG5B,SAAS,CAAC8S,eAAe,CAACvI,SAAS,CAAC;IAChD5I,iBAAiB,CAACK,QAAQ,CAACJ,KAAK,CAAC;EACnC,CAAC;EAED5B,SAAS,CAACgT,eAAe,GAAG,UAAUzI,SAAS,EAAE;IAC/C,IAAI7I,UAAU,GAAG6I,SAAS,IAAIrL,KAAK,CAACqL,SAAS;IAC7C,IAAItK,KAAK,GAAG,CAACyB,UAAU,CAAC,CAAC,CAAC,GAAGA,UAAU,CAAC,CAAC,CAAC,KAAKxC,KAAK,CAAC2B,SAAS,CAACpD,MAAM,GAAG,CAAC,CAAC;IAC1E,IAAIwV,QAAQ,GAAG/T,KAAK,CAAC2B,SAAS,CAACpD,MAAM,GAAG,CAAC;IACzC,IAAIyV,QAAQ,GAAG,CAAC;IAEhB,KAAK,IAAInR,KAAK,GAAG,CAAC,EAAEA,KAAK,GAAG7C,KAAK,CAAC2B,SAAS,CAACpD,MAAM,EAAEsE,KAAK,EAAE,EAAE;MAC3D,IAAI7C,KAAK,CAAC2B,SAAS,CAACkB,KAAK,CAAC,GAAG,CAAC,EAAE;QAC9BkR,QAAQ,GAAG7T,IAAI,CAACC,GAAG,CAAC4T,QAAQ,EAAElR,KAAK,CAAC;MACtC;MAEA,IAAI7C,KAAK,CAAC2B,SAAS,CAACkB,KAAK,CAAC,GAAG,CAAC,EAAE;QAC9BmR,QAAQ,GAAG9T,IAAI,CAACE,GAAG,CAAC4T,QAAQ,EAAEnR,KAAK,CAAC;MACtC;IACF;IAEA,OAAO,CAACL,UAAU,CAAC,CAAC,CAAC,GAAGuR,QAAQ,GAAGhT,KAAK,EAAEyB,UAAU,CAAC,CAAC,CAAC,GAAGwR,QAAQ,GAAGjT,KAAK,CAAC;EAC7E,CAAC;EAED,IAAIkT,UAAU,GAAGnT,SAAS,CAACoT,kBAAkB;EAE7CpT,SAAS,CAACoT,kBAAkB,GAAG,UAAU/L,CAAC,EAAE;IAC1C,IAAIgM,MAAM,GAAGF,UAAU,CAAC9L,CAAC,CAAC;IAE1B,IAAIgM,MAAM,EAAE;MACVnU,KAAK,CAACuK,gBAAgB,GAAG,CAAC;MAC1BvK,KAAK,CAACa,SAAS,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC;IAC1B;IAEA,OAAOsT,MAAM;EACf,CAAC;EAED,IAAItT,SAAS,GAAGC,SAAS,CAACsT,YAAY;EAEtCtT,SAAS,CAACsT,YAAY,GAAG,YAAY;IACnC,IAAID,MAAM,GAAGtT,SAAS,CAAC3C,KAAK,CAAC,KAAK,CAAC,EAAEI,SAAS,CAAC;IAE/C,IAAI6V,MAAM,EAAE;MACVnU,KAAK,CAACuK,gBAAgB,GAAG,CAAC;IAC5B;IAEA,OAAO4J,MAAM;EACf,CAAC,CAAC,CAAC;;EAGHrT,SAAS,CAACuT,UAAU,CAAC,YAAY;IAC/B,OAAOvT,SAAS,CAACwM,MAAM,CAAC,CAAC;EAC3B,CAAC,CAAC;EACFxM,SAAS,CAACuJ,OAAO,CAACnM,KAAK,CAAC4C,SAAS,EAAE/D,kBAAkB,CAACiD,KAAK,CAACsK,IAAI,CAAC,CAAC;AACpE,CAAC,CAAC;AACF;AACA;;AAGA,IAAIgK,cAAc,GAAG;EACnBnJ,SAAS,EAAE,EAAE;EACbgB,YAAY,EAAE,GAAG;EACjBf,cAAc,EAAE,IAAI;EACpBC,SAAS,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;EACjB7J,SAAS,EAAE,EAAE;EACbG,SAAS,EAAE,EAAE;EACb2I,IAAI,EAAE,CAAC,GAAG,EAAE,GAAG,CAAC;EAChBP,aAAa,EAAE,GAAG;EAClBQ,gBAAgB,EAAE,CAAC;EACnBlK,qBAAqB,EAAE,IAAI;EAC3B8C,KAAK,EAAE;IACLqO,eAAe,EAAE,wBAAwB;IACzCa,cAAc,EAAE,0BAA0B;IAC1CC,WAAW,EAAE,cAAc;IAC3BY,WAAW,EAAE,gBAAgB;IAC7BhB,sBAAsB,EAAE,0BAA0B;IAClDE,wBAAwB,EAAE,oBAAoB;IAC9CN,iBAAiB,EAAE,kBAAkB;IACrCG,eAAe,EAAE,wBAAwB;IACzCwB,WAAW,EAAE,gBAAgB;IAC7B9B,WAAW,EAAE,CAAC;IACdsB,iBAAiB,EAAE,CAAC;IACpBpB,iBAAiB,EAAE,GAAG;IACtB2B,WAAW,EAAE,CAAC;IACd1F,QAAQ,EAAE,EAAE;IACZC,OAAO,EAAE,EAAE;IACXsD,iBAAiB,EAAE,EAAE;IACrByB,gBAAgB,EAAE;EACpB,CAAC;EACD5E,cAAc,EAAE,CAAC,CAAC;EAClBC,gBAAgB,EAAE,CAAC,CAAC;EACpBT,eAAe,EAAE,IAAI;EACrB7M,SAAS,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;AAEpB,CAAC,CAAC,CAAC;;AAEH,SAAS0T,MAAMA,CAACzT,SAAS,EAAEd,KAAK,EAAE;EAChC,IAAIwU,aAAa,GAAGlW,SAAS,CAACC,MAAM,GAAG,CAAC,IAAID,SAAS,CAAC,CAAC,CAAC,KAAKoD,SAAS,GAAGpD,SAAS,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;EAC1FZ,MAAM,CAAC+W,MAAM,CAACzU,KAAK,EAAEsU,cAAc,EAAEE,aAAa,CAAC,CAAC,CAAC;;EAErDxX,KAAK,CAAC0X,GAAG,CAAC5T,SAAS,EAAEd,KAAK,CAAC;EAC3BhD,KAAK,CAAC2X,MAAM,CAAC7T,SAAS,EAAEd,KAAK,EAAE,CAAC,eAAe,EAAE,cAAc,EAAE,uBAAuB,EAAE,iBAAiB,EAAE,iBAAiB,EAAE,uBAAuB,CAAC,CAAC;EACzJhD,KAAK,CAAC4X,WAAW,CAAC9T,SAAS,EAAEd,KAAK,EAAE,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC;EACrDhD,KAAK,CAAC6X,GAAG,CAAC/T,SAAS,EAAEd,KAAK,EAAE,CAAC,MAAM,EAAE,QAAQ,EAAE,WAAW,CAAC,CAAC;EAC5DhD,KAAK,CAAC8X,KAAK,CAAChU,SAAS,EAAEd,KAAK,EAAE,eAAe,CAAC;EAC9ChD,KAAK,CAAC8X,KAAK,CAAChU,SAAS,EAAEd,KAAK,EAAE,WAAW,CAAC;EAC1ChD,KAAK,CAAC8X,KAAK,CAAChU,SAAS,EAAEd,KAAK,EAAE,YAAY,CAAC,CAAC,CAAC;;EAE7CsJ,0BAA0B,CAACxI,SAAS,EAAEd,KAAK,CAAC;AAC9C,CAAC,CAAC;;AAEF,IAAI+U,WAAW,GAAG/X,KAAK,CAAC+X,WAAW,CAACR,MAAM,EAAE,4BAA4B,CAAC,CAAC,CAAC;;AAE3E,IAAIS,4BAA4B,GAAG7W,aAAa,CAAC;EAC/C4W,WAAW,EAAEA,WAAW;EACxBR,MAAM,EAAEA;AACV,CAAC,EAAElL,MAAM,CAAC;AAEV,SAASA,MAAM,EAAE2L,4BAA4B,IAAIC,OAAO,EAAEV,MAAM,EAAEQ,WAAW"},"metadata":{},"sourceType":"module","externalDependencies":[]}